[ {
  "name" : "- Inventory Reorder Watchlist",
  "description" : "1. Inventory Reorder Watchlist",
  "data" : "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Inventory Reorder Monitor - Fishbowl Advanced</title>\r\n\r\n    <!-- Tailwind CSS -->\r\n    <script src=\"https://cdn.tailwindcss.com\"></script>\r\n\r\n    <!-- D3.js v7 -->\r\n    <script src=\"https://d3js.org/d3.v7.min.js\"></script>\r\n\r\n    <!-- Google Fonts -->\r\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap\" rel=\"stylesheet\">\r\n\r\n    <!-- DataTables CDN Links -->\r\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.datatables.net/v/bs4-4.1.1/jq-3.3.1/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/b-html5-1.6.1/b-print-1.6.1/cr-1.5.2/fh-3.1.6/r-2.2.3/sc-2.0.1/datatables.min.css\"/>\r\n    <script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js\"></script>\r\n    <script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js\"></script>\r\n    <script type=\"text/javascript\" src=\"https://cdn.datatables.net/v/bs4-4.1.1/jq-3.3.1/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/b-html5-1.6.1/b-print-1.6.1/cr-1.5.2/fh-3.1.6/r-2.2.3/sc-2.0.1/datatables.min.js\"></script>\r\n    <style>\r\n        /* ============================================\r\n           Base Styles (matching Sales Dashboard)\r\n           ============================================ */\r\n        html, body {\r\n            height: 100%;\r\n            margin: 0;\r\n            padding: 0;\r\n            overflow: hidden;\r\n            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\r\n        }\r\n\r\n        /* Custom Brand Colors (matching Sales Dashboard) */\r\n        :root {\r\n            --color-primary: #2d9cdb;\r\n            --color-primary-dark: #1e7bb4;\r\n            --color-sidebar: #06162d;\r\n            --color-sidebar-hover: #0a1f3d;\r\n        }\r\n\r\n        /* Custom Scrollbar */\r\n        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }\r\n        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }\r\n        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }\r\n        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }\r\n\r\n        /* Override Tailwind indigo with custom blue */\r\n        .bg-indigo-600 { background-color: var(--color-primary) !important; }\r\n        .bg-indigo-50 { background-color: rgba(45, 156, 219, 0.1) !important; }\r\n        .text-indigo-600 { color: var(--color-primary) !important; }\r\n        .text-indigo-700 { color: var(--color-primary-dark) !important; }\r\n        .border-indigo-200 { border-color: rgba(45, 156, 219, 0.3) !important; }\r\n        .hover\\:text-indigo-600:hover { color: var(--color-primary) !important; }\r\n        .hover\\:bg-indigo-50:hover { background-color: rgba(45, 156, 219, 0.1) !important; }\r\n\r\n        /* ============================================\r\n           DataTables Overrides\r\n           ============================================ */\r\n        table.dataTable {\r\n            table-layout: fixed;\r\n            font-size: 12px;\r\n            border-collapse: separate;\r\n            border-spacing: 0;\r\n        }\r\n\r\n        table.dataTable thead th {\r\n            font-size: 12px;\r\n            padding: 12px 8px;\r\n            background-color: var(--color-primary) !important;\r\n            color: white !important;\r\n            font-weight: 600;\r\n            border: none;\r\n            text-align: center;\r\n            white-space: normal;\r\n            line-height: 1.3;\r\n        }\r\n\r\n        table.dataTable thead th:first-child {\r\n            border-top-left-radius: 8px;\r\n        }\r\n\r\n        table.dataTable thead th:last-child {\r\n            border-top-right-radius: 8px;\r\n        }\r\n\r\n        table.dataTable tbody td {\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            white-space: nowrap;\r\n            font-size: 12px;\r\n            padding: 8px;\r\n            border-bottom: 1px solid #e2e8f0;\r\n        }\r\n\r\n        /* Center aligned columns */\r\n        table.dataTable tbody td.dt-center {\r\n            text-align: center;\r\n        }\r\n\r\n        /* Right aligned columns */\r\n        table.dataTable tbody td.dt-right {\r\n            text-align: right;\r\n        }\r\n\r\n        table.dataTable tbody tr {\r\n            background-color: white;\r\n            transition: background-color 0.15s ease;\r\n        }\r\n\r\n        table.dataTable tbody tr:hover {\r\n            background-color: #f8fafc;\r\n        }\r\n\r\n        /* Vendor Group Header Row */\r\n        .vendor-group-header td {\r\n            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%) !important;\r\n            font-weight: 700;\r\n            padding: 12px !important;\r\n            font-size: 13px;\r\n            border-top: 2px solid var(--color-primary);\r\n            border-bottom: 1px solid #cbd5e1;\r\n            color: #1e293b;\r\n        }\r\n\r\n        /* Column Group Styling */\r\n        .group-status {\r\n            background-color: #e0f2fe !important;\r\n        }\r\n\r\n        .group-part-info {\r\n            background-color: #f1f5f9 !important;\r\n        }\r\n\r\n        .group-inventory-key {\r\n            background-color: #fef3c7 !important;\r\n        }\r\n\r\n        .group-reorder-params {\r\n            background-color: #dcfce7 !important;\r\n        }\r\n\r\n        .group-allocation {\r\n            background-color: #fafafa !important;\r\n        }\r\n\r\n        /* DataTables Controls */\r\n        .dataTables_wrapper .dataTables_length {\r\n            float: left;\r\n            margin-bottom: 16px;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_filter {\r\n            float: right;\r\n            margin-bottom: 16px;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_filter input {\r\n            margin-left: 8px;\r\n            padding: 6px 12px;\r\n            border: 1px solid #cbd5e1;\r\n            border-radius: 8px;\r\n            font-size: 13px;\r\n            transition: all 0.2s ease;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_filter input:focus {\r\n            outline: none;\r\n            border-color: var(--color-primary);\r\n            box-shadow: 0 0 0 3px rgba(45, 156, 219, 0.1);\r\n        }\r\n\r\n        /* DataTables Buttons */\r\n        .dt-buttons {\r\n            float: right;\r\n            margin-bottom: 16px;\r\n            margin-right: 16px;\r\n        }\r\n\r\n        .dt-buttons .dt-button {\r\n            font-size: 13px;\r\n            padding: 6px 16px;\r\n            margin-left: 8px;\r\n            background-color: white;\r\n            color: #475569;\r\n            border: 1px solid #cbd5e1;\r\n            border-radius: 8px;\r\n            cursor: pointer;\r\n            transition: all 0.2s ease;\r\n            font-weight: 500;\r\n        }\r\n\r\n        .dt-buttons .dt-button:hover {\r\n            background-color: #f8fafc;\r\n            color: var(--color-primary);\r\n            border-color: var(--color-primary);\r\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_info {\r\n            color: #64748b;\r\n            font-size: 13px;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_paginate {\r\n            color: #64748b;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_paginate .paginate_button {\r\n            padding: 4px 12px;\r\n            margin-left: 4px;\r\n            border-radius: 6px;\r\n            border: 1px solid #e2e8f0;\r\n            background-color: white;\r\n            color: #475569 !important;\r\n            transition: all 0.2s ease;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {\r\n            background-color: var(--color-primary) !important;\r\n            color: white !important;\r\n            border-color: var(--color-primary);\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_paginate .paginate_button.current {\r\n            background-color: var(--color-primary) !important;\r\n            color: white !important;\r\n            border-color: var(--color-primary);\r\n        }\r\n\r\n        /* ============================================\r\n           Enhanced Print Styles\r\n           ============================================ */\r\n        @media print {\r\n            html, body {\r\n                overflow: visible;\r\n            }\r\n\r\n            @page {\r\n                size: A4 landscape;\r\n                margin: 0.5in;\r\n            }\r\n\r\n            .dataTables_wrapper .dataTables_length,\r\n            .dataTables_wrapper .dataTables_filter,\r\n            .dataTables_wrapper .dataTables_info,\r\n            .dataTables_wrapper .dataTables_paginate,\r\n            .dataTables_wrapper .dataTables_processing,\r\n            .dt-buttons,\r\n            button,\r\n            .btn,\r\n            header {\r\n                display: none !important;\r\n            }\r\n\r\n            #headerContainer h1 {\r\n                font-size: 18pt;\r\n                margin: 0 0 10px 0;\r\n                color: #000;\r\n            }\r\n\r\n            table.dataTable {\r\n                width: 100% !important;\r\n                font-size: 7pt;\r\n            }\r\n\r\n            table.dataTable thead th {\r\n                background-color: var(--color-primary) !important;\r\n                color: #fff !important;\r\n                font-size: 6.5pt;\r\n                padding: 3px 2px;\r\n                border: 1px solid #000;\r\n                -webkit-print-color-adjust: exact;\r\n                print-color-adjust: exact;\r\n            }\r\n\r\n            table.dataTable tbody td {\r\n                font-size: 7pt;\r\n                padding: 2px 1px;\r\n                border: 1px solid #ccc;\r\n                -webkit-print-color-adjust: exact;\r\n                print-color-adjust: exact;\r\n            }\r\n\r\n            .vendor-group-header td {\r\n                background: linear-gradient(135deg, #e8e8e8 0%, #d0d0d0 100%) !important;\r\n                font-weight: bold;\r\n                font-size: 7.5pt;\r\n                padding: 4px 2px !important;\r\n                border: 1px solid #000 !important;\r\n                -webkit-print-color-adjust: exact;\r\n                print-color-adjust: exact;\r\n            }\r\n\r\n            table.dataTable tbody tr {\r\n                page-break-inside: avoid;\r\n            }\r\n        }\r\n    </style>\r\n</head>\r\n<body class=\"bg-slate-50\">\r\n    <div class=\"flex flex-col h-screen\">\r\n        <!-- Header (matching Sales Dashboard) -->\r\n        <header id=\"headerContainer\" class=\"h-20 bg-white border-b border-slate-200 px-8 flex items-center justify-between flex-shrink-0 z-20 shadow-sm\">\r\n            <div class=\"flex items-center gap-6\">\r\n                <div>\r\n                    <h1 class=\"text-xl font-bold text-slate-900\">Inventory Reorder Monitor</h1>\r\n                    <p class=\"text-xs text-slate-500 mt-0.5\">Real-time inventory reorder tracking and capacity monitoring</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"flex items-center gap-3\">\r\n                <!-- Help Button -->\r\n                <button onclick=\"toggleInstructions()\" class=\"px-3 py-2 bg-slate-100 hover:bg-slate-200 border border-slate-300 rounded-lg text-sm font-medium transition-colors\" title=\"View Usage Guide\">\r\n                    <svg class=\"w-4 h-4 inline mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                    </svg>\r\n                    Help\r\n                </button>\r\n\r\n                <!-- Refresh Button -->\r\n                <button onclick=\"refreshTable()\" class=\"p-2.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-xl transition-all\" title=\"Refresh Data\">\r\n                    <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"></path>\r\n                    </svg>\r\n                </button>\r\n            </div>\r\n        </header>\r\n\r\n        <!-- Content Area -->\r\n        <div class=\"flex-1 overflow-y-auto custom-scrollbar p-4 lg:p-8\">\r\n            <!-- Instructions Panel (hidden by default) -->\r\n            <div id=\"instructionsPanel\" class=\"bg-white rounded-2xl shadow-md border border-slate-300 p-6 mb-6\" style=\"display: none;\">\r\n                <div class=\"flex items-center justify-between mb-4\">\r\n                    <h2 class=\"text-lg font-bold text-slate-800 flex items-center gap-2\">\r\n                        <svg class=\"w-5 h-5 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                        </svg>\r\n                        Usage Guide\r\n                    </h2>\r\n                    <button onclick=\"toggleInstructions()\" class=\"text-slate-400 hover:text-slate-600 transition-colors\">\r\n                        <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                        </svg>\r\n                    </button>\r\n                </div>\r\n\r\n                <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                    <div>\r\n                        <h3 class=\"text-sm font-bold text-slate-700 mb-2\">Report Purpose</h3>\r\n                        <p class=\"text-sm text-slate-600 mb-4\">This report monitors inventory levels for parts with configured reorder points, displaying current stock status and recommended order quantities to maintain optimal inventory levels.</p>\r\n\r\n                        <h3 class=\"text-sm font-bold text-slate-700 mb-2\">Key Metrics</h3>\r\n                        <div class=\"text-sm text-slate-600 space-y-1\">\r\n                            <p><strong>Available:</strong> On Hand - Allocated - Not Available + Dropship</p>\r\n                            <p><strong>Qty to Order:</strong> Order Up To - (Available - Committed)</p>\r\n                            <p><strong>Reorder Point:</strong> Minimum threshold triggering reorder alert</p>\r\n                            <p><strong>Order Up To:</strong> Target maximum inventory level</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <h3 class=\"text-sm font-bold text-slate-700 mb-3\">Status Indicators</h3>\r\n                        <p class=\"text-sm text-slate-600 mb-3\">The Status column uses color-coded cells with gradient fills representing capacity percentage:</p>\r\n                        <div class=\"space-y-3\">\r\n                            <div class=\"flex items-center gap-3\">\r\n                                <div class=\"w-20 h-8 rounded flex items-center justify-center text-white text-xs font-semibold\" style=\"background: linear-gradient(to left, #C62828 75%, #EF9A9A 75%); text-shadow: 1px 1px 2px rgba(0,0,0,0.8);\">-75%</div>\r\n                                <div class=\"flex-1 text-xs\">\r\n                                    <strong class=\"text-slate-700\">Critical</strong>\r\n                                    <p class=\"text-slate-500\">Below reorder point - fills from right (negative values)</p>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"flex items-center gap-3\">\r\n                                <div class=\"w-20 h-8 rounded flex items-center justify-center text-white text-xs font-semibold\" style=\"background: linear-gradient(to right, #F57C00 20%, #FFCC80 20%); text-shadow: 1px 1px 2px rgba(0,0,0,0.8);\">20%</div>\r\n                                <div class=\"flex-1 text-xs\">\r\n                                    <strong class=\"text-slate-700\">Alert</strong>\r\n                                    <p class=\"text-slate-500\">Within 20% above reorder point - order soon</p>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"flex items-center gap-3\">\r\n                                <div class=\"w-20 h-8 rounded flex items-center justify-center text-white text-xs font-semibold\" style=\"background: linear-gradient(to right, #2E7D32 60%, #A5D6A7 60%); text-shadow: 1px 1px 2px rgba(0,0,0,0.8);\">60%</div>\r\n                                <div class=\"flex-1 text-xs\">\r\n                                    <strong class=\"text-slate-700\">Good</strong>\r\n                                    <p class=\"text-slate-500\">Adequate stock levels</p>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"flex items-center gap-3\">\r\n                                <div class=\"w-24 h-8 rounded flex items-center justify-center text-white text-xs font-semibold\" style=\"background: #1976D2; text-shadow: 1px 1px 2px rgba(0,0,0,0.8);\">Overstocked</div>\r\n                                <div class=\"flex-1 text-xs\">\r\n                                    <strong class=\"text-slate-700\">Overstocked</strong>\r\n                                    <p class=\"text-slate-500\">Above order up to level</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- Main Table Container -->\r\n            <div class=\"bg-white rounded-2xl shadow-md border border-slate-300 p-6\">\r\n                <table id=\"report-table\" class=\"display\" style=\"width:100%\"></table>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <script>\r\n    let partNum = '$PART{Part|%|General}';\r\n    if (!partNum || partNum == '' || partNum == -1 || partNum == '%') {\r\n        partNum = '%';\r\n    }\r\n\r\n    let vendorId = '$VEND{Vendor|%|General}';\r\n    vendorId == -1 ? (vendorId = '%') : true;\r\n    if (!vendorId || vendorId == '' || vendorId == '%') {\r\n        vendorId = '%';\r\n    }\r\n\r\n\r\n    let locationGroupId = '$LG{Location_Group|%|General}';\r\n    locationGroupId == -1 ? (locationGroupId = '%') : true;\r\n    let user = JSON.parse(getUser());\r\n    let currentUser = user.id;\r\n\r\n    // Filter checkboxes\r\n    const hideOverstocked = $CHECK{Hide_Overstocked|false};\r\n    const hideAdequate = $CHECK{Hide_Adequately_Stocked|false};\r\n    const hideApproaching = $CHECK{Hide_Approaching_Reorder|false};\r\n\r\n    let dataset;\r\n\r\n    function monitor() {\r\n      function getData() {\r\n        let query = `SELECT\r\n          base.refresh,\r\n          base.partid,\r\n          base.partnum,\r\n          base.partdescription,\r\n          base.vendorname,\r\n          base.locationgroup,\r\n          base.uom,\r\n          base.reorderpoint,\r\n          base.orderuptolevel,\r\n          base.onhand,\r\n          base.available,\r\n          base.committed,\r\n          base.allocated,\r\n          base.\\`not available\\`,\r\n          base.\\`on order\\`,\r\n\r\n          GREATEST(0, base.orderuptolevel - (base.available - base.committed)) as recommendedorderqty,\r\n\r\n          -- Capacity % with division-by-zero protection\r\n          CASE\r\n            WHEN base.orderuptolevel = base.reorderpoint THEN\r\n              CASE\r\n                WHEN base.available > base.orderuptolevel THEN 150\r\n                WHEN base.available = base.orderuptolevel THEN 100\r\n                ELSE 0\r\n              END\r\n            ELSE\r\n              ROUND(\r\n                ((base.available - base.reorderpoint) / (base.orderuptolevel - base.reorderpoint)) * 100,\r\n                1\r\n              )\r\n          END as capacitypct,\r\n\r\n         (CASE\r\n              WHEN base.available > base.orderuptolevel THEN 'fb10'\r\n              WHEN base.available < base.reorderpoint THEN 'fb40'\r\n              WHEN base.available >= base.reorderpoint\r\n                   AND base.available <= (base.reorderpoint + (0.2 * (base.orderuptolevel - base.reorderpoint))) THEN 'fb30'\r\n              ELSE 'fb20'\r\n          END) as state,\r\n          (CASE\r\n            WHEN base.available > base.orderuptolevel THEN '4-Overstocked'\r\n            WHEN base.available < base.reorderpoint THEN '1-Critical'\r\n            WHEN base.available >= base.reorderpoint\r\n                 AND base.available <= (base.reorderpoint + (0.2 * (base.orderuptolevel - base.reorderpoint))) THEN '2-Alert'\r\n            ELSE '3-Good'\r\n        END) as statetext\r\n\r\n        FROM (\r\n          SELECT\r\n            COALESCE((SELECT (sysvalue) * 1000 FROM sysproperties WHERE syskey = 'Refresh Rate'),300000) as refresh,\r\n            part.id as partid,\r\n            part.num as partnum,\r\n            part.description as partdescription,\r\n            COALESCE(vendor.name,'No Default Vendor') as vendorname,\r\n            COALESCE(locationgroup.name,'Company Wide') as locationgroup,\r\n            coalesce(uom.code,'') as uom,\r\n            partreorder.reorderpoint as reorderpoint,\r\n            partreorder.orderuptolevel as orderuptolevel,\r\n\r\n            (CASE WHEN partreorder.locationgroupid IS NOT NULL THEN coalesce(qtyonhand.qty,0) ELSE coalesce(totals.qtyonhand, 0) END) as onhand,\r\n\r\n            (CASE WHEN partreorder.locationgroupid IS NOT NULL\r\n              THEN coalesce(IF(coalesce(qtyonhand.qty,0) - coalesce(qtyallocated.qty,0) - coalesce(qtynotavailable.qty,0) + coalesce(qtydropship.qty,0) < 0,0,coalesce(qtyonhand.qty,0) - coalesce(qtyallocated.qty,0) - coalesce(qtynotavailable.qty,0) + coalesce(qtydropship.qty,0)),0)\r\n              ELSE coalesce(totals.qtyavailable, 0)\r\n            END) as available,\r\n\r\n            (CASE WHEN partreorder.locationgroupid IS NOT NULL THEN coalesce(qtycommitted.qty,0) ELSE coalesce((SELECT sum(qty) FROM qtycommitted qtyc WHERE qtyc.partid = part.id GROUP BY partid),0) END) as committed,\r\n            (CASE WHEN partreorder.locationgroupid IS NOT NULL THEN coalesce(qtyallocated.qty,0) ELSE coalesce(totals.qtyallocated, 0) END) as allocated,\r\n            (CASE WHEN partreorder.locationgroupid IS NOT NULL THEN coalesce(qtynotavailable.qty,0) ELSE coalesce(totals.qtynotavailable, 0) END) as \\`not available\\`,\r\n            (CASE WHEN partreorder.locationgroupid IS NOT NULL THEN coalesce(qtyonorder.qty,0) ELSE coalesce(totals.qtyonorder, 0) END) as \\`on order\\`\r\n\r\n          FROM partreorder\r\n\r\n            INNER JOIN part ON partreorder.partid = part.id\r\n            INNER JOIN uom ON part.uomid = uom.id\r\n            LEFT OUTER JOIN vendorparts ON (part.id = vendorparts.partid AND vendorparts.defaultflag = 1)\r\n            LEFT OUTER JOIN vendor ON vendorparts.vendorid = vendor.id\r\n            LEFT OUTER JOIN locationgroup ON partreorder.locationgroupid = locationgroup.id\r\n            left outer join qtyonhand on (part.id = qtyonhand.partid and locationgroup.id = qtyonhand.locationgroupid)\r\n            left outer join qtycommitted on (part.id = qtycommitted.partid and locationgroup.id = qtycommitted.locationgroupid)\r\n            left outer join qtyallocated on (part.id = qtyallocated.partid and locationgroup.id = qtyallocated.locationgroupid)\r\n            left outer join qtyonorder on (part.id = qtyonorder.partid and locationgroup.id = qtyonorder.locationgroupid)\r\n            left outer join qtynotavailable on (part.id = qtynotavailable.partid and locationgroup.id = qtynotavailable.locationgroupid)\r\n            left outer join qtydropship on (part.id = qtydropship.partid and locationgroup.id = qtydropship.locationgroupid)\r\n            left outer join (select coalesce(sum(qti.qtyonhand),0) as qtyonhand,\r\n                        coalesce(sum(qti.qtyallocated),0) as qtyallocated,\r\n                        coalesce(sum(qti.qtyonorder),0) as qtyonorder,\r\n                        if(coalesce((sum(qti.qtyonhand) - sum(qti.qtyallocated) - sum(qti.qtynotavailable) + sum(qti.qtydropship)),0) < 0,0,coalesce((sum(qti.qtyonhand) - sum(qti.qtyallocated) - sum(qti.qtynotavailable) + sum(qti.qtydropship)),0)) as qtyavailable,\r\n                        coalesce(sum(qti.qtynotavailable),0) as qtynotavailable,\r\n                        coalesce(sum(qti.qtydropship),0) as qtydropship, qti.partid\r\n                    from qtyinventorytotals qti\r\n                    group by qti.partid) as totals on part.id = totals.partid\r\n\r\n          WHERE part.id LIKE '${partNum}'\r\n                  AND COALESCE(locationgroup.id,'') LIKE '${locationGroupId}'\r\n                  AND ('${vendorId}' = '%' OR vendor.id = '${vendorId}')\r\n                  AND partreorder.reorderpoint IS NOT NULL\r\n                  AND partreorder.orderuptolevel IS NOT NULL\r\n                  AND partreorder.reorderpoint > 0\r\n                  AND partreorder.orderuptolevel > 0\r\n        ) as base\r\n        ORDER BY\r\n                CASE WHEN base.vendorname = 'No Default Vendor' THEN 1 ELSE 0 END,\r\n                base.vendorname,\r\n                (CASE\r\n                  WHEN base.available > base.orderuptolevel THEN 'fb10'\r\n                  WHEN base.available < base.reorderpoint THEN 'fb40'\r\n                  WHEN base.available >= base.reorderpoint\r\n                       AND base.available <= (base.reorderpoint + (0.2 * (base.orderuptolevel - base.reorderpoint))) THEN 'fb30'\r\n                  ELSE 'fb20'\r\n                END) DESC,\r\n                base.partnum`;\r\n\r\n        console.log(query);\r\n        let dataset = JSON.parse(runQuery(query));\r\n        console.log(dataset);\r\n        return dataset;\r\n      }\r\n\r\n      function applyFilters(data) {\r\n        return data.filter(function(row) {\r\n          // Overstocked: state === 'fb10' or capacity > 100\r\n          if (hideOverstocked && (row.state === 'fb10' || row.capacitypct > 100)) {\r\n            return false;\r\n          }\r\n\r\n          // Adequately stocked: capacity > 20 (but not overstocked)\r\n          if (hideAdequate && row.capacitypct > 20 && row.state !== 'fb10' && row.capacitypct <= 100) {\r\n            return false;\r\n          }\r\n\r\n          // Approaching reorder point: capacity 0-20%\r\n          if (hideApproaching && row.capacitypct >= 0 && row.capacitypct <= 20) {\r\n            return false;\r\n          }\r\n\r\n          return true;\r\n        });\r\n      }\r\n\r\n      function drawTable() {\r\n        dataset = getData();\r\n\r\n        // Apply filters\r\n        let filteredData = applyFilters(dataset);\r\n\r\n        // Insert vendor header rows\r\n        let groupedData = [];\r\n        let currentVendor = null;\r\n\r\n\r\n        let vendorFilter = $('#vendorFilter').val()?.toLowerCase() || '';\r\n        groupedData = groupedData.filter(row => {\r\n          if (row.isVendorHeader) return true;\r\n          return row.vendorname?.toLowerCase().includes(vendorFilter);\r\n        });\r\n\r\n\r\n        filteredData.forEach(function(row) {\r\n          if (row.vendorname !== currentVendor) {\r\n            currentVendor = row.vendorname;\r\n            groupedData.push({\r\n              isVendorHeader: true,\r\n              vendorname: currentVendor\r\n            });\r\n          }\r\n          groupedData.push(row);\r\n        });\r\n\r\n        let table = $('#report-table');\r\n        table.empty();\r\n\r\n        $(window).on('resize scroll', function() {\r\n          table.columns.adjust();\r\n        });\r\n\r\n        let dataTable = table.DataTable({\r\n          dom: 'B<\"clear\">lfrtip',\r\n          data: groupedData,\r\n          ordering: false,\r\n          autoWidth: false,\r\n          pageLength: 100,\r\n          columns: [\r\n            {\r\n              title: '<span title=\"Vendor grouping indicator\">',\r\n              data: 'vendorname',\r\n              defaultContent: '',\r\n              width: '1%',\r\n              render: function(data, type, row) {\r\n                if (row.isVendorHeader) return data;\r\n                return '';\r\n              },\r\n              createdCell: function(td, cellData, rowData, row, col) {\r\n                              if (rowData.isVendorHeader) {\r\n                                $(td).attr('colspan', 14);\r\n                                $(td).parent().addClass('vendor-group-header');\r\n                                $(td).html('<svg class=\"w-4 h-4 inline-block mr-2 align-text-bottom\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" style=\"color: #2d9cdb;\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"></path></svg>' + rowData.vendorname);\r\n                                $(td).nextAll().remove();\r\n                              } else {\r\n                                $(td).css({\r\n                                  'padding': '2px',\r\n                                  'width': '1%',\r\n                                  'max-width': '10px'\r\n                                });\r\n                              }\r\n                            }\r\n            },\r\n            {\r\n              title: '<span title=\"Inventory status with capacity percentage\">Status</span>',\r\n              data: 'capacitypct',\r\n              defaultContent: '',\r\n              className: 'dt-center group-status',\r\n              width: '8%',\r\n              render: function(data, type, row) {\r\n                if (row.isVendorHeader) return '';\r\n                if (type === 'display') {\r\n                  let text;\r\n                  if (row.state === 'fb10' || data > 100) {\r\n                    text = 'Overstocked';\r\n                  } else if (data < 0) {\r\n                    text = data + '%';\r\n                  } else {\r\n                    text = data + '%';\r\n                  }\r\n                  return '<strong>' + text + '</strong>';\r\n                }\r\n                return data;\r\n              },\r\n              createdCell: function (td, cellData, rowData, row, col) {\r\n                  if (rowData.isVendorHeader) return;\r\n\r\n                  // Determine color based on state\r\n                  let bgColor = '';\r\n                  let lightColor = '';\r\n                  if (rowData.state === 'fb10') {\r\n                      bgColor = '#1976D2'; // Blue - Overstocked\r\n                      lightColor = '#90CAF9'; // Darker light blue\r\n                  } else if (rowData.state === 'fb20') {\r\n                      bgColor = '#2E7D32'; // Green - Good\r\n                      lightColor = '#A5D6A7'; // Darker light green\r\n                  } else if (rowData.state === 'fb30') {\r\n                      bgColor = '#F57C00'; // Orange - Alert\r\n                      lightColor = '#FFCC80'; // Darker light orange\r\n                  } else if (rowData.state === 'fb40') {\r\n                      bgColor = '#C62828'; // Red - Critical\r\n                      lightColor = '#EF9A9A'; // Darker light red\r\n                  }\r\n\r\n                  if (bgColor) {\r\n                      // Calculate fill percentage (cap at 0-100 for display)\r\n                      let fillPercent = Math.max(0, Math.min(100, cellData));\r\n                      let gradient;\r\n\r\n                      if (cellData < 0) {\r\n                          // Negative - fill from right to left\r\n                          let fillFromRight = Math.min(100, Math.abs(cellData));\r\n                          gradient = 'linear-gradient(to left, ' + bgColor + ' ' + fillFromRight + '%, ' + lightColor + ' ' + fillFromRight + '%)';\r\n                      } else if (cellData > 100) {\r\n                          // Over 100% - full fill\r\n                          gradient = bgColor;\r\n                      } else {\r\n                          // Normal - fill from left to right\r\n                          gradient = 'linear-gradient(to right, ' + bgColor + ' ' + fillPercent + '%, ' + lightColor + ' ' + fillPercent + '%)';\r\n                      }\r\n\r\n                      td.style.setProperty('background', gradient, 'important');\r\n                      td.style.setProperty('color', '#FFFFFF', 'important');\r\n                      td.style.setProperty('font-weight', 'normal', 'important');\r\n                      td.style.setProperty('text-shadow', '1px 1px 2px rgba(0,0,0,0.8)', 'important');\r\n                  }\r\n              }\r\n\r\n            },\r\n            {\r\n              title: '<span title=\"Unique part identifier/SKU\">Part Number</span>',\r\n              data: 'partnum',\r\n              defaultContent: '',\r\n              width: '8%',\r\n              className: 'dt-right group-part-info',\r\n              render: function(data, type, row) {\r\n                if (row.isVendorHeader) return '';\r\n                if (type === 'display') {\r\n                  return '<strong>' + data + '</strong>';\r\n                }\r\n                return data;\r\n              }\r\n            },\r\n            {\r\n              title: '<span title=\"Descriptive name of the part\">Part Description</span>',\r\n              data: 'partdescription',\r\n              defaultContent: '',\r\n              width: '15%',\r\n              className: 'group-part-info',\r\n              render: function(data, type, row) {\r\n                if (row.isVendorHeader) return '';\r\n                if (type === 'display') {\r\n                  return '<strong>' + data + '</strong>';\r\n                }\r\n                return data;\r\n              }\r\n            },\r\n            {\r\n              title: '<span title=\"Unit of Measure for quantity tracking\">UOM</span>',\r\n              data: 'uom',\r\n              defaultContent: '',\r\n              width: '4%',\r\n              className: 'dt-center group-part-info',\r\n              render: function(data, type, row) {\r\n                if (row.isVendorHeader) return '';\r\n                return data || '';\r\n              }\r\n            },\r\n            { title: '<span title=\"Total physical quantity currently in stock\">On Hand</span>', data: 'onhand', defaultContent: '', width: '6%', className: 'dt-center group-inventory-key',render: function (data, type, row) {\r\n\r\n                if (row.isVendorHeader) return '';\r\n                if (data === null || data === '' || data === undefined) return '';\r\n\r\n                if (type === 'display' || type === 'filter') {\r\n\r\n                    const num = parseFloat(data);\r\n\r\n                    if (isNaN(num)) return '';\r\n\r\n                    // If it's a whole number, show no decimals\r\n                    if (Number.isInteger(num)) {\r\n                        return num.toString();\r\n                    }\r\n\r\n                    // Otherwise show up to 2 decimals (no trailing zeros)\r\n                    return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                }\r\n\r\n                return data;\r\n            }\r\n },\r\n            { title: '<span title=\"Quantity available for use: On Hand - Allocated - Not Available + Dropship\">Available</span>', data: 'available', defaultContent: '', width: '6%', className: 'dt-center group-inventory-key',\r\n                      render: function (data, type, row) {\r\n\r\n                        if (row.isVendorHeader) return '';\r\n                        if (data === null || data === '' || data === undefined) return '';\r\n\r\n                        if (type === 'display' || type === 'filter') {\r\n\r\n                            const num = parseFloat(data);\r\n\r\n                            if (isNaN(num)) return '';\r\n\r\n                            // If it's a whole number, show no decimals\r\n                            if (Number.isInteger(num)) {\r\n                                return num.toString();\r\n                            }\r\n\r\n                            // Otherwise show up to 2 decimals (no trailing zeros)\r\n                            return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                        }\r\n\r\n                        return data;\r\n                      }\r\n             },\r\n            { title: '<span title=\"Recommended quantity to order to reach Order Up To level: Order Up To - (Available - Committed)\">Qty to Order</span>', data: 'recommendedorderqty', defaultContent: '', width: '8%', className: 'dt-center group-inventory-key',\r\n                      render: function (data, type, row) {\r\n\r\n                        if (row.isVendorHeader) return '';\r\n                        if (data === null || data === '' || data === undefined) return '';\r\n\r\n                        if (type === 'display' || type === 'filter') {\r\n\r\n                            const num = parseFloat(data);\r\n\r\n                            if (isNaN(num)) return '';\r\n\r\n                            // If it's a whole number, show no decimals\r\n                            if (Number.isInteger(num)) {\r\n                                return num.toString();\r\n                            }\r\n\r\n                            // Otherwise show up to 2 decimals (no trailing zeros)\r\n                            return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                        }\r\n\r\n                        return data;\r\n                      }\r\n            },\r\n            { title: '<span title=\"Minimum inventory threshold that triggers a reorder alert\">Reorder Point</span>', data: 'reorderpoint', defaultContent: '', width: '6%', className: 'dt-center group-reorder-params',\r\n                      render: function (data, type, row) {\r\n\r\n                        if (row.isVendorHeader) return '';\r\n                        if (data === null || data === '' || data === undefined) return '';\r\n\r\n                        if (type === 'display' || type === 'filter') {\r\n\r\n                            const num = parseFloat(data);\r\n\r\n                            if (isNaN(num)) return '';\r\n\r\n                            // If it's a whole number, show no decimals\r\n                            if (Number.isInteger(num)) {\r\n                                return num.toString();\r\n                            }\r\n\r\n                            // Otherwise show up to 2 decimals (no trailing zeros)\r\n                            return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                        }\r\n\r\n                        return data;\r\n                      }\r\n },\r\n            { title: '<span title=\"Target maximum inventory level when reordering\">Order Up To</span>', data: 'orderuptolevel', defaultContent: '', width: '6%', className: 'dt-center group-reorder-params', render: function (data, type, row) {\r\n\r\n     if (row.isVendorHeader) return '';\r\n     if (data === null || data === '' || data === undefined) return '';\r\n\r\n     if (type === 'display' || type === 'filter') {\r\n\r\n         const num = parseFloat(data);\r\n\r\n         if (isNaN(num)) return '';\r\n\r\n         // If it's a whole number, show no decimals\r\n         if (Number.isInteger(num)) {\r\n             return num.toString();\r\n         }\r\n\r\n         // Otherwise show up to 2 decimals (no trailing zeros)\r\n         return num.toFixed(2).replace(/\\.?0+$/, '');\r\n     }\r\n\r\n     return data;\r\n }\r\n },\r\n            { title: '<span title=\"Quantity committed to sales orders\">Committed</span>', data: 'committed', defaultContent: '', width: '6%', className: 'dt-center group-allocation',render: function (data, type, row) {\r\n\r\n     if (row.isVendorHeader) return '';\r\n     if (data === null || data === '' || data === undefined) return '';\r\n\r\n     if (type === 'display' || type === 'filter') {\r\n\r\n         const num = parseFloat(data);\r\n\r\n         if (isNaN(num)) return '';\r\n\r\n         // If it's a whole number, show no decimals\r\n         if (Number.isInteger(num)) {\r\n             return num.toString();\r\n         }\r\n\r\n         // Otherwise show up to 2 decimals (no trailing zeros)\r\n         return num.toFixed(2).replace(/\\.?0+$/, '');\r\n     }\r\n\r\n     return data;\r\n }\r\n },\r\n            { title: '<span title=\"Quantity allocated for work orders or manufacturing builds\">Allocated</span>', data: 'allocated', defaultContent: '', width: '6%', className: 'dt-center group-allocation',render: function (data, type, row) {\r\n\r\n                if (row.isVendorHeader) return '';\r\n                if (data === null || data === '' || data === undefined) return '';\r\n\r\n                if (type === 'display' || type === 'filter') {\r\n\r\n                    const num = parseFloat(data);\r\n\r\n                    if (isNaN(num)) return '';\r\n\r\n                    // If it's a whole number, show no decimals\r\n                    if (Number.isInteger(num)) {\r\n                        return num.toString();\r\n                    }\r\n\r\n                    // Otherwise show up to 2 decimals (no trailing zeros)\r\n                    return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                }\r\n\r\n                return data;\r\n            }\r\n },\r\n            { title: '<span title=\"Quantity on hand but flagged as not available for use\">Not Available</span>', data: 'not available', defaultContent: '', width: '6%', className: 'dt-center group-allocation',render: function (data, type, row) {\r\n\r\n                if (row.isVendorHeader) return '';\r\n                if (data === null || data === '' || data === undefined) return '';\r\n\r\n                if (type === 'display' || type === 'filter') {\r\n\r\n                    const num = parseFloat(data);\r\n\r\n                    if (isNaN(num)) return '';\r\n\r\n                    // If it's a whole number, show no decimals\r\n                    if (Number.isInteger(num)) {\r\n                        return num.toString();\r\n                    }\r\n\r\n                    // Otherwise show up to 2 decimals (no trailing zeros)\r\n                    return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                }\r\n\r\n                return data;\r\n            }\r\n },\r\n            { title: '<span title=\"Quantity on purchase orders not yet received\">On Order</span>', data: 'on order', defaultContent: '', width: '6%', className: 'dt-center group-allocation',render: function (data, type, row) {\r\n\r\n                if (row.isVendorHeader) return '';\r\n                if (data === null || data === '' || data === undefined) return '';\r\n\r\n                if (type === 'display' || type === 'filter') {\r\n\r\n                    const num = parseFloat(data);\r\n\r\n                    if (isNaN(num)) return '';\r\n\r\n                    // If it's a whole number, show no decimals\r\n                    if (Number.isInteger(num)) {\r\n                        return num.toString();\r\n                    }\r\n\r\n                    // Otherwise show up to 2 decimals (no trailing zeros)\r\n                    return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                }\r\n\r\n                return data;\r\n            }\r\n }\r\n          ],\r\n          fixedHeader: true,\r\n          colReorder: false,\r\n          pagingType: 'simple',\r\n          responsive: false,\r\n          deferRender: true,\r\n          stateSave: false,\r\n          buttons: [\r\n            'csv',\r\n            'print'\r\n          ],\r\n          language: {\r\n            paginate: {\r\n              previous: 'PREV',\r\n              next: 'NEXT'\r\n            }\r\n          },\r\n          drawCallback: function(settings) {\r\n            // Force column width recalculation after draw to prevent skinny columns\r\n            var api = this.api();\r\n            api.columns.adjust();\r\n\r\n            // Update vendor header colspans\r\n            updateVendorHeaderColspan();\r\n          }\r\n        });\r\n\r\n        // Update vendor header colspans based on visible columns\r\n        function updateVendorHeaderColspan() {\r\n          let visibleColCount = dataTable.columns(':visible').count();\r\n          $('.vendor-group-header td').each(function() {\r\n            $(this).attr('colspan', visibleColCount);\r\n            // Remove any extra cells that were created\r\n            $(this).nextAll().remove();\r\n          });\r\n        }\r\n\r\n        // Update colspans initially\r\n        updateVendorHeaderColspan();\r\n\r\n        // Force initial column width adjustment\r\n        dataTable.columns.adjust().draw(false);\r\n      }\r\n\r\n      function refreshTable() {\r\n        console.time('refreshRate');\r\n        let table = $('#report-table').DataTable();\r\n        dataset = getData();\r\n\r\n        // Apply filters\r\n        let filteredData = applyFilters(dataset);\r\n\r\n        // Insert vendor header rows\r\n        let groupedData = [];\r\n        let currentVendor = null;\r\n\r\n        filteredData.forEach(function(row) {\r\n          if (row.vendorname !== currentVendor) {\r\n            currentVendor = row.vendorname;\r\n            groupedData.push({\r\n              isVendorHeader: true,\r\n              vendorname: currentVendor\r\n            });\r\n          }\r\n          groupedData.push(row);\r\n        });\r\n\r\n        table.clear();\r\n\r\n        table.rows.add(groupedData);\r\n        table.draw(false);\r\n\r\n        // Ensure columns maintain proper widths after refresh\r\n        table.columns.adjust();\r\n\r\n        console.timeEnd('refreshRate');\r\n        setTimeout(refreshTable, dataset[0].refresh);\r\n      }\r\n\r\n      // Make refreshTable globally accessible\r\n      window.refreshTable = refreshTable;\r\n\r\n      drawTable();\r\n      $(\".dt-buttons\").addClass( \"csv-button-margin\" );\r\n      console.log(dataset[0].refresh);\r\n      setTimeout(refreshTable, dataset[0].refresh);\r\n    }\r\n\r\n    $(document).ready(function() {\r\n      monitor();\r\n    });\r\n\r\n    // Toggle instructions panel\r\n    function toggleInstructions() {\r\n      const panel = document.getElementById('instructionsPanel');\r\n      if (panel.style.display === 'none') {\r\n        panel.style.display = 'block';\r\n      } else {\r\n        panel.style.display = 'none';\r\n      }\r\n    }\r\n\r\n    const displayHeader = $CHECK{Display_header|true};\r\n    let headerContainer = document.getElementById('headerContainer');\r\n    displayHeader ? headerContainer.style.display = 'flex' : headerContainer.style.display = 'none';\r\n\r\n    </script>\r\n</body>\r\n</html>",
  "active" : true,
  "note" : "",
  "type" : "Page"
} ]