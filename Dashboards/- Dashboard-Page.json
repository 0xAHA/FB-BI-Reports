[ {
  "name" : "- Dashboard",
  "description" : "- Dashboard",
  "data" : "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Dashboard - Combined View</title>\r\n\r\n    <!-- Google Fonts - Inter -->\r\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap\" rel=\"stylesheet\">\r\n\r\n    <!-- Moment.js for date formatting -->\r\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js\"></script>\r\n\r\n    <style>\r\n        * {\r\n            margin: 0;\r\n            padding: 0;\r\n            box-sizing: border-box;\r\n        }\r\n\r\n        body {\r\n            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\r\n            font-size: 12px;\r\n            padding: 8px;\r\n            background: #f5f5f5;\r\n        }\r\n\r\n        /* Dashboard Grid Layout */\r\n        #dashboardGrid {\r\n            display: grid;\r\n            gap: 12px;\r\n            width: 100%;\r\n        }\r\n\r\n        #dashboardGrid.cols-1 { grid-template-columns: 1fr; }\r\n        #dashboardGrid.cols-2 { grid-template-columns: repeat(2, 1fr); }\r\n        #dashboardGrid.cols-3 { grid-template-columns: repeat(3, 1fr); }\r\n        #dashboardGrid.cols-4 { grid-template-columns: repeat(4, 1fr); }\r\n\r\n        /* Tile Container */\r\n        .dashboard-tile {\r\n            background: white;\r\n            border: 1px solid #ddd;\r\n            border-radius: 4px;\r\n            overflow: hidden;\r\n            display: flex;\r\n            flex-direction: column;\r\n        }\r\n\r\n        /* Tile Header */\r\n        .tile-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            padding: 8px 12px;\r\n            background: #f8f9fa;\r\n            border-bottom: 1px solid #e2e8f0;\r\n        }\r\n\r\n        .tile-title {\r\n            font-size: 14px;\r\n            font-weight: 600;\r\n            color: #333;\r\n            margin: 0;\r\n        }\r\n\r\n        .tile-controls {\r\n            display: flex;\r\n            gap: 8px;\r\n            align-items: center;\r\n        }\r\n\r\n        /* Buttons */\r\n        .btn {\r\n            padding: 4px 10px;\r\n            font-size: 11px;\r\n            border: 1px solid #ccc;\r\n            background: white;\r\n            border-radius: 3px;\r\n            cursor: pointer;\r\n            font-weight: 500;\r\n        }\r\n\r\n        .btn:hover {\r\n            background: #f0f0f0;\r\n        }\r\n\r\n        .btn-primary {\r\n            background: #2d9cdb;\r\n            color: white;\r\n            border-color: #2d9cdb;\r\n        }\r\n\r\n        .btn-primary:hover {\r\n            background: #1e7bb4;\r\n        }\r\n\r\n        /* Hide Estimates Checkbox */\r\n        .hide-estimates-label {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n            font-size: 11px;\r\n            color: #666;\r\n            cursor: pointer;\r\n            user-select: none;\r\n        }\r\n\r\n        .hide-estimates-label input[type=\"checkbox\"] {\r\n            cursor: pointer;\r\n        }\r\n\r\n        /* Filter Info */\r\n        .filter-info {\r\n            font-size: 11px;\r\n            color: #666;\r\n            padding: 3px 8px;\r\n            background: #fff3cd;\r\n            border-radius: 3px;\r\n        }\r\n\r\n        /* Tile Table Container */\r\n        .tile-table-container {\r\n            flex: 1;\r\n            overflow: auto;\r\n            /* Height will be set dynamically based on BI_DASHBOARD_ROWS */\r\n        }\r\n\r\n        /* Table Styling */\r\n        .tile-table {\r\n            width: 100%;\r\n            border-collapse: collapse;\r\n            font-size: 12px;\r\n            table-layout: auto;\r\n        }\r\n\r\n        /* Column width controls */\r\n        th[data-column=\"scheduleindicator\"],\r\n        th[data-column=\"availabilitystatus\"] {\r\n            width: 50px;\r\n            min-width: 50px;\r\n            max-width: 50px;\r\n        }\r\n\r\n        th[data-column=\"statusname\"],\r\n        th[data-column=\"type\"],\r\n        th[data-column=\"priorityname\"],\r\n        th[data-column=\"issue\"] {\r\n            width: 100px;\r\n            min-width: 80px;\r\n        }\r\n\r\n        th[data-column=\"num\"],\r\n        th[data-column=\"ordernum\"],\r\n        th[data-column=\"monum\"],\r\n        th[data-column=\"bomnum\"],\r\n        th[data-column=\"qty\"] {\r\n            width: 100px;\r\n            min-width: 80px;\r\n        }\r\n\r\n        th[data-column=\"dateissued\"],\r\n        th[data-column=\"datescheduled\"],\r\n        th[data-column=\"datefirstship\"],\r\n        th[data-column=\"datescheduledtostart\"] {\r\n            width: 110px;\r\n            min-width: 100px;\r\n        }\r\n\r\n        th[data-column=\"customername\"],\r\n        th[data-column=\"vendorname\"],\r\n        th[data-column=\"orderinfo\"] {\r\n            min-width: 120px;\r\n            max-width: 200px;\r\n        }\r\n\r\n        th[data-column=\"customerpo\"],\r\n        th[data-column=\"customerso\"] {\r\n            min-width: 100px;\r\n            max-width: 150px;\r\n        }\r\n\r\n        .tile-table td {\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            white-space: nowrap;\r\n        }\r\n\r\n        .tile-table th {\r\n            background: #f8f9fa;\r\n            padding: 12px 8px;\r\n            text-align: left;\r\n            font-size: 12px;\r\n            font-weight: 600;\r\n            color: #475569;\r\n            text-transform: uppercase;\r\n            letter-spacing: 0.5px;\r\n            border-bottom: 2px solid #e2e8f0;\r\n            position: sticky;\r\n            top: 0;\r\n            z-index: 10;\r\n            white-space: nowrap;\r\n            cursor: pointer;\r\n            user-select: none;\r\n        }\r\n\r\n        .tile-table th:hover {\r\n            background: #e9ecef;\r\n        }\r\n\r\n        .tile-table th .sort-icon {\r\n            margin-left: 4px;\r\n            font-size: 10px;\r\n            color: #94a3b8;\r\n        }\r\n\r\n        .tile-table th.schedule-col {\r\n            width: 40px;\r\n            text-align: center;\r\n            padding-left: 4px;\r\n            padding-right: 4px;\r\n        }\r\n\r\n        .tile-table td {\r\n            padding: 8px;\r\n            border-bottom: 1px solid #e9ecef;\r\n            color: #334155;\r\n            font-size: 12px;\r\n        }\r\n\r\n        .tile-table tr:hover {\r\n            background-color: #f8fafc;\r\n        }\r\n\r\n        .tile-table tr:nth-child(even) {\r\n            background-color: #fafafa;\r\n        }\r\n\r\n        .tile-table tr:nth-child(even):hover {\r\n            background-color: #f8fafc;\r\n        }\r\n\r\n        /* Filter Row */\r\n        .filter-row td {\r\n            padding: 4px 6px;\r\n        }\r\n\r\n        .filter-row input {\r\n            width: 100%;\r\n            padding: 3px 4px;\r\n            font-size: 10px;\r\n            border: 1px solid #cbd5e1;\r\n            border-radius: 3px;\r\n        }\r\n\r\n        .filter-row input:focus {\r\n            outline: none;\r\n            border-color: #2d9cdb;\r\n        }\r\n\r\n        /* Status Badges */\r\n        .status-badge {\r\n            display: inline-block;\r\n            padding: 2px 8px;\r\n            border-radius: 3px;\r\n            font-size: 11px;\r\n            font-weight: 600;\r\n        }\r\n\r\n        .status-estimate {\r\n            background: #fff3cd;\r\n            color: #856404;\r\n        }\r\n\r\n        .status-inprogress {\r\n            background: #cce5ff;\r\n            color: #004085;\r\n        }\r\n\r\n        .status-started {\r\n            background: #cce5ff;\r\n            color: #004085;\r\n        }\r\n\r\n        .status-issued {\r\n            background: #d4edda;\r\n            color: #155724;\r\n        }\r\n\r\n        .status-entered {\r\n            background: #fff3cd;\r\n            color: #856404;\r\n        }\r\n\r\n        .status-committed {\r\n            background: #cce5ff;\r\n            color: #004085;\r\n        }\r\n\r\n        .status-picked {\r\n            background: #d4edda;\r\n            color: #155724;\r\n        }\r\n\r\n        .status-packed {\r\n            background: #c3e6cb;\r\n            color: #0f5132;\r\n        }\r\n\r\n        .status-shipped {\r\n            background: #e2e8f0;\r\n            color: #475569;\r\n        }\r\n\r\n        /* Order Links */\r\n        .order-link {\r\n            color: #2d9cdb;\r\n            text-decoration: none;\r\n            font-weight: 600;\r\n        }\r\n\r\n        .order-link:hover {\r\n            text-decoration: underline;\r\n            color: #1e7bb4;\r\n        }\r\n\r\n        /* Schedule Indicator */\r\n        .clock-icon {\r\n            width: 16px;\r\n            height: 16px;\r\n            display: inline-block;\r\n            vertical-align: middle;\r\n        }\r\n\r\n        /* Status Circle */\r\n        .status-circle {\r\n            width: 16px;\r\n            height: 16px;\r\n            border-radius: 50%;\r\n            display: inline-block;\r\n            vertical-align: middle;\r\n            border: 2px solid transparent;\r\n        }\r\n\r\n        .status-circle.green {\r\n            background-color: #10b981;\r\n            border-color: #059669;\r\n        }\r\n\r\n        .status-circle.orange {\r\n            background-color: #fff3cd;\r\n            border-color: #b8860b;\r\n        }\r\n\r\n        .status-circle.red {\r\n            background-color: #ef4444;\r\n            border-color: #dc2626;\r\n        }\r\n\r\n        .status-circle.gray {\r\n            background-color: #9ca3af;\r\n            border-color: #6b7280;\r\n        }\r\n\r\n        .status-icon-padlock {\r\n            width: 16px;\r\n            height: 16px;\r\n            display: inline-block;\r\n            vertical-align: middle;\r\n        }\r\n\r\n        /* RMA Status Badges */\r\n        .status-open {\r\n            background: #fff3cd;\r\n            color: #856404;\r\n        }\r\n\r\n        .status-fulfilled {\r\n            background: #d4edda;\r\n            color: #155724;\r\n        }\r\n\r\n        .status-expired {\r\n            background: #e2e8f0;\r\n            color: #475569;\r\n        }\r\n\r\n        /* Availability Icon */\r\n        .availability-icon {\r\n            width: 16px;\r\n            height: 16px;\r\n            display: inline-block;\r\n            vertical-align: middle;\r\n        }\r\n\r\n        .narrow-col {\r\n            width: 50px;\r\n            text-align: center;\r\n            padding-left: 4px;\r\n            padding-right: 4px;\r\n        }\r\n\r\n        /* Debug Console */\r\n        #debugConsole {\r\n            margin-top: 12px;\r\n            background: #1e293b;\r\n            border: 1px solid #334155;\r\n            border-radius: 4px;\r\n            padding: 12px;\r\n        }\r\n\r\n        #debugLog {\r\n            background: #0f172a;\r\n            border-radius: 4px;\r\n            padding: 8px;\r\n            height: 200px;\r\n            overflow-y: auto;\r\n            font-family: 'Courier New', monospace;\r\n            font-size: 11px;\r\n            color: #e2e8f0;\r\n        }\r\n\r\n        /* Error Message */\r\n        .error-tile {\r\n            padding: 20px;\r\n            text-align: center;\r\n            color: #dc2626;\r\n            background: #fee;\r\n            border-radius: 4px;\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n    <!-- Dashboard Grid -->\r\n    <div id=\"dashboardGrid\"></div>\r\n\r\n    <!-- Debug Console -->\r\n    <div id=\"debugConsole\" style=\"display: none;\">\r\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\r\n            <h3 style=\"font-size: 12px; font-weight: 600; color: #94a3b8; margin: 0;\">Debug Console</h3>\r\n            <button onclick=\"DashboardCommon.clearDebugLog()\" class=\"btn\" style=\"padding: 4px 8px; font-size: 11px;\">Clear</button>\r\n        </div>\r\n        <div id=\"debugLog\">\r\n            <div style=\"color: #64748b; font-style: italic;\">Initializing...</div>\r\n        </div>\r\n    </div>\r\n\r\n    <script>\r\n        // ============================================================================\r\n        // EMBEDDED SCRIPTS - Dashboard Common Utilities  \r\n        // ============================================================================\r\n/**\r\n * Dashboard Common Utilities\r\n * Shared functions used across all dashboard tiles\r\n */\r\n\r\nwindow.DashboardCommon = (function() {\r\n    'use strict';\r\n\r\n    // Get Fishbowl properties\r\n    const FB_DATE_FORMAT = typeof getProperty === 'function' ? getProperty('DateFormatShort', 'MM/dd/yyyy') : 'MM/dd/yyyy';\r\n    // Convert Java SimpleDateFormat to Moment.js format (dd→DD, yyyy→YYYY)\r\n    const MOMENT_DATE_FORMAT = FB_DATE_FORMAT\r\n        .replace(/yyyy/g, 'YYYY')\r\n        .replace(/yy/g, 'YY')\r\n        .replace(/dd/g, 'DD');\r\n    const BI_SHOW_DEBUG_PROP = typeof getProperty === 'function' ? getProperty('BI_SHOW_DEBUG', 'false') : 'false';\r\n    const DEBUG_MODE = BI_SHOW_DEBUG_PROP === 'true' || BI_SHOW_DEBUG_PROP === true;\r\n\r\n    /**\r\n     * Format date from SQL format to display format using DateFormatShort property\r\n     * @param {string} dateStr - Date string in YYYY-MM-DD HH:mm:ss format\r\n     * @returns {string} Formatted date string\r\n     */\r\n    function formatDate(dateStr) {\r\n        if (!dateStr) return '';\r\n        return moment(dateStr).format(MOMENT_DATE_FORMAT);\r\n    }\r\n\r\n    /**\r\n     * Get schedule status color for indicator\r\n     * @param {string} dateStr - Date string in SQL format\r\n     * @returns {string} Color code: 'red', 'orange', 'blue', or ''\r\n     */\r\n    function getScheduleStatus(dateStr) {\r\n        if (!dateStr) return '';\r\n\r\n        // Parse date from SQL format (YYYY-MM-DD HH:mm:ss)\r\n        var dateParts = dateStr.split(' ')[0].split('-');\r\n        var schedDate = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);\r\n        schedDate.setHours(0, 0, 0, 0);\r\n\r\n        var today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n\r\n        // Check if today\r\n        if (schedDate.getTime() === today.getTime()) {\r\n            return 'orange';\r\n        }\r\n\r\n        // Check if past\r\n        if (schedDate < today) {\r\n            return 'red';\r\n        }\r\n\r\n        // Check if within this calendar week (Sunday to Saturday)\r\n        var todayDay = today.getDay(); // 0 = Sunday, 6 = Saturday\r\n        var weekStart = new Date(today);\r\n        weekStart.setDate(today.getDate() - todayDay);\r\n        var weekEnd = new Date(weekStart);\r\n        weekEnd.setDate(weekStart.getDate() + 6);\r\n\r\n        if (schedDate >= weekStart && schedDate <= weekEnd) {\r\n            return 'blue';\r\n        }\r\n\r\n        return '';\r\n    }\r\n\r\n    /**\r\n     * Get status title for availability tooltip (for Picks, RMAs)\r\n     * @param {string} status - Status code\r\n     * @param {number} fullItems - Count of fully available items\r\n     * @param {number} partialItems - Count of partially available items\r\n     * @param {number} noneItems - Count of unavailable items\r\n     * @param {number} pendingItems - Count of pending items\r\n     * @returns {string} Tooltip text\r\n     */\r\n    function getStatusTitle(status, fullItems, partialItems, noneItems, pendingItems) {\r\n        if (status === 'committed') {\r\n            return 'All items committed (' + pendingItems + ' items)';\r\n        } else if (status === 'green') {\r\n            return 'All pending items available (' + fullItems + '/' + pendingItems + ')';\r\n        } else if (status === 'red') {\r\n            return 'No pending items available (0/' + pendingItems + ')';\r\n        } else if (status === 'orange') {\r\n            return 'Partially available (' + fullItems + ' full, ' + partialItems + ' partial, ' + noneItems + ' none of ' + pendingItems + ' pending)';\r\n        } else {\r\n            return 'No pending items (all finished)';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create schedule indicator SVG icon\r\n     * @param {string} scheduleStatus - Color status: 'red', 'orange', 'blue'\r\n     * @param {string} dateStr - Original date string for title\r\n     * @returns {HTMLElement} SVG element or empty span\r\n     */\r\n    function createScheduleIndicator(scheduleStatus, dateStr) {\r\n        var td = document.createElement('td');\r\n        td.style.textAlign = 'center';\r\n\r\n        if (scheduleStatus) {\r\n            var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n            svg.setAttribute('class', 'clock-icon');\r\n            svg.setAttribute('viewBox', '0 0 24 24');\r\n            svg.setAttribute('fill', 'currentColor');\r\n            svg.style.width = '20px';\r\n            svg.style.height = '20px';\r\n            if (scheduleStatus === 'blue') svg.style.color = '#2d9cdb';\r\n            else if (scheduleStatus === 'orange') svg.style.color = '#f59e0b';\r\n            else if (scheduleStatus === 'red') svg.style.color = '#ef4444';\r\n\r\n            var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n            path.setAttribute('d', 'M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z');\r\n            path.setAttribute('fill', 'none');\r\n            path.setAttribute('stroke', 'currentColor');\r\n            path.setAttribute('stroke-width', '1.8');\r\n            path.setAttribute('stroke-linecap', 'round');\r\n            path.setAttribute('stroke-linejoin', 'round');\r\n            svg.appendChild(path);\r\n            td.appendChild(svg);\r\n\r\n            if (scheduleStatus === 'orange') td.title = 'Scheduled for today';\r\n            else if (scheduleStatus === 'red') td.title = 'Past due';\r\n            else if (scheduleStatus === 'blue') td.title = 'Scheduled this week';\r\n        }\r\n\r\n        return td;\r\n    }\r\n\r\n    /**\r\n     * Create availability status indicator (for Picks, RMAs)\r\n     * @param {object} row - Data row containing availability status\r\n     * @returns {HTMLElement} TD element with status indicator\r\n     */\r\n    function createAvailabilityIndicator(row) {\r\n        var td = document.createElement('td');\r\n\r\n        if (row.availabilitystatus === 'committed') {\r\n            var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n            svg.setAttribute('class', 'status-icon-padlock');\r\n            svg.setAttribute('viewBox', '0 0 16 16');\r\n            svg.setAttribute('fill', 'currentColor');\r\n            svg.style.color = '#f59e0b';\r\n            svg.setAttribute('title', getStatusTitle(row.availabilitystatus, row.fullitems, row.partialitems, row.noneitems, row.pendingitems));\r\n            var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n            path.setAttribute('fill-rule', 'evenodd');\r\n            path.setAttribute('d', 'M5 6.5V4.5a3 3 0 1 1 6 0V6.5h1.5V4.5a4.5 4.5 0 0 0-9 0V6.5H5zM2.5 8A1.5 1.5 0 0 1 4 6.5h8A1.5 1.5 0 0 1 13.5 8v5.5a1.5 1.5 0 0 1-1.5 1.5H4a1.5 1.5 0 0 1-1.5-1.5V8zm10 0a.5.5 0 0 0-.5-.5H4a.5.5 0 0 0-.5.5v5.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5V8z');\r\n            svg.appendChild(path);\r\n            td.appendChild(svg);\r\n        } else {\r\n            var circle = document.createElement('div');\r\n            circle.className = 'status-circle ' + (row.availabilitystatus || 'gray');\r\n            circle.title = getStatusTitle(row.availabilitystatus, row.fullitems, row.partialitems, row.noneitems, row.pendingitems);\r\n            td.appendChild(circle);\r\n        }\r\n\r\n        return td;\r\n    }\r\n\r\n    /**\r\n     * Debug logging utility\r\n     * @param {string} message - Log message\r\n     * @param {string} type - Message type: 'info', 'success', 'warning', 'error', 'query'\r\n     * @param {string} tileId - ID of the tile logging the message\r\n     */\r\n    function debugLog(message, type, tileId) {\r\n        if (!DEBUG_MODE) return;\r\n\r\n        var logDiv = document.getElementById('debugLog');\r\n        if (!logDiv) return;\r\n\r\n        var timestamp = new Date().toLocaleTimeString();\r\n\r\n        var placeholder = logDiv.querySelector('[style*=\"italic\"]');\r\n        if (placeholder) {\r\n            logDiv.innerHTML = '';\r\n        }\r\n\r\n        var colors = {\r\n            'info': '#60a5fa',\r\n            'success': '#34d399',\r\n            'warning': '#fbbf24',\r\n            'error': '#f87171',\r\n            'query': '#a78bfa'\r\n        };\r\n\r\n        var entry = document.createElement('div');\r\n        entry.style.marginBottom = '4px';\r\n        var tilePrefix = tileId ? '[' + tileId + '] ' : '';\r\n        entry.innerHTML = '<span style=\"color: #64748b;\">[' + timestamp + ']</span> ' +\r\n                         '<span style=\"color: #94a3b8;\">' + tilePrefix + '</span>' +\r\n                         '<span style=\"color: ' + colors[type] + ';\">' + message + '</span>';\r\n\r\n        logDiv.appendChild(entry);\r\n        logDiv.scrollTop = logDiv.scrollHeight;\r\n    }\r\n\r\n    /**\r\n     * Clear debug log\r\n     */\r\n    function clearDebugLog() {\r\n        var logDiv = document.getElementById('debugLog');\r\n        if (logDiv) {\r\n            logDiv.innerHTML = '<div style=\"color: #64748b; font-style: italic;\">Log cleared...</div>';\r\n        }\r\n    }\r\n\r\n    // Public API\r\n    return {\r\n        DEBUG_MODE: DEBUG_MODE,\r\n        FB_DATE_FORMAT: FB_DATE_FORMAT,\r\n        MOMENT_DATE_FORMAT: MOMENT_DATE_FORMAT,\r\n        formatDate: formatDate,\r\n        getScheduleStatus: getScheduleStatus,\r\n        getStatusTitle: getStatusTitle,\r\n        createScheduleIndicator: createScheduleIndicator,\r\n        createAvailabilityIndicator: createAvailabilityIndicator,\r\n        debugLog: debugLog,\r\n        clearDebugLog: clearDebugLog\r\n    };\r\n})();\r\n    </script>\r\n\r\n    <script>\r\n        // ============================================================================\r\n        // EMBEDDED SCRIPTS - Report Modules\r\n        // ============================================================================\r\n/**\r\n * Sales Orders Dashboard Module\r\n * Displays open sales orders with filtering, sorting, and click-through\r\n */\r\n\r\nwindow.ReportSO = (function() {\r\n    'use strict';\r\n\r\n    // Private variables\r\n    let containerId = '';\r\n    let allData = [];\r\n    let filteredData = [];\r\n    let sortColumn = 'dateissued';\r\n    let sortDirection = 'desc';\r\n\r\n    // Get properties\r\n    const HIDE_ESTIMATES_DEFAULT = false;\r\n    const BI_SO_SHOW_ESTIMATE_PROP = getProperty('BI_SO_SHOW_ESTIMATE', HIDE_ESTIMATES_DEFAULT ? 'false' : 'true');\r\n    const HIDE_ESTIMATES = BI_SO_SHOW_ESTIMATE_PROP === 'false' || BI_SO_SHOW_ESTIMATE_PROP === false;\r\n\r\n    /**\r\n     * Initialize the Sales Orders tile\r\n     * @param {string} container - ID of the container element\r\n     */\r\n    function init(container) {\r\n        containerId = container;\r\n        DashboardCommon.debugLog('Initializing Sales Orders module', 'info', 'SO');\r\n        setupUI();\r\n        loadData();\r\n    }\r\n\r\n    /**\r\n     * Setup the UI structure\r\n     */\r\n    function setupUI() {\r\n        const container = document.getElementById(containerId);\r\n        if (!container) {\r\n            DashboardCommon.debugLog('Container not found: ' + containerId, 'error', 'SO');\r\n            return;\r\n        }\r\n\r\n        container.innerHTML = `\r\n            <div class=\"tile-header\">\r\n                <div>\r\n                    <h2 class=\"tile-title\">Open Sales Orders</h2>\r\n                </div>\r\n                <div class=\"tile-controls\">\r\n                    <label class=\"hide-estimates-label\">\r\n                        <input type=\"checkbox\" id=\"${containerId}-hideEstimates\" ${HIDE_ESTIMATES ? 'checked' : ''}>\r\n                        Hide Estimates\r\n                    </label>\r\n                    <span id=\"${containerId}-filterInfo\" class=\"filter-info\" style=\"display: none;\"></span>\r\n                    <button class=\"btn\" onclick=\"ReportSO.clearFilters()\">Clear Filters</button>\r\n                    <button class=\"btn btn-primary\" onclick=\"ReportSO.refresh()\">Refresh</button>\r\n                </div>\r\n            </div>\r\n            <div class=\"tile-table-container\">\r\n                <table class=\"tile-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th data-column=\"scheduleindicator\" class=\"schedule-col\" onclick=\"ReportSO.sortTable('datefirstship')\" title=\"Schedule Status\">\r\n                                <svg class=\"clock-icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                                    <path d=\"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z\"/>\r\n                                </svg>\r\n                            </th>\r\n                            <th data-column=\"statusname\" onclick=\"ReportSO.sortTable('statusname')\">Status <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"num\" onclick=\"ReportSO.sortTable('num')\">Number <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"datefirstship\" onclick=\"ReportSO.sortTable('datefirstship')\">Date Scheduled <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"dateissued\" onclick=\"ReportSO.sortTable('dateissued')\">Date Issued <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"customername\" onclick=\"ReportSO.sortTable('customername')\">Customer <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"customerpo\" onclick=\"ReportSO.sortTable('customerpo')\">Customer PO <span class=\"sort-icon\">⇅</span></th>\r\n                        </tr>\r\n                        <tr class=\"filter-row\">\r\n                            <td data-filter=\"scheduleindicator\"></td>\r\n                            <td><input type=\"text\" data-filter=\"statusname\" placeholder=\"Filter...\" onkeyup=\"ReportSO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"num\" placeholder=\"Filter...\" onkeyup=\"ReportSO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"datefirstship\" placeholder=\"Filter...\" onkeyup=\"ReportSO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"dateissued\" placeholder=\"Filter...\" onkeyup=\"ReportSO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"customername\" placeholder=\"Filter...\" onkeyup=\"ReportSO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"customerpo\" placeholder=\"Filter...\" onkeyup=\"ReportSO.applyFilters()\"></td>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody id=\"${containerId}-tableBody\">\r\n                        <tr>\r\n                            <td colspan=\"7\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">Loading...</td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        `;\r\n\r\n        // Add event listener for hide estimates checkbox\r\n        const checkbox = document.getElementById(containerId + '-hideEstimates');\r\n        if (checkbox) {\r\n            checkbox.addEventListener('change', applyFilters);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load sales orders data\r\n     */\r\n    function loadData() {\r\n        DashboardCommon.debugLog('Starting data load...', 'info', 'SO');\r\n\r\n        try {\r\n            // Get current user\r\n            const currentUser = JSON.parse(getUser());\r\n            const userId = currentUser.id;\r\n            DashboardCommon.debugLog('Current user ID: ' + userId, 'info', 'SO');\r\n\r\n            const query =\r\n                \"SELECT \" +\r\n                \"    So.Id AS id, \" +\r\n                \"    MAX(So.Num) AS num, \" +\r\n                \"    MAX(So.CustomerPO) AS customerPO, \" +\r\n                \"    MAX(So.DateIssued) AS dateIssued, \" +\r\n                \"    MAX(So.DateFirstShip) AS dateFirstShip, \" +\r\n                \"    MAX(Customer.Name) AS customerName, \" +\r\n                \"    MAX(SoStatus.Name) AS statusName, \" +\r\n                \"    GROUP_CONCAT(DISTINCT CASE WHEN Pick.Num IS NOT NULL THEN CONCAT(Pick.Num, ':', COALESCE(PickStatus.Id, 0), ':', COALESCE(PickStatus.Name, 'None')) END ORDER BY Pick.Num SEPARATOR '|') AS pickInfo, \" +\r\n                \"    GROUP_CONCAT(DISTINCT CASE WHEN Ship.Num IS NOT NULL THEN CONCAT(Ship.Num, ':', COALESCE(ShipStatus.Id, 0), ':', COALESCE(ShipStatus.Name, 'None')) END ORDER BY Ship.Num SEPARATOR '|') AS shipInfo \" +\r\n                \"FROM So \" +\r\n                \"LEFT JOIN Customer ON So.CustomerId = Customer.Id \" +\r\n                \"LEFT JOIN SoStatus ON So.StatusId = SoStatus.Id \" +\r\n                \"LEFT JOIN SoItem ON SoItem.SoId = So.Id \" +\r\n                \"LEFT JOIN PickItem ON PickItem.SoItemId = SoItem.Id \" +\r\n                \"LEFT JOIN Pick ON Pick.Id = PickItem.PickId \" +\r\n                \"LEFT JOIN PickStatus ON Pick.StatusId = PickStatus.Id \" +\r\n                \"LEFT JOIN Ship ON Ship.SoId = So.Id \" +\r\n                \"LEFT JOIN ShipStatus ON Ship.StatusId = ShipStatus.Id \" +\r\n                \"INNER JOIN UserToLG ON So.LocationGroupId = UserToLG.LocationGroupId AND UserToLG.UserId = \" + userId + \" \" +\r\n                \"WHERE SoStatus.Name IN ('Estimate', 'In Progress', 'Issued') \" +\r\n                \"GROUP BY So.Id \" +\r\n                \"ORDER BY MAX(So.DateIssued) DESC\";\r\n\r\n            DashboardCommon.debugLog('Executing SQL query...', 'query', 'SO');\r\n\r\n            const queryResult = runQuery(query);\r\n            const result = JSON.parse(queryResult);\r\n\r\n            DashboardCommon.debugLog('Parsed ' + result.length + ' records', 'success', 'SO');\r\n\r\n            allData = result;\r\n            applyFilters();\r\n\r\n            DashboardCommon.debugLog('Load complete: ' + filteredData.length + ' orders displayed', 'success', 'SO');\r\n\r\n        } catch (error) {\r\n            DashboardCommon.debugLog('ERROR: ' + error.message, 'error', 'SO');\r\n            console.error('Error loading sales orders:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply filters to data\r\n     */\r\n    function applyFilters() {\r\n        const hideEstimatesCheckbox = document.getElementById(containerId + '-hideEstimates');\r\n        const hideEstimates = hideEstimatesCheckbox ? hideEstimatesCheckbox.checked : false;\r\n\r\n        filteredData = allData.filter(function(row) {\r\n            // Compute display status for this row (needed for filtering)\r\n            const statusInfo = calculatePickShipStatus(row);\r\n            row.displayStatus = statusInfo.displayStatus;\r\n\r\n            // Hide estimates filter - check both raw status and display status\r\n            if (hideEstimates && (row.statusname === 'Estimate' || row.displayStatus === 'Estimate')) {\r\n                return false;\r\n            }\r\n\r\n            // Column filters\r\n            const container = document.getElementById(containerId);\r\n            const filterInputs = container.querySelectorAll('.filter-row input[data-filter]');\r\n            for (let i = 0; i < filterInputs.length; i++) {\r\n                const input = filterInputs[i];\r\n                if (input.value) {\r\n                    const filterKey = input.getAttribute('data-filter');\r\n                    let cellValue;\r\n\r\n                    // For statusname column, filter on display status\r\n                    if (filterKey === 'statusname') {\r\n                        cellValue = (row.displayStatus || '').toString().toLowerCase();\r\n                    } else if (filterKey === 'dateissued' || filterKey === 'datefirstship') {\r\n                        // For date columns, filter on formatted date\r\n                        cellValue = DashboardCommon.formatDate(row[filterKey]).toLowerCase();\r\n                    } else {\r\n                        cellValue = (row[filterKey] || '').toString().toLowerCase();\r\n                    }\r\n\r\n                    const filterValue = input.value.toLowerCase();\r\n                    if (cellValue.indexOf(filterValue) === -1) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        });\r\n\r\n        updateFilterInfo();\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Update filter info display\r\n     */\r\n    function updateFilterInfo() {\r\n        const filterInfo = document.getElementById(containerId + '-filterInfo');\r\n        if (!filterInfo) return;\r\n\r\n        if (allData.length !== filteredData.length) {\r\n            filterInfo.textContent = 'Showing ' + filteredData.length + ' of ' + allData.length + ' orders';\r\n            filterInfo.style.display = 'inline-block';\r\n        } else {\r\n            filterInfo.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all filters\r\n     */\r\n    function clearFilters() {\r\n        const checkbox = document.getElementById(containerId + '-hideEstimates');\r\n        if (checkbox) checkbox.checked = false;\r\n\r\n        const container = document.getElementById(containerId);\r\n        const inputs = container.querySelectorAll('.filter-row input');\r\n        for (let i = 0; i < inputs.length; i++) {\r\n            inputs[i].value = '';\r\n        }\r\n        applyFilters();\r\n    }\r\n\r\n    /**\r\n     * Sort table by column\r\n     * @param {string} column - Column name to sort by\r\n     */\r\n    function sortTable(column) {\r\n        if (sortColumn === column) {\r\n            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';\r\n        } else {\r\n            sortColumn = column;\r\n            sortDirection = 'asc';\r\n        }\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Sort data and render table\r\n     */\r\n    function sortAndRender() {\r\n        filteredData.sort(function(a, b) {\r\n            const aVal = a[sortColumn] || '';\r\n            const bVal = b[sortColumn] || '';\r\n\r\n            if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;\r\n            if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;\r\n            return 0;\r\n        });\r\n\r\n        renderTable();\r\n    }\r\n\r\n    /**\r\n     * Map pick status names to user-friendly display names\r\n     * @param {string} pickStatusName - Original pick status name\r\n     * @returns {string} User-friendly status name\r\n     */\r\n    function mapPickStatusToDisplay(pickStatusName) {\r\n        if (pickStatusName === 'Entered') return 'To Pick';\r\n        if (pickStatusName === 'Started') return 'Picking';\r\n        return pickStatusName;\r\n    }\r\n\r\n    /**\r\n     * Calculate display status based on pick and ship progression\r\n     * @param {object} row - Data row with pickInfo and shipInfo\r\n     * @returns {object} {displayStatus, tooltip, isPartial}\r\n     */\r\n    function calculatePickShipStatus(row) {\r\n        const pickInfo = row.pickinfo || '';\r\n        const shipInfo = row.shipinfo || '';\r\n\r\n        // If no pick info, return original SO status\r\n        if (!pickInfo || pickInfo === 'null') {\r\n            return {\r\n                displayStatus: row.statusname,\r\n                tooltip: row.statusname,\r\n                isPartial: false\r\n            };\r\n        }\r\n\r\n        // Parse pick information: \"pickNum:statusId:statusName|pickNum2:statusId2:statusName2\"\r\n        const picks = pickInfo.split('|').map(function(p) {\r\n            const parts = p.split(':');\r\n            return {\r\n                num: parts[0],\r\n                statusId: parseInt(parts[1]),\r\n                statusName: parts[2]\r\n            };\r\n        }).filter(function(p) {\r\n            return p.num && p.statusId > 0; // Filter out null/empty picks\r\n        });\r\n\r\n        // Parse ship information\r\n        const ships = shipInfo && shipInfo !== 'null' ? shipInfo.split('|').map(function(s) {\r\n            const parts = s.split(':');\r\n            return {\r\n                num: parts[0],\r\n                statusId: parseInt(parts[1]),\r\n                statusName: parts[2]\r\n            };\r\n        }).filter(function(s) {\r\n            return s.num && s.statusId > 0; // Filter out null/empty ships\r\n        }) : [];\r\n\r\n        // Build tooltip\r\n        let tooltipParts = [];\r\n        if (picks.length > 0) {\r\n            tooltipParts.push('Picks:');\r\n            picks.forEach(function(p) {\r\n                tooltipParts.push('  Pick ' + p.num + ': ' + p.statusName);\r\n            });\r\n        }\r\n        if (ships.length > 0) {\r\n            tooltipParts.push('Shipments:');\r\n            ships.forEach(function(s) {\r\n                tooltipParts.push('  Ship ' + s.num + ': ' + s.statusName);\r\n            });\r\n        }\r\n        const tooltip = tooltipParts.join('\\n');\r\n\r\n        // No picks found\r\n        if (picks.length === 0) {\r\n            return {\r\n                displayStatus: row.statusname,\r\n                tooltip: tooltip || row.statusname,\r\n                isPartial: false\r\n            };\r\n        }\r\n\r\n        // Check if all picks are Finished (statusId = 40)\r\n        const allPicksFinished = picks.every(function(p) {\r\n            return p.statusId === 40;\r\n        });\r\n\r\n        if (allPicksFinished) {\r\n            // All picks finished, check ship status\r\n            if (ships.length > 0) {\r\n                // Find the most advanced ship status\r\n                const maxShipStatus = Math.max.apply(Math, ships.map(function(s) { return s.statusId; }));\r\n\r\n                if (maxShipStatus === 30) {\r\n                    return { displayStatus: 'Shipped', tooltip: tooltip, isPartial: false };\r\n                } else if (maxShipStatus === 20) {\r\n                    return { displayStatus: 'Packed', tooltip: tooltip, isPartial: false };\r\n                } else if (maxShipStatus === 10) {\r\n                    return { displayStatus: 'Picked', tooltip: tooltip, isPartial: false };\r\n                }\r\n            } else {\r\n                // Picks finished but no ship yet - show \"Picked\"\r\n                return { displayStatus: 'Picked', tooltip: tooltip, isPartial: false };\r\n            }\r\n        }\r\n\r\n        // Not all picks finished - find the incomplete pick with lowest status\r\n        const incompletePicks = picks.filter(function(p) {\r\n            return p.statusId < 40;\r\n        });\r\n\r\n        if (incompletePicks.length > 0) {\r\n            // Find the pick with the lowest status (most behind)\r\n            const minStatus = Math.min.apply(Math, incompletePicks.map(function(p) { return p.statusId; }));\r\n            const incompletePickStatus = incompletePicks.find(function(p) {\r\n                return p.statusId === minStatus;\r\n            }).statusName;\r\n\r\n            // Map to user-friendly display name\r\n            const displayName = mapPickStatusToDisplay(incompletePickStatus);\r\n\r\n            // Show with asterisk to indicate partial\r\n            const isPartial = picks.length > 1;\r\n            return {\r\n                displayStatus: displayName + (isPartial ? ' *' : ''),\r\n                tooltip: tooltip,\r\n                isPartial: isPartial\r\n            };\r\n        }\r\n\r\n        // Fallback to SO status\r\n        return {\r\n            displayStatus: row.statusname,\r\n            tooltip: tooltip || row.statusname,\r\n            isPartial: false\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create cell content for a column\r\n     * @param {object} row - Data row\r\n     * @param {string} column - Column name\r\n     * @returns {HTMLElement} TD element\r\n     */\r\n    function createCellContent(row, column) {\r\n        const td = document.createElement('td');\r\n\r\n        if (column === 'statusname') {\r\n            // Calculate pick/ship progression status\r\n            const statusInfo = calculatePickShipStatus(row);\r\n            const displayStatus = statusInfo.displayStatus;\r\n            const tooltip = statusInfo.tooltip;\r\n\r\n            let statusClass = 'status-badge';\r\n\r\n            // Apply CSS classes based on display status\r\n            const statusLower = displayStatus.toLowerCase().replace(' *', '');\r\n            if (statusLower === 'estimate') statusClass += ' status-estimate';\r\n            else if (statusLower === 'in progress') statusClass += ' status-inprogress';\r\n            else if (statusLower === 'issued') statusClass += ' status-issued';\r\n            else if (statusLower === 'entered' || statusLower === 'to pick') statusClass += ' status-entered';\r\n            else if (statusLower === 'started' || statusLower === 'picking') statusClass += ' status-started';\r\n            else if (statusLower === 'committed') statusClass += ' status-committed';\r\n            else if (statusLower === 'finished' || statusLower === 'picked') statusClass += ' status-picked';\r\n            else if (statusLower === 'packed') statusClass += ' status-packed';\r\n            else if (statusLower === 'shipped') statusClass += ' status-shipped';\r\n\r\n            const badge = document.createElement('span');\r\n            badge.className = statusClass;\r\n            badge.textContent = displayStatus || '';\r\n            td.appendChild(badge);\r\n            td.title = tooltip || displayStatus || '';\r\n        } else if (column === 'scheduleindicator') {\r\n            const scheduleStatus = DashboardCommon.getScheduleStatus(row.datefirstship);\r\n            return DashboardCommon.createScheduleIndicator(scheduleStatus, row.datefirstship);\r\n        } else if (column === 'num') {\r\n            const orderLink = document.createElement('a');\r\n            orderLink.href = '#';\r\n            orderLink.className = 'order-link';\r\n            orderLink.textContent = row.num;\r\n            orderLink.onclick = function(e) {\r\n                e.preventDefault();\r\n                openSO(row.num);\r\n                return false;\r\n            };\r\n            td.appendChild(orderLink);\r\n            td.title = row.num;\r\n        } else if (column === 'customername') {\r\n            td.textContent = row.customername || '';\r\n            td.title = row.customername || '';\r\n        } else if (column === 'customerpo') {\r\n            td.textContent = row.customerpo || '';\r\n            td.title = row.customerpo || '';\r\n        } else if (column === 'dateissued' || column === 'datefirstship') {\r\n            td.textContent = DashboardCommon.formatDate(row[column]);\r\n            td.title = DashboardCommon.formatDate(row[column]);\r\n        }\r\n\r\n        return td;\r\n    }\r\n\r\n    /**\r\n     * Render table with current data\r\n     */\r\n    function renderTable() {\r\n        const tbody = document.getElementById(containerId + '-tableBody');\r\n        if (!tbody) return;\r\n\r\n        tbody.innerHTML = '';\r\n\r\n        if (filteredData.length === 0) {\r\n            tbody.innerHTML = '<tr><td colspan=\"7\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">No sales orders found</td></tr>';\r\n            return;\r\n        }\r\n\r\n        const columnOrder = ['scheduleindicator', 'statusname', 'num', 'datefirstship', 'dateissued', 'customername', 'customerpo'];\r\n\r\n        for (let i = 0; i < filteredData.length; i++) {\r\n            const row = filteredData[i];\r\n            const tr = document.createElement('tr');\r\n\r\n            for (let j = 0; j < columnOrder.length; j++) {\r\n                const cell = createCellContent(row, columnOrder[j]);\r\n                tr.appendChild(cell);\r\n            }\r\n\r\n            tbody.appendChild(tr);\r\n        }\r\n\r\n        DashboardCommon.debugLog('Rendered ' + filteredData.length + ' rows', 'success', 'SO');\r\n    }\r\n\r\n    /**\r\n     * Open sales order in Fishbowl\r\n     * @param {string} orderNum - Order number\r\n     */\r\n    function openSO(orderNum) {\r\n        openModule(\"Sales Order\", orderNum);\r\n    }\r\n\r\n    /**\r\n     * Refresh data\r\n     */\r\n    function refresh() {\r\n        loadData();\r\n    }\r\n\r\n    // Public API\r\n    return {\r\n        init: init,\r\n        refresh: refresh,\r\n        applyFilters: applyFilters,\r\n        clearFilters: clearFilters,\r\n        sortTable: sortTable\r\n    };\r\n})();\r\n\r\n/**\r\n * Purchase Orders Dashboard Module\r\n * Displays open purchase orders with filtering, sorting, and click-through\r\n */\r\n\r\nwindow.ReportPO = (function() {\r\n    'use strict';\r\n\r\n    // Private variables\r\n    let containerId = '';\r\n    let allData = [];\r\n    let filteredData = [];\r\n    let sortColumn = 'dateissued';\r\n    let sortDirection = 'desc';\r\n\r\n    // Get properties\r\n    const HIDE_BID_REQUESTS_DEFAULT = false;\r\n    const BI_PO_SHOW_BID_REQUEST_PROP = getProperty('BI_PO_SHOW_BID_REQUEST', HIDE_BID_REQUESTS_DEFAULT ? 'false' : 'true');\r\n    const HIDE_BID_REQUESTS = BI_PO_SHOW_BID_REQUEST_PROP === 'false' || BI_PO_SHOW_BID_REQUEST_PROP === false;\r\n\r\n    /**\r\n     * Initialize the Purchase Orders tile\r\n     * @param {string} container - ID of the container element\r\n     */\r\n    function init(container) {\r\n        containerId = container;\r\n        DashboardCommon.debugLog('Initializing Purchase Orders module', 'info', 'PO');\r\n        setupUI();\r\n        loadData();\r\n    }\r\n\r\n    /**\r\n     * Setup the UI structure\r\n     */\r\n    function setupUI() {\r\n        const container = document.getElementById(containerId);\r\n        if (!container) {\r\n            DashboardCommon.debugLog('Container not found: ' + containerId, 'error', 'PO');\r\n            return;\r\n        }\r\n\r\n        container.innerHTML = `\r\n            <div class=\"tile-header\">\r\n                <div>\r\n                    <h2 class=\"tile-title\">Open Purchase Orders</h2>\r\n                </div>\r\n                <div class=\"tile-controls\">\r\n                    <label class=\"hide-estimates-label\">\r\n                        <input type=\"checkbox\" id=\"${containerId}-hideBidRequests\" ${HIDE_BID_REQUESTS ? 'checked' : ''}>\r\n                        Hide Bid Requests\r\n                    </label>\r\n                    <span id=\"${containerId}-filterInfo\" class=\"filter-info\" style=\"display: none;\"></span>\r\n                    <button class=\"btn\" onclick=\"ReportPO.clearFilters()\">Clear Filters</button>\r\n                    <button class=\"btn btn-primary\" onclick=\"ReportPO.refresh()\">Refresh</button>\r\n                </div>\r\n            </div>\r\n            <div class=\"tile-table-container\">\r\n                <table class=\"tile-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th data-column=\"scheduleindicator\" class=\"schedule-col\" onclick=\"ReportPO.sortTable('datescheduled')\" title=\"Schedule Status\">\r\n                                <svg class=\"clock-icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                                    <path d=\"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z\"/>\r\n                                </svg>\r\n                            </th>\r\n                            <th data-column=\"statusname\" onclick=\"ReportPO.sortTable('statusname')\">Status <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"num\" onclick=\"ReportPO.sortTable('num')\">Number <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"datescheduled\" onclick=\"ReportPO.sortTable('datescheduled')\">Date Scheduled <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"dateissued\" onclick=\"ReportPO.sortTable('dateissued')\">Date Issued <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"vendorname\" onclick=\"ReportPO.sortTable('vendorname')\">Vendor <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"customerso\" onclick=\"ReportPO.sortTable('customerso')\">Customer SO <span class=\"sort-icon\">⇅</span></th>\r\n                        </tr>\r\n                        <tr class=\"filter-row\">\r\n                            <td data-filter=\"scheduleindicator\"></td>\r\n                            <td><input type=\"text\" data-filter=\"statusname\" placeholder=\"Filter...\" onkeyup=\"ReportPO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"num\" placeholder=\"Filter...\" onkeyup=\"ReportPO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"datescheduled\" placeholder=\"Filter...\" onkeyup=\"ReportPO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"dateissued\" placeholder=\"Filter...\" onkeyup=\"ReportPO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"vendorname\" placeholder=\"Filter...\" onkeyup=\"ReportPO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"customerso\" placeholder=\"Filter...\" onkeyup=\"ReportPO.applyFilters()\"></td>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody id=\"${containerId}-tableBody\">\r\n                        <tr>\r\n                            <td colspan=\"7\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">Loading...</td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        `;\r\n\r\n        // Add event listener for hide bid requests checkbox\r\n        const checkbox = document.getElementById(containerId + '-hideBidRequests');\r\n        if (checkbox) {\r\n            checkbox.addEventListener('change', applyFilters);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load purchase orders data\r\n     */\r\n    function loadData() {\r\n        DashboardCommon.debugLog('Starting data load...', 'info', 'PO');\r\n\r\n        try {\r\n            // Get current user\r\n            const currentUser = JSON.parse(getUser());\r\n            const userId = currentUser.id;\r\n            DashboardCommon.debugLog('Current user ID: ' + userId, 'info', 'PO');\r\n\r\n            const query =\r\n                \"SELECT \" +\r\n                \"    Po.Id AS id, \" +\r\n                \"    Po.Num AS num, \" +\r\n                \"    Po.CustomerSO AS customerSO, \" +\r\n                \"    Po.DateIssued AS dateIssued, \" +\r\n                \"    Po.DateFirstShip AS dateScheduled, \" +\r\n                \"    Vendor.Name AS vendorName, \" +\r\n                \"    PoStatus.Name AS statusName \" +\r\n                \"FROM Po \" +\r\n                \"LEFT JOIN Vendor ON Po.VendorId = Vendor.Id \" +\r\n                \"LEFT JOIN PoStatus ON Po.StatusId = PoStatus.Id \" +\r\n                \"INNER JOIN UserToLG ON Po.LocationGroupId = UserToLG.LocationGroupId AND UserToLG.UserId = \" + userId + \" \" +\r\n                \"WHERE PoStatus.Name IN ('Bid Request', 'Pending Approval', 'Issued', 'Picking', 'Partial', 'Picked') \" +\r\n                \"ORDER BY Po.DateIssued DESC\";\r\n\r\n            DashboardCommon.debugLog('Executing SQL query...', 'query', 'PO');\r\n\r\n            const queryResult = runQuery(query);\r\n            const result = JSON.parse(queryResult);\r\n\r\n            DashboardCommon.debugLog('Parsed ' + result.length + ' records', 'success', 'PO');\r\n\r\n            allData = result;\r\n            applyFilters();\r\n\r\n            DashboardCommon.debugLog('Load complete: ' + filteredData.length + ' orders displayed', 'success', 'PO');\r\n\r\n        } catch (error) {\r\n            DashboardCommon.debugLog('ERROR: ' + error.message, 'error', 'PO');\r\n            console.error('Error loading purchase orders:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply filters to data\r\n     */\r\n    function applyFilters() {\r\n        const hideBidRequestsCheckbox = document.getElementById(containerId + '-hideBidRequests');\r\n        const hideBidRequests = hideBidRequestsCheckbox ? hideBidRequestsCheckbox.checked : false;\r\n\r\n        filteredData = allData.filter(function(row) {\r\n            // Hide bid requests filter\r\n            if (hideBidRequests && row.statusname === 'Bid Request') {\r\n                return false;\r\n            }\r\n\r\n            // Column filters\r\n            const container = document.getElementById(containerId);\r\n            const filterInputs = container.querySelectorAll('.filter-row input[data-filter]');\r\n            for (let i = 0; i < filterInputs.length; i++) {\r\n                const input = filterInputs[i];\r\n                if (input.value) {\r\n                    const filterKey = input.getAttribute('data-filter');\r\n                    let cellValue;\r\n\r\n                    // For date columns, filter on formatted date\r\n                    if (filterKey === 'dateissued' || filterKey === 'datescheduled') {\r\n                        cellValue = DashboardCommon.formatDate(row[filterKey]).toLowerCase();\r\n                    } else {\r\n                        cellValue = (row[filterKey] || '').toString().toLowerCase();\r\n                    }\r\n\r\n                    const filterValue = input.value.toLowerCase();\r\n                    if (cellValue.indexOf(filterValue) === -1) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        });\r\n\r\n        updateFilterInfo();\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Update filter info display (PO)\r\n     */\r\n    function updateFilterInfo() {\r\n        const filterInfo = document.getElementById(containerId + '-filterInfo');\r\n        if (!filterInfo) return;\r\n\r\n        if (allData.length !== filteredData.length) {\r\n            filterInfo.textContent = 'Showing ' + filteredData.length + ' of ' + allData.length + ' orders';\r\n            filterInfo.style.display = 'inline-block';\r\n        } else {\r\n            filterInfo.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all filters\r\n     */\r\n    function clearFilters() {\r\n        const checkbox = document.getElementById(containerId + '-hideBidRequests');\r\n        if (checkbox) checkbox.checked = false;\r\n\r\n        const container = document.getElementById(containerId);\r\n        const inputs = container.querySelectorAll('.filter-row input');\r\n        for (let i = 0; i < inputs.length; i++) {\r\n            inputs[i].value = '';\r\n        }\r\n        applyFilters();\r\n    }\r\n\r\n    /**\r\n     * Sort table by column\r\n     * @param {string} column - Column name to sort by\r\n     */\r\n    function sortTable(column) {\r\n        if (sortColumn === column) {\r\n            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';\r\n        } else {\r\n            sortColumn = column;\r\n            sortDirection = 'asc';\r\n        }\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Sort data and render table\r\n     */\r\n    function sortAndRender() {\r\n        filteredData.sort(function(a, b) {\r\n            const aVal = a[sortColumn] || '';\r\n            const bVal = b[sortColumn] || '';\r\n\r\n            if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;\r\n            if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;\r\n            return 0;\r\n        });\r\n\r\n        renderTable();\r\n    }\r\n\r\n    /**\r\n     * Create cell content for a column\r\n     * @param {object} row - Data row\r\n     * @param {string} column - Column name\r\n     * @returns {HTMLElement} TD element\r\n     */\r\n    function createCellContent(row, column) {\r\n        const td = document.createElement('td');\r\n\r\n        if (column === 'statusname') {\r\n            let statusClass = 'status-badge';\r\n            if (row.statusname === 'Bid Request') statusClass += ' status-estimate';\r\n            else if (row.statusname === 'Pending Approval') statusClass += ' status-estimate';\r\n            else if (row.statusname === 'Issued') statusClass += ' status-issued';\r\n            else if (row.statusname === 'Picking' || row.statusname === 'Partial') statusClass += ' status-inprogress';\r\n            else if (row.statusname === 'Picked') statusClass += ' status-issued';\r\n            const badge = document.createElement('span');\r\n            badge.className = statusClass;\r\n            badge.textContent = row.statusname || '';\r\n            td.appendChild(badge);\r\n            td.title = row.statusname || '';\r\n        } else if (column === 'scheduleindicator') {\r\n            const scheduleStatus = DashboardCommon.getScheduleStatus(row.datescheduled);\r\n            return DashboardCommon.createScheduleIndicator(scheduleStatus, row.datescheduled);\r\n        } else if (column === 'num') {\r\n            const orderLink = document.createElement('a');\r\n            orderLink.href = '#';\r\n            orderLink.className = 'order-link';\r\n            orderLink.textContent = row.num;\r\n            orderLink.onclick = function(e) {\r\n                e.preventDefault();\r\n                openPO(row.num);\r\n                return false;\r\n            };\r\n            td.appendChild(orderLink);\r\n            td.title = row.num;\r\n        } else if (column === 'vendorname' || column === 'customerso') {\r\n            td.textContent = row[column] || '';\r\n            td.title = row[column] || '';\r\n        } else if (column === 'dateissued' || column === 'datescheduled') {\r\n            td.textContent = DashboardCommon.formatDate(row[column]);\r\n            td.title = DashboardCommon.formatDate(row[column]);\r\n        }\r\n\r\n        return td;\r\n    }\r\n\r\n    /**\r\n     * Render table with current data\r\n     */\r\n    function renderTable() {\r\n        const tbody = document.getElementById(containerId + '-tableBody');\r\n        if (!tbody) return;\r\n\r\n        tbody.innerHTML = '';\r\n\r\n        if (filteredData.length === 0) {\r\n            tbody.innerHTML = '<tr><td colspan=\"7\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">No purchase orders found</td></tr>';\r\n            return;\r\n        }\r\n\r\n        const columnOrder = ['scheduleindicator', 'statusname', 'num', 'datescheduled', 'dateissued', 'vendorname', 'customerso'];\r\n\r\n        for (let i = 0; i < filteredData.length; i++) {\r\n            const row = filteredData[i];\r\n            const tr = document.createElement('tr');\r\n\r\n            for (let j = 0; j < columnOrder.length; j++) {\r\n                const cell = createCellContent(row, columnOrder[j]);\r\n                tr.appendChild(cell);\r\n            }\r\n\r\n            tbody.appendChild(tr);\r\n        }\r\n\r\n        DashboardCommon.debugLog('Rendered ' + filteredData.length + ' rows', 'success', 'PO');\r\n    }\r\n\r\n    /**\r\n     * Open purchase order in Fishbowl\r\n     * @param {string} orderNum - Order number\r\n     */\r\n    function openPO(orderNum) {\r\n        openModule(\"Purchase Order\", orderNum);\r\n    }\r\n\r\n    /**\r\n     * Refresh data\r\n     */\r\n    function refresh() {\r\n        loadData();\r\n    }\r\n\r\n    // Public API\r\n    return {\r\n        init: init,\r\n        refresh: refresh,\r\n        applyFilters: applyFilters,\r\n        clearFilters: clearFilters,\r\n        sortTable: sortTable\r\n    };\r\n})();\r\n\r\n/**\r\n * Work Orders Dashboard Module\r\n * Displays open work orders with filtering, sorting, and click-through\r\n */\r\n\r\nwindow.ReportWO = (function() {\r\n    'use strict';\r\n\r\n    // Private variables\r\n    let containerId = '';\r\n    let allData = [];\r\n    let filteredData = [];\r\n    let sortColumn = 'datescheduled';\r\n    let sortDirection = 'asc';\r\n\r\n    /**\r\n     * Initialize the Work Orders tile\r\n     * @param {string} container - ID of the container element\r\n     */\r\n    function init(container) {\r\n        containerId = container;\r\n        DashboardCommon.debugLog('Initializing Work Orders module', 'info', 'WO');\r\n        setupUI();\r\n        loadData();\r\n    }\r\n\r\n    /**\r\n     * Setup the UI structure\r\n     */\r\n    function setupUI() {\r\n        const container = document.getElementById(containerId);\r\n        if (!container) {\r\n            DashboardCommon.debugLog('Container not found: ' + containerId, 'error', 'WO');\r\n            return;\r\n        }\r\n\r\n        container.innerHTML = `\r\n            <div class=\"tile-header\">\r\n                <div>\r\n                    <h2 class=\"tile-title\">Open Work Orders</h2>\r\n                </div>\r\n                <div class=\"tile-controls\">\r\n                    <span id=\"${containerId}-filterInfo\" class=\"filter-info\" style=\"display: none;\"></span>\r\n                    <button class=\"btn\" onclick=\"ReportWO.clearFilters()\">Clear Filters</button>\r\n                    <button class=\"btn btn-primary\" onclick=\"ReportWO.refresh()\">Refresh</button>\r\n                </div>\r\n            </div>\r\n            <div class=\"tile-table-container\">\r\n                <table class=\"tile-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th data-column=\"scheduleindicator\" class=\"schedule-col\" onclick=\"ReportWO.sortTable('datescheduled')\" title=\"Schedule Status\">\r\n                                <svg class=\"clock-icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                                    <path d=\"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z\"/>\r\n                                </svg>\r\n                            </th>\r\n                            <th data-column=\"statusname\" onclick=\"ReportWO.sortTable('statusname')\">Status <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"monum\" onclick=\"ReportWO.sortTable('monum')\">MO # <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"num\" onclick=\"ReportWO.sortTable('num')\">WO # <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"bomnum\" onclick=\"ReportWO.sortTable('bomnum')\">BOM # <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"qty\" onclick=\"ReportWO.sortTable('qty')\">Qty <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"datescheduledtostart\" onclick=\"ReportWO.sortTable('datescheduledtostart')\">Start Date <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"datescheduled\" onclick=\"ReportWO.sortTable('datescheduled')\">Scheduled Date <span class=\"sort-icon\">⇅</span></th>\r\n                        </tr>\r\n                        <tr class=\"filter-row\">\r\n                            <td data-filter=\"scheduleindicator\"></td>\r\n                            <td><input type=\"text\" data-filter=\"statusname\" placeholder=\"Filter...\" onkeyup=\"ReportWO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"monum\" placeholder=\"Filter...\" onkeyup=\"ReportWO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"num\" placeholder=\"Filter...\" onkeyup=\"ReportWO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"bomnum\" placeholder=\"Filter...\" onkeyup=\"ReportWO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"qty\" placeholder=\"Filter...\" onkeyup=\"ReportWO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"datescheduledtostart\" placeholder=\"Filter...\" onkeyup=\"ReportWO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"datescheduled\" placeholder=\"Filter...\" onkeyup=\"ReportWO.applyFilters()\"></td>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody id=\"${containerId}-tableBody\">\r\n                        <tr>\r\n                            <td colspan=\"8\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">Loading...</td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Load work orders data\r\n     */\r\n    function loadData() {\r\n        DashboardCommon.debugLog('Starting data load...', 'info', 'WO');\r\n\r\n        try {\r\n            const currentUser = JSON.parse(getUser());\r\n            const userId = currentUser.id;\r\n            DashboardCommon.debugLog('Current user ID: ' + userId, 'info', 'WO');\r\n\r\n            const query =\r\n                \"SELECT \" +\r\n                \"    Wo.id AS id, \" +\r\n                \"    Wo.num AS num, \" +\r\n                \"    Wo.dateScheduled AS dateScheduled, \" +\r\n                \"    COALESCE(Wo.dateScheduledToStart, Wo.dateStarted) AS dateScheduledToStart, \" +\r\n                \"    WoStatus.Name AS statusName, \" +\r\n                \"    Mo.num AS moNum, \" +\r\n                \"    Bom.num AS bomNum, \" +\r\n                \"    MoItem.qtyToFulfill AS qty \" +\r\n                \"FROM Wo \" +\r\n                \"LEFT JOIN WoStatus ON Wo.statusId = WoStatus.Id \" +\r\n                \"LEFT JOIN MoItem ON Wo.moItemId = MoItem.id \" +\r\n                \"LEFT JOIN Mo ON MoItem.moId = Mo.id \" +\r\n                \"LEFT JOIN Bom ON MoItem.bomId = Bom.id \" +\r\n                \"INNER JOIN UserToLG ON Wo.locationGroupId = UserToLG.LocationGroupId AND UserToLG.UserId = \" + userId + \" \" +\r\n                \"WHERE Wo.statusId IN (10, 30) \" +\r\n                \"ORDER BY dateScheduled ASC\";\r\n\r\n            DashboardCommon.debugLog('Executing SQL query...', 'query', 'WO');\r\n\r\n            const queryResult = runQuery(query);\r\n            const result = JSON.parse(queryResult);\r\n\r\n            DashboardCommon.debugLog('Parsed ' + result.length + ' records', 'success', 'WO');\r\n\r\n            allData = result;\r\n            applyFilters();\r\n\r\n            DashboardCommon.debugLog('Load complete: ' + filteredData.length + ' work orders displayed', 'success', 'WO');\r\n\r\n        } catch (error) {\r\n            DashboardCommon.debugLog('ERROR: ' + error.message, 'error', 'WO');\r\n            console.error('Error loading work orders:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply filters to data (Work Orders)\r\n     */\r\n    function applyFilters() {\r\n        filteredData = allData.filter(function(row) {\r\n            const container = document.getElementById(containerId);\r\n            const filterInputs = container.querySelectorAll('.filter-row input[data-filter]');\r\n            for (let i = 0; i < filterInputs.length; i++) {\r\n                const input = filterInputs[i];\r\n                if (input.value) {\r\n                    const filterKey = input.getAttribute('data-filter');\r\n                    let cellValue;\r\n\r\n                    // For date columns, filter on formatted date\r\n                    if (filterKey === 'datescheduled' || filterKey === 'datescheduledtostart') {\r\n                        cellValue = DashboardCommon.formatDate(row[filterKey]).toLowerCase();\r\n                    } else {\r\n                        cellValue = (row[filterKey] || '').toString().toLowerCase();\r\n                    }\r\n\r\n                    const filterValue = input.value.toLowerCase();\r\n                    if (cellValue.indexOf(filterValue) === -1) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n\r\n        updateFilterInfo();\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Update filter info display (WO)\r\n     */\r\n    function updateFilterInfo() {\r\n        const filterInfo = document.getElementById(containerId + '-filterInfo');\r\n        if (!filterInfo) return;\r\n\r\n        if (allData.length !== filteredData.length) {\r\n            filterInfo.textContent = 'Showing ' + filteredData.length + ' of ' + allData.length + ' work orders';\r\n            filterInfo.style.display = 'inline-block';\r\n        } else {\r\n            filterInfo.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all filters\r\n     */\r\n    function clearFilters() {\r\n        const container = document.getElementById(containerId);\r\n        const inputs = container.querySelectorAll('.filter-row input');\r\n        for (let i = 0; i < inputs.length; i++) {\r\n            inputs[i].value = '';\r\n        }\r\n        applyFilters();\r\n    }\r\n\r\n    /**\r\n     * Sort table by column\r\n     * @param {string} column - Column name to sort by\r\n     */\r\n    function sortTable(column) {\r\n        if (sortColumn === column) {\r\n            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';\r\n        } else {\r\n            sortColumn = column;\r\n            sortDirection = 'asc';\r\n        }\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Sort data and render table\r\n     */\r\n    function sortAndRender() {\r\n        filteredData.sort(function(a, b) {\r\n            const aVal = a[sortColumn] || '';\r\n            const bVal = b[sortColumn] || '';\r\n\r\n            if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;\r\n            if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;\r\n            return 0;\r\n        });\r\n\r\n        renderTable();\r\n    }\r\n\r\n    /**\r\n     * Create cell content for a column\r\n     * @param {object} row - Data row\r\n     * @param {string} column - Column name\r\n     * @returns {HTMLElement} TD element\r\n     */\r\n    function createCellContent(row, column) {\r\n        const td = document.createElement('td');\r\n\r\n        if (column === 'scheduleindicator') {\r\n            const scheduleStatus = DashboardCommon.getScheduleStatus(row.datescheduled);\r\n            return DashboardCommon.createScheduleIndicator(scheduleStatus, row.datescheduled);\r\n        } else if (column === 'statusname') {\r\n            let statusClass = 'status-badge';\r\n            if (row.statusname === 'Entered') statusClass += ' status-estimate';\r\n            else if (row.statusname === 'Started') statusClass += ' status-started';\r\n            else if (row.statusname === 'Fulfilled') statusClass += ' status-issued';\r\n            const badge = document.createElement('span');\r\n            badge.className = statusClass;\r\n            badge.textContent = row.statusname || '';\r\n            td.appendChild(badge);\r\n            td.title = row.statusname || '';\r\n        } else if (column === 'num') {\r\n            const orderLink = document.createElement('a');\r\n            orderLink.href = '#';\r\n            orderLink.className = 'order-link';\r\n            orderLink.textContent = row.num;\r\n            orderLink.onclick = function(e) {\r\n                e.preventDefault();\r\n                openWO(row.num);\r\n                return false;\r\n            };\r\n            td.appendChild(orderLink);\r\n            td.title = row.num;\r\n        } else if (column === 'monum' || column === 'bomnum' || column === 'qty') {\r\n            td.textContent = row[column] || '';\r\n            td.title = row[column] || '';\r\n        } else if (column === 'datescheduled' || column === 'datescheduledtostart') {\r\n            td.textContent = DashboardCommon.formatDate(row[column]);\r\n            td.title = DashboardCommon.formatDate(row[column]);\r\n        }\r\n\r\n        return td;\r\n    }\r\n\r\n    /**\r\n     * Render table with current data\r\n     */\r\n    function renderTable() {\r\n        const tbody = document.getElementById(containerId + '-tableBody');\r\n        if (!tbody) return;\r\n\r\n        tbody.innerHTML = '';\r\n\r\n        if (filteredData.length === 0) {\r\n            tbody.innerHTML = '<tr><td colspan=\"8\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">No work orders found</td></tr>';\r\n            return;\r\n        }\r\n\r\n        const columnOrder = ['scheduleindicator', 'statusname', 'monum', 'num', 'bomnum', 'qty', 'datescheduledtostart', 'datescheduled'];\r\n\r\n        for (let i = 0; i < filteredData.length; i++) {\r\n            const row = filteredData[i];\r\n            const tr = document.createElement('tr');\r\n\r\n            for (let j = 0; j < columnOrder.length; j++) {\r\n                const cell = createCellContent(row, columnOrder[j]);\r\n                tr.appendChild(cell);\r\n            }\r\n\r\n            tbody.appendChild(tr);\r\n        }\r\n\r\n        DashboardCommon.debugLog('Rendered ' + filteredData.length + ' rows', 'success', 'WO');\r\n    }\r\n\r\n    /**\r\n     * Open work order in Fishbowl\r\n     * @param {string} orderNum - Order number\r\n     */\r\n    function openWO(orderNum) {\r\n        openModule(\"Work Order\", orderNum);\r\n    }\r\n\r\n    /**\r\n     * Refresh data\r\n     */\r\n    function refresh() {\r\n        loadData();\r\n    }\r\n\r\n    // Public API\r\n    return {\r\n        init: init,\r\n        refresh: refresh,\r\n        applyFilters: applyFilters,\r\n        clearFilters: clearFilters,\r\n        sortTable: sortTable\r\n    };\r\n})();\r\n/**\r\n * RMA Orders Dashboard Module\r\n * Displays open RMA orders with filtering, sorting, and click-through\r\n */\r\n\r\nwindow.ReportRMA = (function() {\r\n    'use strict';\r\n\r\n    // Private variables\r\n    let containerId = '';\r\n    let allData = [];\r\n    let filteredData = [];\r\n    let sortColumn = 'dateexpires';\r\n    let sortDirection = 'asc';\r\n\r\n    /**\r\n     * Initialize the RMA Orders tile\r\n     * @param {string} container - ID of the container element\r\n     */\r\n    function init(container) {\r\n        containerId = container;\r\n        DashboardCommon.debugLog('Initializing RMA Orders module', 'info', 'RMA');\r\n        setupUI();\r\n        loadData();\r\n    }\r\n\r\n    /**\r\n     * Setup the UI structure\r\n     */\r\n    function setupUI() {\r\n        const container = document.getElementById(containerId);\r\n        if (!container) {\r\n            DashboardCommon.debugLog('Container not found: ' + containerId, 'error', 'RMA');\r\n            return;\r\n        }\r\n\r\n        container.innerHTML = `\r\n            <div class=\"tile-header\">\r\n                <div>\r\n                    <h2 class=\"tile-title\">Open RMA Orders</h2>\r\n                </div>\r\n                <div class=\"tile-controls\">\r\n                    <span id=\"${containerId}-filterInfo\" class=\"filter-info\" style=\"display: none;\"></span>\r\n                    <button class=\"btn\" onclick=\"ReportRMA.clearFilters()\">Clear Filters</button>\r\n                    <button class=\"btn btn-primary\" onclick=\"ReportRMA.refresh()\">Refresh</button>\r\n                </div>\r\n            </div>\r\n            <div class=\"tile-table-container\">\r\n                <table class=\"tile-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th data-column=\"scheduleindicator\" class=\"schedule-col\" onclick=\"ReportRMA.sortTable('dateexpires')\" title=\"Schedule Status\">\r\n                                <svg class=\"clock-icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                                    <path d=\"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z\"/>\r\n                                </svg>\r\n                            </th>\r\n                            <th data-column=\"statusname\" onclick=\"ReportRMA.sortTable('statusname')\">Status <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"type\" onclick=\"ReportRMA.sortTable('type')\">Type <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"issue\" onclick=\"ReportRMA.sortTable('issue')\">Issue <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"num\" onclick=\"ReportRMA.sortTable('num')\">RMA # <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"product\" onclick=\"ReportRMA.sortTable('product')\">Product <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"qty\" onclick=\"ReportRMA.sortTable('qty')\">Qty <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"customername\" onclick=\"ReportRMA.sortTable('customername')\">Customer <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"datecreated\" onclick=\"ReportRMA.sortTable('datecreated')\">Date Created <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"dateexpires\" onclick=\"ReportRMA.sortTable('dateexpires')\">Date Expires <span class=\"sort-icon\">⇅</span></th>\r\n                        </tr>\r\n                        <tr class=\"filter-row\">\r\n                            <td data-filter=\"scheduleindicator\"></td>\r\n                            <td><input type=\"text\" data-filter=\"statusname\" placeholder=\"Filter...\" onkeyup=\"ReportRMA.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"type\" placeholder=\"Filter...\" onkeyup=\"ReportRMA.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"issue\" placeholder=\"Filter...\" onkeyup=\"ReportRMA.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"num\" placeholder=\"Filter...\" onkeyup=\"ReportRMA.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"product\" placeholder=\"Filter...\" onkeyup=\"ReportRMA.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"qty\" placeholder=\"Filter...\" onkeyup=\"ReportRMA.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"customername\" placeholder=\"Filter...\" onkeyup=\"ReportRMA.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"datecreated\" placeholder=\"Filter...\" onkeyup=\"ReportRMA.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"dateexpires\" placeholder=\"Filter...\" onkeyup=\"ReportRMA.applyFilters()\"></td>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody id=\"${containerId}-tableBody\">\r\n                        <tr>\r\n                            <td colspan=\"10\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">Loading...</td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Load RMA orders data\r\n     */\r\n    function loadData() {\r\n        DashboardCommon.debugLog('Starting data load...', 'info', 'RMA');\r\n\r\n        try {\r\n            const currentUser = JSON.parse(getUser());\r\n            const userId = currentUser.id;\r\n            DashboardCommon.debugLog('Current user ID: ' + userId, 'info', 'RMA');\r\n\r\n            const query =\r\n                \"SELECT \" +\r\n                \"    Rma.id AS rmaId, \" +\r\n                \"    Rma.num AS num, \" +\r\n                \"    Rma.dateCreated AS dateCreated, \" +\r\n                \"    Rma.dateExpires AS dateExpires, \" +\r\n                \"    RmaStatus.Name AS statusName, \" +\r\n                \"    Customer.Name AS customerName, \" +\r\n                \"    RmaItem.id AS rmaItemId, \" +\r\n                \"    RmaItem.typeId AS typeId, \" +\r\n                \"    RmaItem.issueId AS issueId, \" +\r\n                \"    RmaItemType.Name AS typeName, \" +\r\n                \"    CustomListItem.Name AS issueName, \" +\r\n                \"    RmaItem.productId AS productId, \" +\r\n                \"    Product.num AS productNum, \" +\r\n                \"    RmaItem.qty AS qty \" +\r\n                \"FROM Rma \" +\r\n                \"LEFT JOIN RmaStatus ON Rma.statusId = RmaStatus.Id \" +\r\n                \"LEFT JOIN Customer ON Rma.customerId = Customer.id \" +\r\n                \"LEFT JOIN RmaItem ON Rma.id = RmaItem.rmaId \" +\r\n                \"LEFT JOIN RmaItemType ON RmaItem.typeId = RmaItemType.Id \" +\r\n                \"LEFT JOIN CustomListItem ON RmaItem.issueId = CustomListItem.id AND CustomListItem.listId = 2 \" +\r\n                \"LEFT JOIN Product ON RmaItem.productId = Product.id \" +\r\n                \"INNER JOIN UserToLG ON Rma.locationGroupId = UserToLG.LocationGroupId AND UserToLG.UserId = \" + userId + \" \" +\r\n                \"WHERE Rma.statusId = 10 \" +\r\n                \"ORDER BY Rma.dateExpires ASC\";\r\n\r\n            DashboardCommon.debugLog('Executing SQL query...', 'query', 'RMA');\r\n\r\n            const queryResult = runQuery(query);\r\n            const result = JSON.parse(queryResult);\r\n\r\n            DashboardCommon.debugLog('Parsed ' + result.length + ' records', 'success', 'RMA');\r\n\r\n            // Group by RMA ID + Type ID + Issue ID\r\n            const grouped = {};\r\n            for (let i = 0; i < result.length; i++) {\r\n                const row = result[i];\r\n                const key = row.rmaid + '_' + row.typeid + '_' + row.issueid;\r\n\r\n                if (!grouped[key]) {\r\n                    grouped[key] = {\r\n                        rmaid: row.rmaid,\r\n                        num: row.num,\r\n                        datecreated: row.datecreated,\r\n                        dateexpires: row.dateexpires,\r\n                        statusname: row.statusname,\r\n                        customername: row.customername,\r\n                        typeid: row.typeid,\r\n                        typename: row.typename,\r\n                        type: row.typename || '',\r\n                        issueid: row.issueid,\r\n                        issue: row.issuename || '-',\r\n                        products: [],\r\n                        totalQty: 0\r\n                    };\r\n                }\r\n\r\n                grouped[key].products.push({\r\n                    productid: row.productid,\r\n                    productnum: row.productnum,\r\n                    qty: parseFloat(row.qty) || 0\r\n                });\r\n                grouped[key].totalQty += parseFloat(row.qty) || 0;\r\n            }\r\n\r\n            // Convert grouped object to array and determine product display\r\n            const processedData = [];\r\n            for (let key in grouped) {\r\n                const group = grouped[key];\r\n\r\n                if (group.products.length === 1) {\r\n                    group.product = group.products[0].productnum || '';\r\n                    group.qty = group.products[0].qty;\r\n                } else if (group.products.length > 1) {\r\n                    group.product = 'Multiple';\r\n                    group.qty = group.totalQty;\r\n                } else {\r\n                    group.product = '';\r\n                    group.qty = 0;\r\n                }\r\n\r\n                processedData.push(group);\r\n            }\r\n\r\n            DashboardCommon.debugLog('Processed into ' + processedData.length + ' grouped records', 'success', 'RMA');\r\n\r\n            allData = processedData;\r\n            applyFilters();\r\n\r\n            DashboardCommon.debugLog('Load complete: ' + filteredData.length + ' RMA orders displayed', 'success', 'RMA');\r\n\r\n        } catch (error) {\r\n            DashboardCommon.debugLog('ERROR: ' + error.message, 'error', 'RMA');\r\n            console.error('Error loading RMA orders:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply filters to data (RMA)\r\n     */\r\n    function applyFilters() {\r\n        filteredData = allData.filter(function(row) {\r\n            const container = document.getElementById(containerId);\r\n            const filterInputs = container.querySelectorAll('.filter-row input[data-filter]');\r\n            for (let i = 0; i < filterInputs.length; i++) {\r\n                const input = filterInputs[i];\r\n                if (input.value) {\r\n                    const filterKey = input.getAttribute('data-filter');\r\n                    let cellValue;\r\n\r\n                    // For date columns, filter on formatted date\r\n                    if (filterKey === 'datecreated' || filterKey === 'dateexpires') {\r\n                        cellValue = DashboardCommon.formatDate(row[filterKey]).toLowerCase();\r\n                    } else {\r\n                        cellValue = (row[filterKey] || '').toString().toLowerCase();\r\n                    }\r\n\r\n                    const filterValue = input.value.toLowerCase();\r\n                    if (cellValue.indexOf(filterValue) === -1) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n\r\n        updateFilterInfo();\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Update filter info display\r\n     */\r\n    function updateFilterInfo() {\r\n        const filterInfo = document.getElementById(containerId + '-filterInfo');\r\n        if (!filterInfo) return;\r\n\r\n        if (allData.length !== filteredData.length) {\r\n            filterInfo.textContent = 'Showing ' + filteredData.length + ' of ' + allData.length + ' RMA orders';\r\n            filterInfo.style.display = 'inline-block';\r\n        } else {\r\n            filterInfo.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all filters\r\n     */\r\n    function clearFilters() {\r\n        const container = document.getElementById(containerId);\r\n        const inputs = container.querySelectorAll('.filter-row input');\r\n        for (let i = 0; i < inputs.length; i++) {\r\n            inputs[i].value = '';\r\n        }\r\n        applyFilters();\r\n    }\r\n\r\n    /**\r\n     * Sort table by column\r\n     * @param {string} column - Column name to sort by\r\n     */\r\n    function sortTable(column) {\r\n        if (sortColumn === column) {\r\n            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';\r\n        } else {\r\n            sortColumn = column;\r\n            sortDirection = 'asc';\r\n        }\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Sort data and render table\r\n     */\r\n    function sortAndRender() {\r\n        filteredData.sort(function(a, b) {\r\n            const aVal = a[sortColumn] || '';\r\n            const bVal = b[sortColumn] || '';\r\n\r\n            if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;\r\n            if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;\r\n            return 0;\r\n        });\r\n\r\n        renderTable();\r\n    }\r\n\r\n    /**\r\n     * Create cell content for a column\r\n     * @param {object} row - Data row\r\n     * @param {string} column - Column name\r\n     * @returns {HTMLElement} TD element\r\n     */\r\n    function createCellContent(row, column) {\r\n        const td = document.createElement('td');\r\n\r\n        if (column === 'scheduleindicator') {\r\n            const scheduleStatus = DashboardCommon.getScheduleStatus(row.dateexpires);\r\n            return DashboardCommon.createScheduleIndicator(scheduleStatus, row.dateexpires);\r\n        } else if (column === 'statusname') {\r\n            let statusClass = 'status-badge';\r\n            if (row.statusname === 'Open') statusClass += ' status-open';\r\n            else if (row.statusname === 'Fulfilled') statusClass += ' status-fulfilled';\r\n            else if (row.statusname === 'Expired') statusClass += ' status-expired';\r\n            const badge = document.createElement('span');\r\n            badge.className = statusClass;\r\n            badge.textContent = row.statusname || '';\r\n            td.appendChild(badge);\r\n            td.title = row.statusname || '';\r\n        } else if (column === 'issue') {\r\n            td.textContent = row.issue || '';\r\n            td.title = row.issue || '';\r\n        } else if (column === 'type') {\r\n            td.textContent = row.type || '';\r\n            td.title = row.type || '';\r\n        } else if (column === 'num') {\r\n            const rmaLink = document.createElement('a');\r\n            rmaLink.href = '#';\r\n            rmaLink.className = 'order-link';\r\n            rmaLink.textContent = row.num;\r\n            rmaLink.onclick = function(e) {\r\n                e.preventDefault();\r\n                openRMA(row.num);\r\n                return false;\r\n            };\r\n            td.appendChild(rmaLink);\r\n            td.title = row.num;\r\n        } else if (column === 'product' || column === 'qty') {\r\n            td.textContent = row[column] || '';\r\n            td.title = row[column] || '';\r\n        } else if (column === 'customername') {\r\n            td.textContent = row.customername || '';\r\n            td.title = row.customername || '';\r\n        } else if (column === 'datecreated' || column === 'dateexpires') {\r\n            td.textContent = DashboardCommon.formatDate(row[column]);\r\n            td.title = DashboardCommon.formatDate(row[column]);\r\n        }\r\n\r\n        return td;\r\n    }\r\n\r\n    /**\r\n     * Render table with current data\r\n     */\r\n    function renderTable() {\r\n        const tbody = document.getElementById(containerId + '-tableBody');\r\n        if (!tbody) return;\r\n\r\n        tbody.innerHTML = '';\r\n\r\n        if (filteredData.length === 0) {\r\n            tbody.innerHTML = '<tr><td colspan=\"10\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">No RMA orders found</td></tr>';\r\n            return;\r\n        }\r\n\r\n        const columnOrder = ['scheduleindicator', 'statusname', 'type', 'issue', 'num', 'product', 'qty', 'customername', 'datecreated', 'dateexpires'];\r\n\r\n        for (let i = 0; i < filteredData.length; i++) {\r\n            const row = filteredData[i];\r\n            const tr = document.createElement('tr');\r\n\r\n            for (let j = 0; j < columnOrder.length; j++) {\r\n                const cell = createCellContent(row, columnOrder[j]);\r\n                tr.appendChild(cell);\r\n            }\r\n\r\n            tbody.appendChild(tr);\r\n        }\r\n\r\n        DashboardCommon.debugLog('Rendered ' + filteredData.length + ' rows', 'success', 'RMA');\r\n    }\r\n\r\n    /**\r\n     * Open RMA order in Fishbowl\r\n     * @param {string} orderNum - Order number\r\n     */\r\n    function openRMA(orderNum) {\r\n        openModule(\"RMA\", orderNum);\r\n    }\r\n\r\n    /**\r\n     * Refresh data\r\n     */\r\n    function refresh() {\r\n        loadData();\r\n    }\r\n\r\n    // Public API\r\n    return {\r\n        init: init,\r\n        refresh: refresh,\r\n        applyFilters: applyFilters,\r\n        clearFilters: clearFilters,\r\n        sortTable: sortTable\r\n    };\r\n})();\r\n/**\r\n * Transfer Orders Dashboard Module\r\n * Displays open transfer orders with filtering, sorting, and click-through\r\n */\r\n\r\nwindow.ReportTO = (function() {\r\n    'use strict';\r\n\r\n    // Private variables\r\n    let containerId = '';\r\n    let allData = [];\r\n    let filteredData = [];\r\n    let sortColumn = 'datescheduled';\r\n    let sortDirection = 'asc';\r\n\r\n    /**\r\n     * Initialize the Transfer Orders tile\r\n     * @param {string} container - ID of the container element\r\n     */\r\n    function init(container) {\r\n        containerId = container;\r\n        DashboardCommon.debugLog('Initializing Transfer Orders module', 'info', 'TO');\r\n        setupUI();\r\n        loadData();\r\n    }\r\n\r\n    /**\r\n     * Setup the UI structure\r\n     */\r\n    function setupUI() {\r\n        const container = document.getElementById(containerId);\r\n        if (!container) {\r\n            DashboardCommon.debugLog('Container not found: ' + containerId, 'error', 'TO');\r\n            return;\r\n        }\r\n\r\n        container.innerHTML = `\r\n            <div class=\"tile-header\">\r\n                <div>\r\n                    <h2 class=\"tile-title\">Open Transfer Orders</h2>\r\n                </div>\r\n                <div class=\"tile-controls\">\r\n                    <span id=\"${containerId}-filterInfo\" class=\"filter-info\" style=\"display: none;\"></span>\r\n                    <button class=\"btn\" onclick=\"ReportTO.clearFilters()\">Clear Filters</button>\r\n                    <button class=\"btn btn-primary\" onclick=\"ReportTO.refresh()\">Refresh</button>\r\n                </div>\r\n            </div>\r\n            <div class=\"tile-table-container\">\r\n                <table class=\"tile-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th data-column=\"scheduleindicator\" class=\"schedule-col\" onclick=\"ReportTO.sortTable('datescheduled')\" title=\"Schedule Status\">\r\n                                <svg class=\"clock-icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                                    <path d=\"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z\"/>\r\n                                </svg>\r\n                            </th>\r\n                            <th data-column=\"statusname\" onclick=\"ReportTO.sortTable('statusname')\">Status <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"type\" onclick=\"ReportTO.sortTable('type')\">Type <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"num\" onclick=\"ReportTO.sortTable('num')\">Number <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"datescheduled\" onclick=\"ReportTO.sortTable('datescheduled')\">Date Scheduled <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"dateissued\" onclick=\"ReportTO.sortTable('dateissued')\">Date Issued <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"fromname\" onclick=\"ReportTO.sortTable('fromname')\">From <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"toname\" onclick=\"ReportTO.sortTable('toname')\">To <span class=\"sort-icon\">⇅</span></th>\r\n                        </tr>\r\n                        <tr class=\"filter-row\">\r\n                            <td data-filter=\"scheduleindicator\"></td>\r\n                            <td><input type=\"text\" data-filter=\"statusname\" placeholder=\"Filter...\" onkeyup=\"ReportTO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"type\" placeholder=\"Filter...\" onkeyup=\"ReportTO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"num\" placeholder=\"Filter...\" onkeyup=\"ReportTO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"datescheduled\" placeholder=\"Filter...\" onkeyup=\"ReportTO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"dateissued\" placeholder=\"Filter...\" onkeyup=\"ReportTO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"fromname\" placeholder=\"Filter...\" onkeyup=\"ReportTO.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"toname\" placeholder=\"Filter...\" onkeyup=\"ReportTO.applyFilters()\"></td>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody id=\"${containerId}-tableBody\">\r\n                        <tr>\r\n                            <td colspan=\"8\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">Loading...</td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Load transfer orders data\r\n     */\r\n    function loadData() {\r\n        DashboardCommon.debugLog('Starting data load...', 'info', 'TO');\r\n\r\n        try {\r\n            const currentUser = JSON.parse(getUser());\r\n            const userId = currentUser.id;\r\n            DashboardCommon.debugLog('Current user ID: ' + userId, 'info', 'TO');\r\n\r\n            const query =\r\n                \"SELECT \" +\r\n                \"    Xo.id AS id, \" +\r\n                \"    Xo.num AS num, \" +\r\n                \"    Xo.dateIssued AS dateIssued, \" +\r\n                \"    COALESCE(Xo.dateFirstShip, Xo.dateScheduled) AS dateScheduled, \" +\r\n                \"    XoStatus.Name AS statusName, \" +\r\n                \"    XoType.Name AS typeName, \" +\r\n                \"    FromLG.Name AS fromName, \" +\r\n                \"    ToLG.Name AS toName \" +\r\n                \"FROM Xo \" +\r\n                \"LEFT JOIN XoStatus ON Xo.statusId = XoStatus.Id \" +\r\n                \"LEFT JOIN XoType ON Xo.typeId = XoType.Id \" +\r\n                \"LEFT JOIN locationGroup AS FromLG ON Xo.fromLGId = FromLG.Id \" +\r\n                \"LEFT JOIN locationGroup AS ToLG ON Xo.shipToLGId = ToLG.Id \" +\r\n                \"INNER JOIN UserToLG ON Xo.fromLGId = UserToLG.LocationGroupId AND UserToLG.UserId = \" + userId + \" \" +\r\n                \"WHERE Xo.statusId IN (10, 15, 20, 30, 40, 50, 60) \" +\r\n                \"ORDER BY dateScheduled ASC\";\r\n\r\n            DashboardCommon.debugLog('Executing SQL query...', 'query', 'TO');\r\n\r\n            const queryResult = runQuery(query);\r\n            const result = JSON.parse(queryResult);\r\n\r\n            DashboardCommon.debugLog('Parsed ' + result.length + ' records', 'success', 'TO');\r\n\r\n            // Add type field for filtering\r\n            for (let i = 0; i < result.length; i++) {\r\n                result[i].type = result[i].typename || '';\r\n            }\r\n\r\n            allData = result;\r\n            applyFilters();\r\n\r\n            DashboardCommon.debugLog('Load complete: ' + filteredData.length + ' transfer orders displayed', 'success', 'TO');\r\n\r\n        } catch (error) {\r\n            DashboardCommon.debugLog('ERROR: ' + error.message, 'error', 'TO');\r\n            console.error('Error loading transfer orders:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply filters to data (Transfer Orders)\r\n     */\r\n    function applyFilters() {\r\n        filteredData = allData.filter(function(row) {\r\n            const container = document.getElementById(containerId);\r\n            const filterInputs = container.querySelectorAll('.filter-row input[data-filter]');\r\n            for (let i = 0; i < filterInputs.length; i++) {\r\n                const input = filterInputs[i];\r\n                if (input.value) {\r\n                    const filterKey = input.getAttribute('data-filter');\r\n                    let cellValue;\r\n\r\n                    // For date columns, filter on formatted date\r\n                    if (filterKey === 'datescheduled' || filterKey === 'dateissued') {\r\n                        cellValue = DashboardCommon.formatDate(row[filterKey]).toLowerCase();\r\n                    } else {\r\n                        cellValue = (row[filterKey] || '').toString().toLowerCase();\r\n                    }\r\n\r\n                    const filterValue = input.value.toLowerCase();\r\n                    if (cellValue.indexOf(filterValue) === -1) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n\r\n        updateFilterInfo();\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Update filter info display\r\n     */\r\n    function updateFilterInfo() {\r\n        const filterInfo = document.getElementById(containerId + '-filterInfo');\r\n        if (!filterInfo) return;\r\n\r\n        if (allData.length !== filteredData.length) {\r\n            filterInfo.textContent = 'Showing ' + filteredData.length + ' of ' + allData.length + ' transfer orders';\r\n            filterInfo.style.display = 'inline-block';\r\n        } else {\r\n            filterInfo.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all filters\r\n     */\r\n    function clearFilters() {\r\n        const container = document.getElementById(containerId);\r\n        const inputs = container.querySelectorAll('.filter-row input');\r\n        for (let i = 0; i < inputs.length; i++) {\r\n            inputs[i].value = '';\r\n        }\r\n        applyFilters();\r\n    }\r\n\r\n    /**\r\n     * Sort table by column\r\n     * @param {string} column - Column name to sort by\r\n     */\r\n    function sortTable(column) {\r\n        if (sortColumn === column) {\r\n            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';\r\n        } else {\r\n            sortColumn = column;\r\n            sortDirection = 'asc';\r\n        }\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Sort data and render table\r\n     */\r\n    function sortAndRender() {\r\n        filteredData.sort(function(a, b) {\r\n            const aVal = a[sortColumn] || '';\r\n            const bVal = b[sortColumn] || '';\r\n\r\n            if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;\r\n            if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;\r\n            return 0;\r\n        });\r\n\r\n        renderTable();\r\n    }\r\n\r\n    /**\r\n     * Create cell content for a column\r\n     * @param {object} row - Data row\r\n     * @param {string} column - Column name\r\n     * @returns {HTMLElement} TD element\r\n     */\r\n    function createCellContent(row, column) {\r\n        const td = document.createElement('td');\r\n\r\n        if (column === 'scheduleindicator') {\r\n            const scheduleStatus = DashboardCommon.getScheduleStatus(row.datescheduled);\r\n            return DashboardCommon.createScheduleIndicator(scheduleStatus, row.datescheduled);\r\n        } else if (column === 'type') {\r\n            td.textContent = row.type || '';\r\n            td.title = row.type || '';\r\n        } else if (column === 'statusname') {\r\n            let statusClass = 'status-badge';\r\n            if (row.statusname === 'Entered') statusClass += ' status-estimate';\r\n            else if (row.statusname === 'Request') statusClass += ' status-estimate';\r\n            else if (row.statusname === 'Issued') statusClass += ' status-issued';\r\n            else if (row.statusname === 'Picking') statusClass += ' status-inprogress';\r\n            else if (row.statusname === 'Partial') statusClass += ' status-inprogress';\r\n            else if (row.statusname === 'Picked') statusClass += ' status-issued';\r\n            else if (row.statusname === 'Shipped') statusClass += ' status-issued';\r\n            const badge = document.createElement('span');\r\n            badge.className = statusClass;\r\n            badge.textContent = row.statusname || '';\r\n            td.appendChild(badge);\r\n            td.title = row.statusname || '';\r\n        } else if (column === 'num') {\r\n            const toLink = document.createElement('a');\r\n            toLink.href = '#';\r\n            toLink.className = 'order-link';\r\n            toLink.textContent = row.num;\r\n            toLink.onclick = function(e) {\r\n                e.preventDefault();\r\n                openTO(row.num);\r\n                return false;\r\n            };\r\n            td.appendChild(toLink);\r\n            td.title = row.num;\r\n        } else if (column === 'datescheduled' || column === 'dateissued') {\r\n            td.textContent = DashboardCommon.formatDate(row[column]);\r\n            td.title = DashboardCommon.formatDate(row[column]);\r\n        } else if (column === 'fromname' || column === 'toname') {\r\n            td.textContent = row[column] || '';\r\n            td.title = row[column] || '';\r\n        }\r\n\r\n        return td;\r\n    }\r\n\r\n    /**\r\n     * Render table with current data\r\n     */\r\n    function renderTable() {\r\n        const tbody = document.getElementById(containerId + '-tableBody');\r\n        if (!tbody) return;\r\n\r\n        tbody.innerHTML = '';\r\n\r\n        if (filteredData.length === 0) {\r\n            tbody.innerHTML = '<tr><td colspan=\"8\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">No transfer orders found</td></tr>';\r\n            return;\r\n        }\r\n\r\n        const columnOrder = ['scheduleindicator', 'statusname', 'type', 'num', 'datescheduled', 'dateissued', 'fromname', 'toname'];\r\n\r\n        for (let i = 0; i < filteredData.length; i++) {\r\n            const row = filteredData[i];\r\n            const tr = document.createElement('tr');\r\n\r\n            for (let j = 0; j < columnOrder.length; j++) {\r\n                const cell = createCellContent(row, columnOrder[j]);\r\n                tr.appendChild(cell);\r\n            }\r\n\r\n            tbody.appendChild(tr);\r\n        }\r\n\r\n        DashboardCommon.debugLog('Rendered ' + filteredData.length + ' rows', 'success', 'TO');\r\n    }\r\n\r\n    /**\r\n     * Open transfer order in Fishbowl\r\n     * @param {string} orderNum - Order number\r\n     */\r\n    function openTO(orderNum) {\r\n        openModule(\"Transfer Order\", orderNum);\r\n    }\r\n\r\n    /**\r\n     * Refresh data\r\n     */\r\n    function refresh() {\r\n        loadData();\r\n    }\r\n\r\n    // Public API\r\n    return {\r\n        init: init,\r\n        refresh: refresh,\r\n        applyFilters: applyFilters,\r\n        clearFilters: clearFilters,\r\n        sortTable: sortTable\r\n    };\r\n})();\r\n/**\r\n * Items To Be Picked Dashboard Module\r\n * Displays pick items with availability status, filtering, sorting, and click-through\r\n */\r\n\r\nwindow.ReportPICK = (function() {\r\n    'use strict';\r\n\r\n    // Private variables\r\n    let containerId = '';\r\n    let allData = [];\r\n    let filteredData = [];\r\n    let sortColumn = 'datescheduled';\r\n    let sortDirection = 'asc';\r\n\r\n    /**\r\n     * Initialize the Picks tile\r\n     * @param {string} container - ID of the container element\r\n     */\r\n    function init(container) {\r\n        containerId = container;\r\n        DashboardCommon.debugLog('Initializing Picks module', 'info', 'PICK');\r\n        setupUI();\r\n        loadData();\r\n    }\r\n\r\n    /**\r\n     * Setup the UI structure\r\n     */\r\n    function setupUI() {\r\n        const container = document.getElementById(containerId);\r\n        if (!container) {\r\n            DashboardCommon.debugLog('Container not found: ' + containerId, 'error', 'PICK');\r\n            return;\r\n        }\r\n\r\n        container.innerHTML = `\r\n            <div class=\"tile-header\">\r\n                <div>\r\n                    <h2 class=\"tile-title\">Items To Be Picked</h2>\r\n                </div>\r\n                <div class=\"tile-controls\">\r\n                    <span id=\"${containerId}-filterInfo\" class=\"filter-info\" style=\"display: none;\"></span>\r\n                    <button class=\"btn\" onclick=\"ReportPICK.clearFilters()\">Clear Filters</button>\r\n                    <button class=\"btn btn-primary\" onclick=\"ReportPICK.refresh()\">Refresh</button>\r\n                </div>\r\n            </div>\r\n            <div class=\"tile-table-container\">\r\n                <table class=\"tile-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th data-column=\"scheduleindicator\" class=\"schedule-col\" onclick=\"ReportPICK.sortTable('datescheduled')\" title=\"Schedule Status\">\r\n                                <svg class=\"clock-icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                                    <path d=\"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z\"/>\r\n                                </svg>\r\n                            </th>\r\n                            <th data-column=\"availabilitystatus\" class=\"narrow-col\" onclick=\"ReportPICK.sortTable('availabilitystatus')\" title=\"Availability Status\">\r\n                                <svg class=\"availability-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                                    <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n                                    <path d=\"M9 12l2 2 4-4\"/>\r\n                                </svg>\r\n                                <span class=\"sort-icon\">⇅</span>\r\n                            </th>\r\n                            <th data-column=\"statusname\" onclick=\"ReportPICK.sortTable('statusname')\">Status <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"num\" onclick=\"ReportPICK.sortTable('num')\">Number <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"ordernum\" onclick=\"ReportPICK.sortTable('ordernum')\">Order # <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"datescheduled\" onclick=\"ReportPICK.sortTable('datescheduled')\">Scheduled Date <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"priorityname\" onclick=\"ReportPICK.sortTable('priorityname')\">Priority <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"orderinfo\" onclick=\"ReportPICK.sortTable('orderinfo')\">Order Info <span class=\"sort-icon\">⇅</span></th>\r\n                        </tr>\r\n                        <tr class=\"filter-row\">\r\n                            <td data-filter=\"scheduleindicator\"></td>\r\n                            <td><input type=\"text\" data-filter=\"availabilitystatus\" placeholder=\"Filter...\" onkeyup=\"ReportPICK.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"statusname\" placeholder=\"Filter...\" onkeyup=\"ReportPICK.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"num\" placeholder=\"Filter...\" onkeyup=\"ReportPICK.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"ordernum\" placeholder=\"Filter...\" onkeyup=\"ReportPICK.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"datescheduled\" placeholder=\"Filter...\" onkeyup=\"ReportPICK.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"priorityname\" placeholder=\"Filter...\" onkeyup=\"ReportPICK.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"orderinfo\" placeholder=\"Filter...\" onkeyup=\"ReportPICK.applyFilters()\"></td>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody id=\"${containerId}-tableBody\">\r\n                        <tr>\r\n                            <td colspan=\"8\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">Loading...</td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Load pick data\r\n     */\r\n    function loadData() {\r\n        DashboardCommon.debugLog('Starting data load...', 'info', 'PICK');\r\n\r\n        try {\r\n            const currentUser = JSON.parse(getUser());\r\n            const userId = currentUser.id;\r\n            DashboardCommon.debugLog('Current user ID: ' + userId, 'info', 'PICK');\r\n\r\n            // Complex query to get pick data with availability calculation\r\n            const query =\r\n                \"SELECT \" +\r\n                \"    Pick.Id AS id, \" +\r\n                \"    Pick.Num AS num, \" +\r\n                \"    Pick.DateScheduled AS dateScheduled, \" +\r\n                \"    Pick.StatusId AS statusId, \" +\r\n                \"    PickStatus.Name AS statusName, \" +\r\n                \"    Priority.Name AS priorityName, \" +\r\n                \"    COALESCE( \" +\r\n                \"        (SELECT PickItem.OrderTypeId FROM PickItem \" +\r\n                \"         WHERE PickItem.PickId = Pick.Id LIMIT 1), \" +\r\n                \"        0 \" +\r\n                \"    ) AS orderTypeId, \" +\r\n                \"    COALESCE( \" +\r\n                \"        (SELECT So.Num FROM PickItem \" +\r\n                \"         JOIN SoItem ON PickItem.SoItemId = SoItem.Id \" +\r\n                \"         JOIN So ON SoItem.SoId = So.Id \" +\r\n                \"         WHERE PickItem.PickId = Pick.Id AND PickItem.OrderTypeId = 20 LIMIT 1), \" +\r\n                \"        (SELECT Po.Num FROM PickItem \" +\r\n                \"         JOIN PoItem ON PickItem.PoItemId = PoItem.Id \" +\r\n                \"         JOIN Po ON PoItem.PoId = Po.Id \" +\r\n                \"         WHERE PickItem.PickId = Pick.Id AND PickItem.OrderTypeId = 10 LIMIT 1), \" +\r\n                \"        (SELECT Wo.Num FROM PickItem \" +\r\n                \"         JOIN WoItem ON PickItem.WoItemId = WoItem.Id \" +\r\n                \"         JOIN Wo ON WoItem.WoId = Wo.Id \" +\r\n                \"         WHERE PickItem.PickId = Pick.Id AND PickItem.OrderTypeId = 30 LIMIT 1), \" +\r\n                \"        (SELECT Xo.Num FROM PickItem \" +\r\n                \"         JOIN XoItem ON PickItem.XoItemId = XoItem.Id \" +\r\n                \"         JOIN Xo ON XoItem.XoId = Xo.Id \" +\r\n                \"         WHERE PickItem.PickId = Pick.Id AND PickItem.OrderTypeId = 40 LIMIT 1), \" +\r\n                \"        'N/A' \" +\r\n                \"    ) AS orderNum, \" +\r\n                \"    COALESCE( \" +\r\n                \"        (SELECT Customer.Name FROM PickItem \" +\r\n                \"         JOIN SoItem ON PickItem.SoItemId = SoItem.Id \" +\r\n                \"         JOIN So ON SoItem.SoId = So.Id \" +\r\n                \"         JOIN Customer ON So.CustomerId = Customer.Id \" +\r\n                \"         WHERE PickItem.PickId = Pick.Id AND PickItem.OrderTypeId = 20 LIMIT 1), \" +\r\n                \"        (SELECT Vendor.Name FROM PickItem \" +\r\n                \"         JOIN PoItem ON PickItem.PoItemId = PoItem.Id \" +\r\n                \"         JOIN Po ON PoItem.PoId = Po.Id \" +\r\n                \"         JOIN Vendor ON Po.VendorId = Vendor.Id \" +\r\n                \"         WHERE PickItem.PickId = Pick.Id AND PickItem.OrderTypeId = 10 LIMIT 1), \" +\r\n                \"        (SELECT LocationGroup.Name FROM PickItem \" +\r\n                \"         JOIN WoItem ON PickItem.WoItemId = WoItem.Id \" +\r\n                \"         JOIN Wo ON WoItem.WoId = Wo.Id \" +\r\n                \"         JOIN LocationGroup ON Wo.LocationGroupId = LocationGroup.Id \" +\r\n                \"         WHERE PickItem.PickId = Pick.Id AND PickItem.OrderTypeId = 30 LIMIT 1), \" +\r\n                \"        (SELECT LocationGroup.Name FROM PickItem \" +\r\n                \"         JOIN XoItem ON PickItem.XoItemId = XoItem.Id \" +\r\n                \"         JOIN Xo ON XoItem.XoId = Xo.Id \" +\r\n                \"         JOIN LocationGroup ON Xo.ShipToLgId = LocationGroup.Id \" +\r\n                \"         WHERE PickItem.PickId = Pick.Id AND PickItem.OrderTypeId = 40 LIMIT 1), \" +\r\n                \"        'N/A' \" +\r\n                \"    ) AS orderInfo, \" +\r\n                \"    ( \" +\r\n                \"        SELECT COUNT(*) \" +\r\n                \"        FROM PickItem \" +\r\n                \"        WHERE PickItem.PickId = Pick.Id \" +\r\n                \"        AND PickItem.StatusId < 40 \" +\r\n                \"        AND (PickItem.StatusId = 30 \" +\r\n                \"             OR (PickItem.StatusId IN (10, 11, 20) \" +\r\n                \"                 AND (COALESCE((SELECT qty FROM qtyonhand WHERE partId = PickItem.PartId AND locationGroupId = Pick.LocationGroupId), 0) \" +\r\n                \"                      - COALESCE((SELECT qty FROM qtycommitted WHERE partId = PickItem.PartId AND locationGroupId = Pick.LocationGroupId), 0) \" +\r\n                \"                      - COALESCE((SELECT qty FROM qtynotavailabletopick WHERE partId = PickItem.PartId AND locationGroupId = Pick.LocationGroupId), 0)) >= PickItem.Qty)) \" +\r\n                \"    ) AS fullItems, \" +\r\n                \"    ( \" +\r\n                \"        SELECT COUNT(*) \" +\r\n                \"        FROM PickItem \" +\r\n                \"        WHERE PickItem.PickId = Pick.Id \" +\r\n                \"        AND PickItem.StatusId IN (10, 11, 20) \" +\r\n                \"        AND (COALESCE((SELECT qty FROM qtyonhand WHERE partId = PickItem.PartId AND locationGroupId = Pick.LocationGroupId), 0) \" +\r\n                \"             - COALESCE((SELECT qty FROM qtycommitted WHERE partId = PickItem.PartId AND locationGroupId = Pick.LocationGroupId), 0) \" +\r\n                \"             - COALESCE((SELECT qty FROM qtynotavailabletopick WHERE partId = PickItem.PartId AND locationGroupId = Pick.LocationGroupId), 0)) > 0 \" +\r\n                \"        AND (COALESCE((SELECT qty FROM qtyonhand WHERE partId = PickItem.PartId AND locationGroupId = Pick.LocationGroupId), 0) \" +\r\n                \"             - COALESCE((SELECT qty FROM qtycommitted WHERE partId = PickItem.PartId AND locationGroupId = Pick.LocationGroupId), 0) \" +\r\n                \"             - COALESCE((SELECT qty FROM qtynotavailabletopick WHERE partId = PickItem.PartId AND locationGroupId = Pick.LocationGroupId), 0)) < PickItem.Qty \" +\r\n                \"    ) AS partialItems, \" +\r\n                \"    ( \" +\r\n                \"        SELECT COUNT(*) \" +\r\n                \"        FROM PickItem \" +\r\n                \"        WHERE PickItem.PickId = Pick.Id \" +\r\n                \"        AND PickItem.StatusId < 40 \" +\r\n                \"        AND (PickItem.StatusId IN (5, 6) \" +\r\n                \"             OR (PickItem.StatusId IN (10, 11, 20) \" +\r\n                \"                 AND (COALESCE((SELECT qty FROM qtyonhand WHERE partId = PickItem.PartId AND locationGroupId = Pick.LocationGroupId), 0) \" +\r\n                \"                      - COALESCE((SELECT qty FROM qtycommitted WHERE partId = PickItem.PartId AND locationGroupId = Pick.LocationGroupId), 0) \" +\r\n                \"                      - COALESCE((SELECT qty FROM qtynotavailabletopick WHERE partId = PickItem.PartId AND locationGroupId = Pick.LocationGroupId), 0)) <= 0)) \" +\r\n                \"    ) AS noneItems, \" +\r\n                \"    ( \" +\r\n                \"        SELECT COUNT(*) FROM PickItem WHERE PickItem.PickId = Pick.Id AND PickItem.StatusId < 40 \" +\r\n                \"    ) AS pendingItems, \" +\r\n                \"    ( \" +\r\n                \"        SELECT COUNT(*) FROM PickItem WHERE PickItem.PickId = Pick.Id AND PickItem.StatusId = 30 \" +\r\n                \"    ) AS committedItems \" +\r\n                \"FROM Pick \" +\r\n                \"LEFT JOIN PickStatus ON Pick.StatusId = PickStatus.Id \" +\r\n                \"LEFT JOIN Priority ON Pick.Priority = Priority.Id \" +\r\n                \"INNER JOIN UserToLG ON Pick.LocationGroupId = UserToLG.LocationGroupId AND UserToLG.UserId = \" + userId + \" \" +\r\n                \"WHERE Pick.StatusId < 40 \" +\r\n                \"ORDER BY Pick.DateScheduled ASC\";\r\n\r\n            DashboardCommon.debugLog('Executing SQL query...', 'query', 'PICK');\r\n\r\n            const queryResult = runQuery(query);\r\n            const result = JSON.parse(queryResult);\r\n\r\n            DashboardCommon.debugLog('Parsed ' + result.length + ' records', 'success', 'PICK');\r\n\r\n            // Add formatted order number with prefix and calculate availability status\r\n            for (let i = 0; i < result.length; i++) {\r\n                let orderPrefix = '';\r\n                if (result[i].ordertypeid === 10) orderPrefix = 'PO-';\r\n                else if (result[i].ordertypeid === 20) orderPrefix = 'SO-';\r\n                else if (result[i].ordertypeid === 30) orderPrefix = 'WO-';\r\n                else if (result[i].ordertypeid === 40) orderPrefix = 'TO-';\r\n                result[i].ordernumdisplay = orderPrefix + (result[i].ordernum || '');\r\n\r\n                // Calculate availability status: green/orange/red/committed\r\n                const fullItems = result[i].fullitems || 0;\r\n                const partialItems = result[i].partialitems || 0;\r\n                const noneItems = result[i].noneitems || 0;\r\n                const pendingItems = result[i].pendingitems || 0;\r\n                const committedItems = result[i].committeditems || 0;\r\n\r\n                if (pendingItems === 0) {\r\n                    result[i].availabilitystatus = 'gray';\r\n                } else if (committedItems === pendingItems && pendingItems > 0) {\r\n                    result[i].availabilitystatus = 'committed';\r\n                } else if (fullItems === pendingItems) {\r\n                    result[i].availabilitystatus = 'green';\r\n                } else if (noneItems === pendingItems) {\r\n                    result[i].availabilitystatus = 'red';\r\n                } else {\r\n                    result[i].availabilitystatus = 'orange';\r\n                }\r\n            }\r\n\r\n            allData = result;\r\n            applyFilters();\r\n\r\n            DashboardCommon.debugLog('Load complete: ' + filteredData.length + ' picks displayed', 'success', 'PICK');\r\n\r\n        } catch (error) {\r\n            DashboardCommon.debugLog('ERROR: ' + error.message, 'error', 'PICK');\r\n            console.error('Error loading picks:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply filters to data (Picks)\r\n     */\r\n    function applyFilters() {\r\n        filteredData = allData.filter(function(row) {\r\n            const container = document.getElementById(containerId);\r\n            const filterInputs = container.querySelectorAll('.filter-row input[data-filter]');\r\n            for (let i = 0; i < filterInputs.length; i++) {\r\n                const input = filterInputs[i];\r\n                if (input.value) {\r\n                    const filterKey = input.getAttribute('data-filter');\r\n                    let cellValue;\r\n\r\n                    // For date columns, filter on formatted date\r\n                    if (filterKey === 'datescheduled') {\r\n                        cellValue = DashboardCommon.formatDate(row[filterKey]).toLowerCase();\r\n                    } else {\r\n                        const dataField = filterKey === 'ordernum' ? 'ordernumdisplay' : filterKey;\r\n                        cellValue = (row[dataField] || '').toString().toLowerCase();\r\n                    }\r\n\r\n                    const filterValue = input.value.toLowerCase();\r\n                    if (cellValue.indexOf(filterValue) === -1) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n\r\n        updateFilterInfo();\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Update filter info display\r\n     */\r\n    function updateFilterInfo() {\r\n        const filterInfo = document.getElementById(containerId + '-filterInfo');\r\n        if (!filterInfo) return;\r\n\r\n        if (allData.length !== filteredData.length) {\r\n            filterInfo.textContent = 'Showing ' + filteredData.length + ' of ' + allData.length + ' picks';\r\n            filterInfo.style.display = 'inline-block';\r\n        } else {\r\n            filterInfo.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all filters\r\n     */\r\n    function clearFilters() {\r\n        const container = document.getElementById(containerId);\r\n        const inputs = container.querySelectorAll('.filter-row input');\r\n        for (let i = 0; i < inputs.length; i++) {\r\n            inputs[i].value = '';\r\n        }\r\n        applyFilters();\r\n    }\r\n\r\n    /**\r\n     * Sort table by column\r\n     * @param {string} column - Column name to sort by\r\n     */\r\n    function sortTable(column) {\r\n        if (sortColumn === column) {\r\n            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';\r\n        } else {\r\n            sortColumn = column;\r\n            sortDirection = 'asc';\r\n        }\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Sort data and render table\r\n     */\r\n    function sortAndRender() {\r\n        filteredData.sort(function(a, b) {\r\n            const sortField = sortColumn === 'ordernum' ? 'ordernumdisplay' : sortColumn;\r\n            const aVal = a[sortField] || '';\r\n            const bVal = b[sortField] || '';\r\n\r\n            if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;\r\n            if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;\r\n            return 0;\r\n        });\r\n\r\n        renderTable();\r\n    }\r\n\r\n    /**\r\n     * Create cell content for a column\r\n     * @param {object} row - Data row\r\n     * @param {string} column - Column name\r\n     * @returns {HTMLElement} TD element\r\n     */\r\n    function createCellContent(row, column) {\r\n        const td = document.createElement('td');\r\n\r\n        if (column === 'scheduleindicator') {\r\n            const scheduleStatus = DashboardCommon.getScheduleStatus(row.datescheduled);\r\n            return DashboardCommon.createScheduleIndicator(scheduleStatus, row.datescheduled);\r\n        } else if (column === 'availabilitystatus') {\r\n            return DashboardCommon.createAvailabilityIndicator(row);\r\n        } else if (column === 'num') {\r\n            const pickLink = document.createElement('a');\r\n            pickLink.href = '#';\r\n            pickLink.className = 'order-link';\r\n            pickLink.textContent = row.num;\r\n            pickLink.onclick = function(e) {\r\n                e.preventDefault();\r\n                openPick(row.num);\r\n                return false;\r\n            };\r\n            td.appendChild(pickLink);\r\n            td.title = row.num;\r\n        } else if (column === 'statusname') {\r\n            let statusClass = 'status-badge';\r\n            if (row.statusname === 'Entered') statusClass += ' status-estimate';\r\n            else if (row.statusname === 'Started') statusClass += ' status-inprogress';\r\n            else if (row.statusname === 'Committed') statusClass += ' status-issued';\r\n            else if (row.statusname === 'Finished') statusClass += ' status-issued';\r\n            const badge = document.createElement('span');\r\n            badge.className = statusClass;\r\n            badge.textContent = row.statusname || '';\r\n            td.appendChild(badge);\r\n            td.title = row.statusname || '';\r\n        } else if (column === 'priorityname') {\r\n            td.textContent = row.priorityname || '';\r\n            td.title = row.priorityname || '';\r\n        } else if (column === 'datescheduled') {\r\n            td.textContent = DashboardCommon.formatDate(row.datescheduled);\r\n            td.title = DashboardCommon.formatDate(row.datescheduled);\r\n        } else if (column === 'ordernum') {\r\n            td.textContent = row.ordernumdisplay || '';\r\n            td.title = row.ordernumdisplay || '';\r\n        } else if (column === 'orderinfo') {\r\n            td.textContent = row.orderinfo || '';\r\n            td.title = row.orderinfo || '';\r\n        }\r\n\r\n        return td;\r\n    }\r\n\r\n    /**\r\n     * Render table with current data\r\n     */\r\n    function renderTable() {\r\n        const tbody = document.getElementById(containerId + '-tableBody');\r\n        if (!tbody) return;\r\n\r\n        tbody.innerHTML = '';\r\n\r\n        if (filteredData.length === 0) {\r\n            tbody.innerHTML = '<tr><td colspan=\"8\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">No picks found</td></tr>';\r\n            return;\r\n        }\r\n\r\n        const columnOrder = ['scheduleindicator', 'availabilitystatus', 'statusname', 'num', 'ordernum', 'datescheduled', 'priorityname', 'orderinfo'];\r\n\r\n        for (let i = 0; i < filteredData.length; i++) {\r\n            const row = filteredData[i];\r\n            const tr = document.createElement('tr');\r\n\r\n            for (let j = 0; j < columnOrder.length; j++) {\r\n                const cell = createCellContent(row, columnOrder[j]);\r\n                tr.appendChild(cell);\r\n            }\r\n\r\n            tbody.appendChild(tr);\r\n        }\r\n\r\n        DashboardCommon.debugLog('Rendered ' + filteredData.length + ' rows', 'success', 'PICK');\r\n    }\r\n\r\n    /**\r\n     * Open pick in Fishbowl\r\n     * @param {string} pickNum - Pick number\r\n     */\r\n    function openPick(pickNum) {\r\n        openModule(\"Picking\", pickNum);\r\n    }\r\n\r\n    /**\r\n     * Refresh data\r\n     */\r\n    function refresh() {\r\n        loadData();\r\n    }\r\n\r\n    // Public API\r\n    return {\r\n        init: init,\r\n        refresh: refresh,\r\n        applyFilters: applyFilters,\r\n        clearFilters: clearFilters,\r\n        sortTable: sortTable\r\n    };\r\n})();\r\n/**\r\n * Items To Be Received Dashboard Module\r\n * Displays receipt items with filtering, sorting, and click-through\r\n */\r\n\r\nwindow.ReportRCV = (function() {\r\n    'use strict';\r\n\r\n    // Private variables\r\n    let containerId = '';\r\n    let allData = [];\r\n    let filteredData = [];\r\n    let sortColumn = 'ordernum';\r\n    let sortDirection = 'asc';\r\n\r\n    /**\r\n     * Initialize the Receipts tile\r\n     * @param {string} container - ID of the container element\r\n     */\r\n    function init(container) {\r\n        containerId = container;\r\n        DashboardCommon.debugLog('Initializing Receipts module', 'info', 'RCV');\r\n        setupUI();\r\n        loadData();\r\n    }\r\n\r\n    /**\r\n     * Setup the UI structure\r\n     */\r\n    function setupUI() {\r\n        const container = document.getElementById(containerId);\r\n        if (!container) {\r\n            DashboardCommon.debugLog('Container not found: ' + containerId, 'error', 'RCV');\r\n            return;\r\n        }\r\n\r\n        container.innerHTML = `\r\n            <div class=\"tile-header\">\r\n                <div>\r\n                    <h2 class=\"tile-title\">Items To Be Received</h2>\r\n                </div>\r\n                <div class=\"tile-controls\">\r\n                    <span id=\"${containerId}-filterInfo\" class=\"filter-info\" style=\"display: none;\"></span>\r\n                    <button class=\"btn\" onclick=\"ReportRCV.clearFilters()\">Clear Filters</button>\r\n                    <button class=\"btn btn-primary\" onclick=\"ReportRCV.refresh()\">Refresh</button>\r\n                </div>\r\n            </div>\r\n            <div class=\"tile-table-container\">\r\n                <table class=\"tile-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th data-column=\"scheduleindicator\" class=\"schedule-col\" onclick=\"ReportRCV.sortTable('datescheduled')\" title=\"Schedule Status\">\r\n                                <svg class=\"clock-icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                                    <path d=\"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z\"/>\r\n                                </svg>\r\n                            </th>\r\n                            <th data-column=\"statusname\" onclick=\"ReportRCV.sortTable('statusname')\">Status <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"type\" onclick=\"ReportRCV.sortTable('type')\">Type <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"ordernum\" onclick=\"ReportRCV.sortTable('ordernum')\">Order # <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"datescheduled\" onclick=\"ReportRCV.sortTable('datescheduled')\">Scheduled Date <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"vendorname\" onclick=\"ReportRCV.sortTable('vendorname')\">Vendor <span class=\"sort-icon\">⇅</span></th>\r\n                        </tr>\r\n                        <tr class=\"filter-row\">\r\n                            <td data-filter=\"scheduleindicator\"></td>\r\n                            <td><input type=\"text\" data-filter=\"statusname\" placeholder=\"Filter...\" onkeyup=\"ReportRCV.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"type\" placeholder=\"Filter...\" onkeyup=\"ReportRCV.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"ordernum\" placeholder=\"Filter...\" onkeyup=\"ReportRCV.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"datescheduled\" placeholder=\"Filter...\" onkeyup=\"ReportRCV.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"vendorname\" placeholder=\"Filter...\" onkeyup=\"ReportRCV.applyFilters()\"></td>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody id=\"${containerId}-tableBody\">\r\n                        <tr>\r\n                            <td colspan=\"6\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">Loading...</td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Load receipts data\r\n     */\r\n    function loadData() {\r\n        DashboardCommon.debugLog('Starting data load...', 'info', 'RCV');\r\n\r\n        try {\r\n            const currentUser = JSON.parse(getUser());\r\n            const userId = currentUser.id;\r\n            DashboardCommon.debugLog('Current user ID: ' + userId, 'info', 'RCV');\r\n\r\n            const query =\r\n                \"SELECT \" +\r\n                \"    Receipt.Id AS id, \" +\r\n                \"    Receipt.OrderTypeId AS orderTypeId, \" +\r\n                \"    Receipt.PoId AS poId, \" +\r\n                \"    Receipt.SoId AS soId, \" +\r\n                \"    Receipt.XoId AS xoId, \" +\r\n                \"    ReceiptStatus.Name AS statusName, \" +\r\n                \"    CASE \" +\r\n                \"        WHEN Receipt.OrderTypeId = 10 THEN 'PO' \" +\r\n                \"        WHEN Receipt.OrderTypeId = 20 THEN 'SO' \" +\r\n                \"        WHEN Receipt.OrderTypeId = 40 THEN 'TO' \" +\r\n                \"        ELSE 'Other' \" +\r\n                \"    END AS type, \" +\r\n                \"    CASE \" +\r\n                \"        WHEN Receipt.OrderTypeId = 10 THEN (SELECT Num FROM Po WHERE Id = Receipt.PoId) \" +\r\n                \"        WHEN Receipt.OrderTypeId = 20 THEN (SELECT Num FROM So WHERE Id = Receipt.SoId) \" +\r\n                \"        WHEN Receipt.OrderTypeId = 40 THEN (SELECT Num FROM Xo WHERE Id = Receipt.XoId) \" +\r\n                \"        ELSE NULL \" +\r\n                \"    END AS orderNum, \" +\r\n                \"    CASE \" +\r\n                \"        WHEN Receipt.OrderTypeId = 10 THEN (SELECT Vendor.Name FROM Po LEFT JOIN Vendor ON Po.VendorId = Vendor.Id WHERE Po.Id = Receipt.PoId) \" +\r\n                \"        ELSE NULL \" +\r\n                \"    END AS vendorName, \" +\r\n                \"    CASE \" +\r\n                \"        WHEN Receipt.OrderTypeId = 10 THEN (SELECT DateFirstShip FROM Po WHERE Id = Receipt.PoId) \" +\r\n                \"        WHEN Receipt.OrderTypeId = 20 THEN (SELECT DateFirstShip FROM So WHERE Id = Receipt.SoId) \" +\r\n                \"        WHEN Receipt.OrderTypeId = 40 THEN (SELECT DateScheduled FROM Xo WHERE Id = Receipt.XoId) \" +\r\n                \"        ELSE NULL \" +\r\n                \"    END AS dateScheduled \" +\r\n                \"FROM Receipt \" +\r\n                \"LEFT JOIN ReceiptStatus ON Receipt.StatusId = ReceiptStatus.Id \" +\r\n                \"INNER JOIN UserToLG ON Receipt.LocationGroupId = UserToLG.LocationGroupId AND UserToLG.UserId = \" + userId + \" \" +\r\n                \"WHERE ReceiptStatus.Name IN ('Entered', 'Reconciled', 'Received') \" +\r\n                \"ORDER BY Receipt.Id DESC\";\r\n\r\n            DashboardCommon.debugLog('Executing SQL query...', 'query', 'RCV');\r\n\r\n            const queryResult = runQuery(query);\r\n            const result = JSON.parse(queryResult);\r\n\r\n            DashboardCommon.debugLog('Parsed ' + result.length + ' records', 'success', 'RCV');\r\n\r\n            allData = result;\r\n            applyFilters();\r\n\r\n            DashboardCommon.debugLog('Load complete: ' + filteredData.length + ' receipts displayed', 'success', 'RCV');\r\n\r\n        } catch (error) {\r\n            DashboardCommon.debugLog('ERROR: ' + error.message, 'error', 'RCV');\r\n            console.error('Error loading receipts:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply filters to data (Receipts)\r\n     */\r\n    function applyFilters() {\r\n        filteredData = allData.filter(function(row) {\r\n            const container = document.getElementById(containerId);\r\n            const filterInputs = container.querySelectorAll('.filter-row input[data-filter]');\r\n            for (let i = 0; i < filterInputs.length; i++) {\r\n                const input = filterInputs[i];\r\n                if (input.value) {\r\n                    const filterKey = input.getAttribute('data-filter');\r\n                    let cellValue;\r\n\r\n                    // For date columns, filter on formatted date\r\n                    if (filterKey === 'datescheduled') {\r\n                        cellValue = DashboardCommon.formatDate(row[filterKey]).toLowerCase();\r\n                    } else {\r\n                        cellValue = (row[filterKey] || '').toString().toLowerCase();\r\n                    }\r\n\r\n                    const filterValue = input.value.toLowerCase();\r\n                    if (cellValue.indexOf(filterValue) === -1) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n\r\n        updateFilterInfo();\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Update filter info display\r\n     */\r\n    function updateFilterInfo() {\r\n        const filterInfo = document.getElementById(containerId + '-filterInfo');\r\n        if (!filterInfo) return;\r\n\r\n        if (allData.length !== filteredData.length) {\r\n            filterInfo.textContent = 'Showing ' + filteredData.length + ' of ' + allData.length + ' receipts';\r\n            filterInfo.style.display = 'inline-block';\r\n        } else {\r\n            filterInfo.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all filters\r\n     */\r\n    function clearFilters() {\r\n        const container = document.getElementById(containerId);\r\n        const inputs = container.querySelectorAll('.filter-row input');\r\n        for (let i = 0; i < inputs.length; i++) {\r\n            inputs[i].value = '';\r\n        }\r\n        applyFilters();\r\n    }\r\n\r\n    /**\r\n     * Sort table by column\r\n     * @param {string} column - Column name to sort by\r\n     */\r\n    function sortTable(column) {\r\n        if (sortColumn === column) {\r\n            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';\r\n        } else {\r\n            sortColumn = column;\r\n            sortDirection = 'asc';\r\n        }\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Sort data and render table\r\n     */\r\n    function sortAndRender() {\r\n        filteredData.sort(function(a, b) {\r\n            const aVal = a[sortColumn] || '';\r\n            const bVal = b[sortColumn] || '';\r\n\r\n            if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;\r\n            if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;\r\n            return 0;\r\n        });\r\n\r\n        renderTable();\r\n    }\r\n\r\n    /**\r\n     * Create cell content for a column\r\n     * @param {object} row - Data row\r\n     * @param {string} column - Column name\r\n     * @returns {HTMLElement} TD element\r\n     */\r\n    function createCellContent(row, column) {\r\n        const td = document.createElement('td');\r\n\r\n        if (column === 'scheduleindicator') {\r\n            const scheduleStatus = DashboardCommon.getScheduleStatus(row.datescheduled);\r\n            return DashboardCommon.createScheduleIndicator(scheduleStatus, row.datescheduled);\r\n        } else if (column === 'type') {\r\n            td.textContent = row.type || '';\r\n            td.title = row.type || '';\r\n        } else if (column === 'statusname') {\r\n            let statusClass = 'status-badge';\r\n            if (row.statusname === 'Entered') statusClass += ' status-estimate';\r\n            else if (row.statusname === 'Reconciled') statusClass += ' status-inprogress';\r\n            else if (row.statusname === 'Received') statusClass += ' status-issued';\r\n            const badge = document.createElement('span');\r\n            badge.className = statusClass;\r\n            badge.textContent = row.statusname || '';\r\n            td.appendChild(badge);\r\n            td.title = row.statusname || '';\r\n        } else if (column === 'ordernum') {\r\n            if (row.ordernum) {\r\n                const orderLink = document.createElement('a');\r\n                orderLink.href = '#';\r\n                orderLink.className = 'order-link';\r\n                orderLink.textContent = row.ordernum;\r\n                orderLink.onclick = function(e) {\r\n                    e.preventDefault();\r\n                    openReceipt(row.ordernum);\r\n                    return false;\r\n                };\r\n                td.appendChild(orderLink);\r\n                td.title = row.ordernum;\r\n            } else {\r\n                td.textContent = '';\r\n            }\r\n        } else if (column === 'vendorname') {\r\n            td.textContent = row.vendorname || '';\r\n            td.title = row.vendorname || '';\r\n        } else if (column === 'datescheduled') {\r\n            td.textContent = DashboardCommon.formatDate(row.datescheduled);\r\n            td.title = DashboardCommon.formatDate(row.datescheduled);\r\n        }\r\n\r\n        return td;\r\n    }\r\n\r\n    /**\r\n     * Render table with current data\r\n     */\r\n    function renderTable() {\r\n        const tbody = document.getElementById(containerId + '-tableBody');\r\n        if (!tbody) return;\r\n\r\n        tbody.innerHTML = '';\r\n\r\n        if (filteredData.length === 0) {\r\n            tbody.innerHTML = '<tr><td colspan=\"6\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">No receipts found</td></tr>';\r\n            return;\r\n        }\r\n\r\n        const columnOrder = ['scheduleindicator', 'statusname', 'type', 'ordernum', 'datescheduled', 'vendorname'];\r\n\r\n        for (let i = 0; i < filteredData.length; i++) {\r\n            const row = filteredData[i];\r\n            const tr = document.createElement('tr');\r\n\r\n            for (let j = 0; j < columnOrder.length; j++) {\r\n                const cell = createCellContent(row, columnOrder[j]);\r\n                tr.appendChild(cell);\r\n            }\r\n\r\n            tbody.appendChild(tr);\r\n        }\r\n\r\n        DashboardCommon.debugLog('Rendered ' + filteredData.length + ' rows', 'success', 'RCV');\r\n    }\r\n\r\n    /**\r\n     * Open receipt in Fishbowl\r\n     * @param {string} orderNum - Order number\r\n     */\r\n    function openReceipt(orderNum) {\r\n        openModule('Receiving', orderNum);\r\n    }\r\n\r\n    /**\r\n     * Refresh data\r\n     */\r\n    function refresh() {\r\n        loadData();\r\n    }\r\n\r\n    // Public API\r\n    return {\r\n        init: init,\r\n        refresh: refresh,\r\n        applyFilters: applyFilters,\r\n        clearFilters: clearFilters,\r\n        sortTable: sortTable\r\n    };\r\n})();\r\n/**\r\n * Items To Be Shipped Dashboard Module\r\n * Displays shipment items with filtering, sorting, and click-through\r\n */\r\n\r\nwindow.ReportSHIP = (function() {\r\n    'use strict';\r\n\r\n    // Private variables\r\n    let containerId = '';\r\n    let allData = [];\r\n    let filteredData = [];\r\n    let sortColumn = 'datescheduled';\r\n    let sortDirection = 'asc';\r\n\r\n    /**\r\n     * Initialize the Shipments tile\r\n     * @param {string} container - ID of the container element\r\n     */\r\n    function init(container) {\r\n        containerId = container;\r\n        DashboardCommon.debugLog('Initializing Shipments module', 'info', 'SHIP');\r\n        setupUI();\r\n        loadData();\r\n    }\r\n\r\n    /**\r\n     * Setup the UI structure\r\n     */\r\n    function setupUI() {\r\n        const container = document.getElementById(containerId);\r\n        if (!container) {\r\n            DashboardCommon.debugLog('Container not found: ' + containerId, 'error', 'SHIP');\r\n            return;\r\n        }\r\n\r\n        container.innerHTML = `\r\n            <div class=\"tile-header\">\r\n                <div>\r\n                    <h2 class=\"tile-title\">Items To Be Shipped</h2>\r\n                </div>\r\n                <div class=\"tile-controls\">\r\n                    <span id=\"${containerId}-filterInfo\" class=\"filter-info\" style=\"display: none;\"></span>\r\n                    <button class=\"btn\" onclick=\"ReportSHIP.clearFilters()\">Clear Filters</button>\r\n                    <button class=\"btn btn-primary\" onclick=\"ReportSHIP.refresh()\">Refresh</button>\r\n                </div>\r\n            </div>\r\n            <div class=\"tile-table-container\">\r\n                <table class=\"tile-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th data-column=\"scheduleindicator\" class=\"schedule-col\" onclick=\"ReportSHIP.sortTable('datescheduled')\" title=\"Schedule Status\">\r\n                                <svg class=\"clock-icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                                    <path d=\"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z\"/>\r\n                                </svg>\r\n                            </th>\r\n                            <th data-column=\"statusname\" onclick=\"ReportSHIP.sortTable('statusname')\">Status <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"type\" onclick=\"ReportSHIP.sortTable('type')\">Type <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"num\" onclick=\"ReportSHIP.sortTable('num')\">Number <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"ordernum\" onclick=\"ReportSHIP.sortTable('ordernum')\">Order # <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"datescheduled\" onclick=\"ReportSHIP.sortTable('datescheduled')\">Scheduled Date <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"shipto\" onclick=\"ReportSHIP.sortTable('shipto')\">Ship To <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"carrier\" onclick=\"ReportSHIP.sortTable('carrier')\">Carrier <span class=\"sort-icon\">⇅</span></th>\r\n                            <th data-column=\"service\" onclick=\"ReportSHIP.sortTable('service')\">Service <span class=\"sort-icon\">⇅</span></th>\r\n                        </tr>\r\n                        <tr class=\"filter-row\">\r\n                            <td data-filter=\"scheduleindicator\"></td>\r\n                            <td><input type=\"text\" data-filter=\"statusname\" placeholder=\"Filter...\" onkeyup=\"ReportSHIP.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"type\" placeholder=\"Filter...\" onkeyup=\"ReportSHIP.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"num\" placeholder=\"Filter...\" onkeyup=\"ReportSHIP.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"ordernum\" placeholder=\"Filter...\" onkeyup=\"ReportSHIP.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"datescheduled\" placeholder=\"Filter...\" onkeyup=\"ReportSHIP.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"shipto\" placeholder=\"Filter...\" onkeyup=\"ReportSHIP.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"carrier\" placeholder=\"Filter...\" onkeyup=\"ReportSHIP.applyFilters()\"></td>\r\n                            <td><input type=\"text\" data-filter=\"service\" placeholder=\"Filter...\" onkeyup=\"ReportSHIP.applyFilters()\"></td>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody id=\"${containerId}-tableBody\">\r\n                        <tr>\r\n                            <td colspan=\"9\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">Loading...</td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    /**\r\n     * Load shipments data\r\n     */\r\n    function loadData() {\r\n        DashboardCommon.debugLog('Starting data load...', 'info', 'SHIP');\r\n\r\n        try {\r\n            const currentUser = JSON.parse(getUser());\r\n            const userId = currentUser.id;\r\n            DashboardCommon.debugLog('Current user ID: ' + userId, 'info', 'SHIP');\r\n\r\n            const query =\r\n                \"SELECT \" +\r\n                \"    Ship.Id AS id, \" +\r\n                \"    Ship.Num AS num, \" +\r\n                \"    Ship.OrderTypeId AS orderTypeId, \" +\r\n                \"    Ship.ShipToName AS shipTo, \" +\r\n                \"    ShipStatus.Name AS statusName, \" +\r\n                \"    Carrier.Name AS carrier, \" +\r\n                \"    CarrierService.Name AS service, \" +\r\n                \"    CASE \" +\r\n                \"        WHEN Ship.OrderTypeId = 20 THEN So.Num \" +\r\n                \"        WHEN Ship.OrderTypeId = 10 THEN Po.Num \" +\r\n                \"        WHEN Ship.OrderTypeId = 40 THEN Xo.Num \" +\r\n                \"    END AS orderNum, \" +\r\n                \"    COALESCE(So.DateFirstShip, Po.DateFirstShip, Xo.DateScheduled) AS dateScheduled \" +\r\n                \"FROM Ship \" +\r\n                \"LEFT JOIN ShipStatus ON Ship.StatusId = ShipStatus.Id \" +\r\n                \"LEFT JOIN Carrier ON Ship.CarrierId = Carrier.Id \" +\r\n                \"LEFT JOIN CarrierService ON Ship.CarrierServiceId = CarrierService.Id \" +\r\n                \"LEFT JOIN So ON Ship.SoId = So.Id \" +\r\n                \"LEFT JOIN Po ON Ship.PoId = Po.Id \" +\r\n                \"LEFT JOIN Xo ON Ship.XoId = Xo.Id \" +\r\n                \"INNER JOIN UserToLG ON Ship.LocationGroupId = UserToLG.LocationGroupId AND UserToLG.UserId = \" + userId + \" \" +\r\n                \"WHERE ShipStatus.Name IN ('Entered', 'Packed') \" +\r\n                \"ORDER BY dateScheduled ASC\";\r\n\r\n            DashboardCommon.debugLog('Executing SQL query...', 'query', 'SHIP');\r\n\r\n            const queryResult = runQuery(query);\r\n            const result = JSON.parse(queryResult);\r\n\r\n            DashboardCommon.debugLog('Parsed ' + result.length + ' records', 'success', 'SHIP');\r\n\r\n            // Add type prefix\r\n            for (let i = 0; i < result.length; i++) {\r\n                if (result[i].ordertypeid === 10) result[i].type = 'PO';\r\n                else if (result[i].ordertypeid === 20) result[i].type = 'SO';\r\n                else if (result[i].ordertypeid === 30) result[i].type = 'WO';\r\n                else if (result[i].ordertypeid === 40) result[i].type = 'TO';\r\n                else result[i].type = '';\r\n            }\r\n\r\n            allData = result;\r\n            applyFilters();\r\n\r\n            DashboardCommon.debugLog('Load complete: ' + filteredData.length + ' shipments displayed', 'success', 'SHIP');\r\n\r\n        } catch (error) {\r\n            DashboardCommon.debugLog('ERROR: ' + error.message, 'error', 'SHIP');\r\n            console.error('Error loading shipments:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply filters to data (Ships)\r\n     */\r\n    function applyFilters() {\r\n        filteredData = allData.filter(function(row) {\r\n            const container = document.getElementById(containerId);\r\n            const filterInputs = container.querySelectorAll('.filter-row input[data-filter]');\r\n            for (let i = 0; i < filterInputs.length; i++) {\r\n                const input = filterInputs[i];\r\n                if (input.value) {\r\n                    const filterKey = input.getAttribute('data-filter');\r\n                    let cellValue;\r\n\r\n                    // For date columns, filter on formatted date\r\n                    if (filterKey === 'datescheduled') {\r\n                        cellValue = DashboardCommon.formatDate(row[filterKey]).toLowerCase();\r\n                    } else {\r\n                        cellValue = (row[filterKey] || '').toString().toLowerCase();\r\n                    }\r\n\r\n                    const filterValue = input.value.toLowerCase();\r\n                    if (cellValue.indexOf(filterValue) === -1) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n\r\n        updateFilterInfo();\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Update filter info display\r\n     */\r\n    function updateFilterInfo() {\r\n        const filterInfo = document.getElementById(containerId + '-filterInfo');\r\n        if (!filterInfo) return;\r\n\r\n        if (allData.length !== filteredData.length) {\r\n            filterInfo.textContent = 'Showing ' + filteredData.length + ' of ' + allData.length + ' shipments';\r\n            filterInfo.style.display = 'inline-block';\r\n        } else {\r\n            filterInfo.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all filters\r\n     */\r\n    function clearFilters() {\r\n        const container = document.getElementById(containerId);\r\n        const inputs = container.querySelectorAll('.filter-row input');\r\n        for (let i = 0; i < inputs.length; i++) {\r\n            inputs[i].value = '';\r\n        }\r\n        applyFilters();\r\n    }\r\n\r\n    /**\r\n     * Sort table by column\r\n     * @param {string} column - Column name to sort by\r\n     */\r\n    function sortTable(column) {\r\n        if (sortColumn === column) {\r\n            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';\r\n        } else {\r\n            sortColumn = column;\r\n            sortDirection = 'asc';\r\n        }\r\n        sortAndRender();\r\n    }\r\n\r\n    /**\r\n     * Sort data and render table\r\n     */\r\n    function sortAndRender() {\r\n        filteredData.sort(function(a, b) {\r\n            const aVal = a[sortColumn] || '';\r\n            const bVal = b[sortColumn] || '';\r\n\r\n            if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;\r\n            if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;\r\n            return 0;\r\n        });\r\n\r\n        renderTable();\r\n    }\r\n\r\n    /**\r\n     * Create cell content for a column\r\n     * @param {object} row - Data row\r\n     * @param {string} column - Column name\r\n     * @returns {HTMLElement} TD element\r\n     */\r\n    function createCellContent(row, column) {\r\n        const td = document.createElement('td');\r\n\r\n        if (column === 'scheduleindicator') {\r\n            const scheduleStatus = DashboardCommon.getScheduleStatus(row.datescheduled);\r\n            return DashboardCommon.createScheduleIndicator(scheduleStatus, row.datescheduled);\r\n        } else if (column === 'type') {\r\n            td.textContent = row.type || '';\r\n            td.title = row.type || '';\r\n        } else if (column === 'statusname') {\r\n            let statusClass = 'status-badge';\r\n            if (row.statusname === 'Entered') statusClass += ' status-estimate';\r\n            else if (row.statusname === 'Packed') statusClass += ' status-inprogress';\r\n            else if (row.statusname === 'Shipped') statusClass += ' status-issued';\r\n            const badge = document.createElement('span');\r\n            badge.className = statusClass;\r\n            badge.textContent = row.statusname || '';\r\n            td.appendChild(badge);\r\n            td.title = row.statusname || '';\r\n        } else if (column === 'num') {\r\n            const shipLink = document.createElement('a');\r\n            shipLink.href = '#';\r\n            shipLink.className = 'order-link';\r\n            shipLink.textContent = row.num;\r\n            shipLink.onclick = function(e) {\r\n                e.preventDefault();\r\n                openShip(row.num);\r\n                return false;\r\n            };\r\n            td.appendChild(shipLink);\r\n            td.title = row.num;\r\n        } else if (column === 'ordernum') {\r\n            if (row.ordernum) {\r\n                const orderLink = document.createElement('a');\r\n                orderLink.href = '#';\r\n                orderLink.className = 'order-link';\r\n                orderLink.textContent = row.ordernum;\r\n                orderLink.onclick = function(e) {\r\n                    e.preventDefault();\r\n                    openOrder(row.ordernum, row.ordertypeid);\r\n                    return false;\r\n                };\r\n                td.appendChild(orderLink);\r\n                td.title = row.ordernum;\r\n            } else {\r\n                td.textContent = '';\r\n            }\r\n        } else if (column === 'datescheduled') {\r\n            td.textContent = DashboardCommon.formatDate(row.datescheduled);\r\n            td.title = DashboardCommon.formatDate(row.datescheduled);\r\n        } else if (column === 'shipto' || column === 'carrier' || column === 'service') {\r\n            td.textContent = row[column] || '';\r\n            td.title = row[column] || '';\r\n        }\r\n\r\n        return td;\r\n    }\r\n\r\n    /**\r\n     * Render table with current data\r\n     */\r\n    function renderTable() {\r\n        const tbody = document.getElementById(containerId + '-tableBody');\r\n        if (!tbody) return;\r\n\r\n        tbody.innerHTML = '';\r\n\r\n        if (filteredData.length === 0) {\r\n            tbody.innerHTML = '<tr><td colspan=\"9\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">No shipments found</td></tr>';\r\n            return;\r\n        }\r\n\r\n        const columnOrder = ['scheduleindicator', 'statusname', 'type', 'num', 'ordernum', 'datescheduled', 'shipto', 'carrier', 'service'];\r\n\r\n        for (let i = 0; i < filteredData.length; i++) {\r\n            const row = filteredData[i];\r\n            const tr = document.createElement('tr');\r\n\r\n            for (let j = 0; j < columnOrder.length; j++) {\r\n                const cell = createCellContent(row, columnOrder[j]);\r\n                tr.appendChild(cell);\r\n            }\r\n\r\n            tbody.appendChild(tr);\r\n        }\r\n\r\n        DashboardCommon.debugLog('Rendered ' + filteredData.length + ' rows', 'success', 'SHIP');\r\n    }\r\n\r\n    /**\r\n     * Open shipment in Fishbowl\r\n     * @param {string} shipNum - Ship number\r\n     */\r\n    function openShip(shipNum) {\r\n        openModule(\"Shipping\", shipNum);\r\n    }\r\n\r\n    /**\r\n     * Open order in Fishbowl\r\n     * @param {string} orderNum - Order number\r\n     * @param {number} orderTypeId - Order type ID\r\n     */\r\n    function openOrder(orderNum, orderTypeId) {\r\n        if (orderTypeId === 10) {\r\n            openModule(\"Purchase Order\", orderNum);\r\n        } else if (orderTypeId === 20) {\r\n            openModule(\"Sales Order\", orderNum);\r\n        } else if (orderTypeId === 30) {\r\n            openModule(\"Work Order\", orderNum);\r\n        } else if (orderTypeId === 40) {\r\n            openModule(\"Transfer Order\", orderNum);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Refresh data\r\n     */\r\n    function refresh() {\r\n        loadData();\r\n    }\r\n\r\n    // Public API\r\n    return {\r\n        init: init,\r\n        refresh: refresh,\r\n        applyFilters: applyFilters,\r\n        clearFilters: clearFilters,\r\n        sortTable: sortTable\r\n    };\r\n})();\r\n    </script>\r\n    <script>\r\n        /**\r\n         * Main Dashboard Controller\r\n         */\r\n        window.Dashboard = (function() {\r\n            'use strict';\r\n\r\n            // Configuration\r\n            const TILE_MAP = {\r\n                'SO': { module: 'ReportSO', name: 'Sales Orders' },\r\n                'PO': { module: 'ReportPO', name: 'Purchase Orders' },\r\n                'WO': { module: 'ReportWO', name: 'Work Orders' },\r\n                'RMA': { module: 'ReportRMA', name: 'RMA Orders' },\r\n                'TO': { module: 'ReportTO', name: 'Transfer Orders' },\r\n                'PICK': { module: 'ReportPICK', name: 'Items To Be Picked' },\r\n                'RCV': { module: 'ReportRCV', name: 'Items To Be Received' },\r\n                'SHIP': { module: 'ReportSHIP', name: 'Items To Be Shipped' }\r\n            };\r\n\r\n            const DEFAULT_LAYOUT = '2-SO-PO-WO-RMA-TO-PICK-RCV-SHIP'; // Default: 2 columns with all available tiles\r\n            const DEFAULT_ROWS = 5;\r\n            const DEFAULT_COLUMNS = 2;\r\n\r\n            let activeTiles = [];\r\n            let refreshInterval = null;\r\n\r\n            /**\r\n             * Initialize the dashboard\r\n             */\r\n            function init() {\r\n                DashboardCommon.debugLog('Initializing dashboard...', 'info', 'DASH');\r\n\r\n                // Show debug console if enabled\r\n                if (DashboardCommon.DEBUG_MODE) {\r\n                    document.getElementById('debugConsole').style.display = 'block';\r\n                    DashboardCommon.debugLog('Debug mode enabled', 'info', 'DASH');\r\n                }\r\n\r\n                // Parse configuration\r\n                const config = parseConfiguration();\r\n                DashboardCommon.debugLog('Configuration: ' + JSON.stringify(config), 'info', 'DASH');\r\n\r\n                // Setup grid layout\r\n                setupGrid(config);\r\n\r\n                // Create tiles\r\n                createTiles(config.tiles);\r\n\r\n                // Setup auto-refresh if configured\r\n                if (config.refreshSeconds > 0) {\r\n                    setupAutoRefresh(config.refreshSeconds);\r\n                }\r\n\r\n                DashboardCommon.debugLog('Dashboard initialization complete', 'success', 'DASH');\r\n            }\r\n\r\n            /**\r\n             * Parse configuration from properties\r\n             * @returns {object} Configuration object\r\n             */\r\n            function parseConfiguration() {\r\n                // Get layout property (format: \"{cols}-{tile1}-{tile2}-...\")\r\n                const layoutProp = getProperty('BI_DASHBOARD_LAYOUT', DEFAULT_LAYOUT);\r\n                const parts = layoutProp.split('-');\r\n\r\n                const columns = parseInt(parts[0]) || DEFAULT_COLUMNS;\r\n                const tiles = parts.slice(1); // Remaining parts are tile codes\r\n\r\n                // Validate columns (1-4)\r\n                const validColumns = Math.max(1, Math.min(4, columns));\r\n\r\n                // Get rows property\r\n                const rowsProp = getProperty('BI_DASHBOARD_ROWS', DEFAULT_ROWS.toString());\r\n                const rows = parseInt(rowsProp) || DEFAULT_ROWS;\r\n\r\n                // Get refresh property (in seconds, 0 = disabled)\r\n                const refreshProp = getProperty('BI_DASHBOARD_REFRESH', '0');\r\n                const refreshSeconds = parseInt(refreshProp) || 0;\r\n\r\n                return {\r\n                    columns: validColumns,\r\n                    rows: rows,\r\n                    tiles: tiles,\r\n                    refreshSeconds: refreshSeconds\r\n                };\r\n            }\r\n\r\n            /**\r\n             * Setup grid layout\r\n             * @param {object} config - Configuration object\r\n             */\r\n            function setupGrid(config) {\r\n                const grid = document.getElementById('dashboardGrid');\r\n                grid.className = 'cols-' + config.columns;\r\n\r\n                // Calculate tile height based on number of rows\r\n                // Measured heights: TH=41px (12+15+12+2), Filter=37px (8+21+8), Data row=36px (8+15+8+1+margins)\r\n                const columnHeaderHeight = 41;\r\n                const filterRowHeight = 37;\r\n                const rowHeight = 36;\r\n                const tableContentHeight = columnHeaderHeight + filterRowHeight + (config.rows * rowHeight);\r\n\r\n                // Set max-height for tile-table-container (excludes tile-header)\r\n                const style = document.createElement('style');\r\n                style.textContent = `.tile-table-container { max-height: ${tableContentHeight}px; }`;\r\n                document.head.appendChild(style);\r\n\r\n                DashboardCommon.debugLog('Grid setup: ' + config.columns + ' columns, ' + config.rows + ' rows per tile', 'info', 'DASH');\r\n            }\r\n\r\n            /**\r\n             * Create tiles based on configuration\r\n             * @param {array} tileCodes - Array of tile codes\r\n             */\r\n            function createTiles(tileCodes) {\r\n                const grid = document.getElementById('dashboardGrid');\r\n\r\n                if (tileCodes.length === 0) {\r\n                    // No tiles specified, show all available\r\n                    tileCodes = Object.keys(TILE_MAP);\r\n                    DashboardCommon.debugLog('No tiles specified, showing all available tiles', 'info', 'DASH');\r\n                }\r\n\r\n                for (let i = 0; i < tileCodes.length; i++) {\r\n                    const tileCode = tileCodes[i].toUpperCase();\r\n\r\n                    if (!TILE_MAP[tileCode]) {\r\n                        DashboardCommon.debugLog('Invalid tile code: ' + tileCode + ' (skipping)', 'warning', 'DASH');\r\n\r\n                        // Create error tile\r\n                        const errorTile = document.createElement('div');\r\n                        errorTile.className = 'dashboard-tile';\r\n                        errorTile.innerHTML = '<div class=\"error-tile\">Invalid tile code: ' + tileCode + '</div>';\r\n                        grid.appendChild(errorTile);\r\n                        continue;\r\n                    }\r\n\r\n                    const tileConfig = TILE_MAP[tileCode];\r\n                    const containerId = 'tile-' + tileCode.toLowerCase();\r\n\r\n                    // Create tile container\r\n                    const tileDiv = document.createElement('div');\r\n                    tileDiv.className = 'dashboard-tile';\r\n                    tileDiv.id = containerId;\r\n                    grid.appendChild(tileDiv);\r\n\r\n                    // Initialize the module\r\n                    try {\r\n                        const module = window[tileConfig.module];\r\n                        if (module && typeof module.init === 'function') {\r\n                            module.init(containerId);\r\n                            activeTiles.push({ code: tileCode, module: module });\r\n                            DashboardCommon.debugLog('Initialized tile: ' + tileCode, 'success', 'DASH');\r\n                        } else {\r\n                            throw new Error('Module not found or missing init function: ' + tileConfig.module);\r\n                        }\r\n                    } catch (error) {\r\n                        DashboardCommon.debugLog('Error initializing tile ' + tileCode + ': ' + error.message, 'error', 'DASH');\r\n                        tileDiv.innerHTML = '<div class=\"error-tile\">Error loading ' + tileConfig.name + ': ' + error.message + '</div>';\r\n                    }\r\n                }\r\n            }\r\n\r\n            /**\r\n             * Setup auto-refresh\r\n             * @param {number} seconds - Refresh interval in seconds\r\n             */\r\n            function setupAutoRefresh(seconds) {\r\n                DashboardCommon.debugLog('Setting up auto-refresh: every ' + seconds + ' seconds', 'info', 'DASH');\r\n\r\n                refreshInterval = setInterval(function() {\r\n                    DashboardCommon.debugLog('Auto-refresh triggered', 'info', 'DASH');\r\n                    refreshAll();\r\n                }, seconds * 1000);\r\n            }\r\n\r\n            /**\r\n             * Refresh all active tiles\r\n             */\r\n            function refreshAll() {\r\n                for (let i = 0; i < activeTiles.length; i++) {\r\n                    const tile = activeTiles[i];\r\n                    if (tile.module && typeof tile.module.refresh === 'function') {\r\n                        tile.module.refresh();\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Public API\r\n            return {\r\n                init: init,\r\n                refreshAll: refreshAll\r\n            };\r\n        })();\r\n\r\n        // Initialize dashboard on page load\r\n        window.onload = function() {\r\n            Dashboard.init();\r\n        };\r\n    </script>\r\n</body>\r\n</html>\r\n",
  "active" : true,
  "note" : "",
  "type" : "Page"
} ]