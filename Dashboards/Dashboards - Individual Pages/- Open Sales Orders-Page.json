[ {
  "name" : "- Open Sales Orders",
  "description" : "- Open Sales Orders",
  "data" : "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Open Sales Orders</title>\r\n\r\n    <!-- Google Fonts - Inter -->\r\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap\" rel=\"stylesheet\">\r\n\r\n    <!-- Moment.js for date formatting -->\r\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js\"></script>\r\n\r\n    <style>\r\n        * {\r\n            margin: 0;\r\n            padding: 0;\r\n            box-sizing: border-box;\r\n        }\r\n\r\n        body {\r\n            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\r\n            font-size: 12px;\r\n            padding: 8px;\r\n            background: #f5f5f5;\r\n        }\r\n\r\n        .header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            margin-bottom: 8px;\r\n            padding: 8px;\r\n            background: white;\r\n            border: 1px solid #ddd;\r\n            border-radius: 4px;\r\n        }\r\n\r\n        .header h1 {\r\n            font-size: 16px;\r\n            font-weight: 600;\r\n            color: #333;\r\n        }\r\n\r\n        .controls {\r\n            display: flex;\r\n            gap: 8px;\r\n            align-items: center;\r\n        }\r\n\r\n        .btn {\r\n            padding: 6px 12px;\r\n            font-size: 12px;\r\n            border: 1px solid #ccc;\r\n            background: white;\r\n            border-radius: 3px;\r\n            cursor: pointer;\r\n            font-weight: 500;\r\n        }\r\n\r\n        .btn:hover {\r\n            background: #f0f0f0;\r\n        }\r\n\r\n        .btn-primary {\r\n            background: #2d9cdb;\r\n            color: white;\r\n            border-color: #2d9cdb;\r\n        }\r\n\r\n        .btn-primary:hover {\r\n            background: #1e7bb4;\r\n        }\r\n\r\n        .table-container {\r\n            background: white;\r\n            border: 1px solid #ddd;\r\n            border-radius: 4px;\r\n            overflow: auto;\r\n            height: calc(100vh - 80px);\r\n        }\r\n\r\n        table {\r\n            width: 100%;\r\n            border-collapse: collapse;\r\n            font-size: 12px;\r\n            table-layout: auto;\r\n        }\r\n\r\n        th {\r\n            background: #f8f9fa;\r\n            padding: 12px 8px;\r\n            text-align: left;\r\n            font-size: 12px;\r\n            font-weight: 600;\r\n            color: #475569;\r\n            text-transform: uppercase;\r\n            letter-spacing: 0.5px;\r\n            border-bottom: 2px solid #e2e8f0;\r\n            position: sticky;\r\n            top: 0;\r\n            z-index: 10;\r\n            white-space: nowrap;\r\n            cursor: pointer;\r\n            user-select: none;\r\n        }\r\n\r\n        /* Column width controls */\r\n        th[data-column=\"scheduleindicator\"], td:first-child {\r\n            width: 50px;\r\n            min-width: 50px;\r\n            max-width: 50px;\r\n        }\r\n\r\n        th[data-column=\"statusname\"] {\r\n            width: 100px;\r\n            min-width: 100px;\r\n        }\r\n\r\n        th[data-column=\"num\"] {\r\n            width: 120px;\r\n            min-width: 100px;\r\n        }\r\n\r\n        th[data-column=\"customername\"],\r\n        th[data-column=\"vendorname\"] {\r\n            min-width: 120px;\r\n            max-width: 200px;\r\n        }\r\n\r\n        th[data-column=\"customerpo\"],\r\n        th[data-column=\"customerso\"] {\r\n            min-width: 100px;\r\n            max-width: 150px;\r\n        }\r\n\r\n        th[data-column=\"dateissued\"],\r\n        th[data-column=\"datefirstship\"],\r\n        th[data-column=\"datescheduled\"],\r\n        th[data-column=\"datecreated\"],\r\n        th[data-column=\"dateexpires\"] {\r\n            width: 110px;\r\n            min-width: 100px;\r\n        }\r\n\r\n        th:hover {\r\n            background: #e9ecef;\r\n        }\r\n\r\n        th[draggable=\"true\"] {\r\n            cursor: move;\r\n        }\r\n\r\n        th.drag-over {\r\n            background: #cbd5e1;\r\n            border-left: 3px solid #2d9cdb;\r\n        }\r\n\r\n        th .sort-icon {\r\n            margin-left: 4px;\r\n            font-size: 10px;\r\n            color: #94a3b8;\r\n        }\r\n\r\n        td {\r\n            padding: 8px;\r\n            border-bottom: 1px solid #e9ecef;\r\n            color: #334155;\r\n            font-size: 12px;\r\n            max-width: 250px;\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            white-space: nowrap;\r\n        }\r\n\r\n        tr:hover {\r\n            background-color: #f8fafc;\r\n        }\r\n\r\n        tr:nth-child(even) {\r\n            background-color: #fafafa;\r\n        }\r\n\r\n        tr:nth-child(even):hover {\r\n            background-color: #f8fafc;\r\n        }\r\n\r\n        .filter-row input {\r\n            width: 100%;\r\n            padding: 4px;\r\n            font-size: 11px;\r\n            border: 1px solid #cbd5e1;\r\n            border-radius: 3px;\r\n        }\r\n\r\n        .filter-row input:focus {\r\n            outline: none;\r\n            border-color: #2d9cdb;\r\n        }\r\n\r\n        .order-link {\r\n            color: #2d9cdb;\r\n            text-decoration: none;\r\n            font-weight: 600;\r\n        }\r\n\r\n        .order-link:hover {\r\n            text-decoration: underline;\r\n            color: #1e7bb4;\r\n        }\r\n\r\n        .status-badge {\r\n            display: inline-block;\r\n            padding: 2px 8px;\r\n            border-radius: 3px;\r\n            font-size: 11px;\r\n            font-weight: 600;\r\n        }\r\n\r\n        .status-estimate {\r\n            background: #fff3cd;\r\n            color: #856404;\r\n        }\r\n\r\n        .status-inprogress {\r\n            background: #cce5ff;\r\n            color: #004085;\r\n        }\r\n\r\n        .status-issued {\r\n            background: #d4edda;\r\n            color: #155724;\r\n        }\r\n\r\n        .status-entered {\r\n            background: #fff3cd;\r\n            color: #856404;\r\n        }\r\n\r\n        .status-started {\r\n            background: #cce5ff;\r\n            color: #004085;\r\n        }\r\n\r\n        .status-committed {\r\n            background: #cce5ff;\r\n            color: #004085;\r\n        }\r\n\r\n        .status-picked {\r\n            background: #d4edda;\r\n            color: #155724;\r\n        }\r\n\r\n        .status-packed {\r\n            background: #c3e6cb;\r\n            color: #0f5132;\r\n        }\r\n\r\n        .status-shipped {\r\n            background: #e2e8f0;\r\n            color: #475569;\r\n        }\r\n\r\n        .schedule-indicator {\r\n            width: 12px;\r\n            height: 12px;\r\n            border-radius: 50%;\r\n            display: inline-block;\r\n        }\r\n\r\n        .schedule-indicator.blue {\r\n            background-color: #2d9cdb;\r\n        }\r\n\r\n        .schedule-indicator.orange {\r\n            background-color: #f59e0b;\r\n        }\r\n\r\n        .schedule-indicator.red {\r\n            background-color: #ef4444;\r\n        }\r\n\r\n        th.schedule-col {\r\n            width: 40px;\r\n            text-align: center;\r\n            padding-left: 4px;\r\n            padding-right: 4px;\r\n        }\r\n\r\n        .clock-icon {\r\n            width: 16px;\r\n            height: 16px;\r\n            display: inline-block;\r\n            vertical-align: middle;\r\n        }\r\n\r\n        .loading {\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            background: rgba(0, 0, 0, 0.5);\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            z-index: 9999;\r\n        }\r\n\r\n        .loading-content {\r\n            background: white;\r\n            padding: 20px 30px;\r\n            border-radius: 8px;\r\n            text-align: center;\r\n        }\r\n\r\n        .spinner {\r\n            border: 3px solid #f3f3f3;\r\n            border-top: 3px solid #2d9cdb;\r\n            border-radius: 50%;\r\n            width: 40px;\r\n            height: 40px;\r\n            animation: spin 1s linear infinite;\r\n            margin: 0 auto 10px;\r\n        }\r\n\r\n        @keyframes spin {\r\n            0% { transform: rotate(0deg); }\r\n            100% { transform: rotate(360deg); }\r\n        }\r\n\r\n        .filter-info {\r\n            font-size: 12px;\r\n            color: #666;\r\n            padding: 4px 8px;\r\n            background: #fff3cd;\r\n            border-radius: 3px;\r\n        }\r\n\r\n        /* Debug Console */\r\n        #debugConsole {\r\n            margin-top: 12px;\r\n            background: #1e293b;\r\n            border: 1px solid #334155;\r\n            border-radius: 4px;\r\n            padding: 12px;\r\n        }\r\n\r\n        #debugLog {\r\n            background: #0f172a;\r\n            border-radius: 4px;\r\n            padding: 8px;\r\n            height: 200px;\r\n            overflow-y: auto;\r\n            font-family: 'Courier New', monospace;\r\n            font-size: 11px;\r\n            color: #e2e8f0;\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"header\">\r\n        <div>\r\n            <h1>Open Sales Orders</h1>\r\n        </div>\r\n        <div class=\"controls\">\r\n            <span id=\"filterInfo\" class=\"filter-info\" style=\"display: none;\"></span>\r\n            <label style=\"font-size: 12px;\">\r\n                <input type=\"checkbox\" id=\"hideEstimates\" onchange=\"applyFilters()\">\r\n                Hide Estimates\r\n            </label>\r\n            <button class=\"btn\" onclick=\"clearFilters()\">Clear Filters</button>\r\n            <button class=\"btn btn-primary\" onclick=\"loadData()\">Refresh</button>\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"table-container\">\r\n        <table id=\"dataTable\">\r\n            <thead>\r\n                <tr id=\"headerRow\">\r\n                    <th draggable=\"true\" data-column=\"statusname\" onclick=\"sortTable('statusname')\">Status <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"scheduleindicator\" class=\"schedule-col\" onclick=\"sortTable('datefirstship')\" title=\"Schedule Status\">\r\n                        <svg class=\"clock-icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                            <path d=\"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z\"/>\r\n                        </svg>\r\n                    </th>\r\n                    <th draggable=\"true\" data-column=\"num\" onclick=\"sortTable('num')\">Number <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"customername\" onclick=\"sortTable('customername')\">Customer <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"customerpo\" onclick=\"sortTable('customerpo')\">Customer PO <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"dateissued\" onclick=\"sortTable('dateissued')\">Date Issued <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"datefirstship\" onclick=\"sortTable('datefirstship')\">Date Scheduled <span class=\"sort-icon\">⇅</span></th>\r\n                </tr>\r\n                <tr class=\"filter-row\" id=\"filterRow\">\r\n                    <td><input type=\"text\" data-filter=\"statusname\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td data-filter=\"scheduleindicator\"></td>\r\n                    <td><input type=\"text\" data-filter=\"num\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td><input type=\"text\" data-filter=\"customername\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td><input type=\"text\" data-filter=\"customerpo\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td><input type=\"text\" data-filter=\"dateissued\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td><input type=\"text\" data-filter=\"datefirstship\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                </tr>\r\n            </thead>\r\n            <tbody id=\"tableBody\">\r\n                <tr>\r\n                    <td colspan=\"7\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">Loading...</td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n\r\n    <!-- Debug Console -->\r\n    <div id=\"debugConsole\" style=\"display: none;\">\r\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\r\n            <h3 style=\"font-size: 12px; font-weight: 600; color: #94a3b8; margin: 0;\">Debug Console</h3>\r\n            <button onclick=\"clearDebugLog()\" class=\"btn\" style=\"padding: 4px 8px; font-size: 11px;\">Clear</button>\r\n        </div>\r\n        <div id=\"debugLog\">\r\n            <div style=\"color: #64748b; font-style: italic;\">Initializing...</div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id=\"loading\" class=\"loading\" style=\"display: none;\">\r\n        <div class=\"loading-content\">\r\n            <div class=\"spinner\"></div>\r\n            <p style=\"font-weight: 600; color: #333;\">Loading sales orders...</p>\r\n        </div>\r\n    </div>\r\n\r\n    <script>\r\n        // Configuration\r\n        const HIDE_ESTIMATES_DEFAULT = false; // Set to true to hide estimates by default\r\n\r\n        // Get date format from Fishbowl settings (Java SimpleDateFormat)\r\n        const FB_DATE_FORMAT = typeof getProperty === 'function' ? getProperty('DateFormatShort', 'MM/dd/yyyy') : 'MM/dd/yyyy';\r\n        // Convert Java SimpleDateFormat to Moment.js format (dd→DD, yyyy→YYYY)\r\n        const MOMENT_DATE_FORMAT = FB_DATE_FORMAT\r\n            .replace(/yyyy/g, 'YYYY')\r\n            .replace(/yy/g, 'YY')\r\n            .replace(/dd/g, 'DD');\r\n\r\n        // Get BI_SHOW_DEBUG property (default to false if property can't be read)\r\n        const BI_SHOW_DEBUG_PROP = typeof getProperty === 'function' ? getProperty('BI_SHOW_DEBUG', 'false') : 'false';\r\n        const DEBUG_MODE = BI_SHOW_DEBUG_PROP === 'true' || BI_SHOW_DEBUG_PROP === true;\r\n\r\n        // Get BI_SO_SHOW_ESTIMATE property (true = show estimates, false = hide estimates)\r\n        const BI_SO_SHOW_ESTIMATE_PROP = typeof getProperty === 'function' ? getProperty('BI_SO_SHOW_ESTIMATE', HIDE_ESTIMATES_DEFAULT ? 'false' : 'true') : (HIDE_ESTIMATES_DEFAULT ? 'false' : 'true');\r\n        // Convert to boolean and invert for \"hide\" checkbox (property is SHOW, checkbox is HIDE)\r\n        const HIDE_ESTIMATES = BI_SO_SHOW_ESTIMATE_PROP === 'false' || BI_SO_SHOW_ESTIMATE_PROP === false;\r\n\r\n        let allData = [];\r\n        let filteredData = [];\r\n        let sortColumn = 'dateissued';\r\n        let sortDirection = 'desc';\r\n        let columnOrder = ['scheduleindicator', 'statusname', 'num', 'datefirstship', 'dateissued', 'customername', 'customerpo'];\r\n\r\n        // Load saved column order\r\n        try {\r\n            var savedOrder = localStorage.getItem('salesOrdersColumnOrder');\r\n            if (savedOrder) {\r\n                columnOrder = JSON.parse(savedOrder);\r\n            }\r\n        } catch (e) {\r\n            // Ignore localStorage errors\r\n        }\r\n\r\n        // Debug logging\r\n        function debugLog(message, type) {\r\n            if (!DEBUG_MODE) return;\r\n\r\n            var timestamp = new Date().toLocaleTimeString();\r\n            var logDiv = document.getElementById('debugLog');\r\n\r\n            var placeholder = logDiv.querySelector('[style*=\"italic\"]');\r\n            if (placeholder) {\r\n                logDiv.innerHTML = '';\r\n            }\r\n\r\n            var colors = {\r\n                'info': '#60a5fa',\r\n                'success': '#34d399',\r\n                'warning': '#fbbf24',\r\n                'error': '#f87171',\r\n                'query': '#a78bfa'\r\n            };\r\n\r\n            var entry = document.createElement('div');\r\n            entry.style.marginBottom = '4px';\r\n            entry.innerHTML = '<span style=\"color: #64748b;\">[' + timestamp + ']</span> <span style=\"color: ' + colors[type] + ';\">' + message + '</span>';\r\n\r\n            logDiv.appendChild(entry);\r\n            logDiv.scrollTop = logDiv.scrollHeight;\r\n        }\r\n\r\n        function clearDebugLog() {\r\n            document.getElementById('debugLog').innerHTML = '<div style=\"color: #64748b; font-style: italic;\">Log cleared...</div>';\r\n        }\r\n\r\n        // Format date using Fishbowl DateFormatShort property\r\n        function formatDate(dateStr) {\r\n            if (!dateStr) return '';\r\n            return moment(dateStr).format(MOMENT_DATE_FORMAT);\r\n        }\r\n\r\n        // Get schedule status for indicator\r\n        function getScheduleStatus(dateStr) {\r\n            if (!dateStr) return '';\r\n\r\n            // Parse date from SQL format (YYYY-MM-DD HH:mm:ss)\r\n            var dateParts = dateStr.split(' ')[0].split('-');\r\n            var schedDate = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);\r\n            schedDate.setHours(0, 0, 0, 0);\r\n\r\n            var today = new Date();\r\n            today.setHours(0, 0, 0, 0);\r\n\r\n            // Check if today\r\n            if (schedDate.getTime() === today.getTime()) {\r\n                return 'orange';\r\n            }\r\n\r\n            // Check if past\r\n            if (schedDate < today) {\r\n                return 'red';\r\n            }\r\n\r\n            // Check if within this calendar week (Sunday to Saturday)\r\n            var todayDay = today.getDay(); // 0 = Sunday, 6 = Saturday\r\n            var weekStart = new Date(today);\r\n            weekStart.setDate(today.getDate() - todayDay);\r\n            var weekEnd = new Date(weekStart);\r\n            weekEnd.setDate(weekStart.getDate() + 6);\r\n\r\n            if (schedDate >= weekStart && schedDate <= weekEnd) {\r\n                return 'blue';\r\n            }\r\n\r\n            return '';\r\n        }\r\n\r\n        // Map pick status to user-friendly display name\r\n        function mapPickStatusToDisplay(pickStatusName) {\r\n            if (pickStatusName === 'Entered') return 'To Pick';\r\n            if (pickStatusName === 'Started') return 'Picking';\r\n            return pickStatusName;\r\n        }\r\n\r\n        // Calculate display status based on pick and ship progression\r\n        function calculatePickShipStatus(row) {\r\n            var pickInfo = row.pickinfo || row.pickInfo || '';\r\n            var shipInfo = row.shipinfo || row.shipInfo || '';\r\n\r\n            // If no pick info, return original SO status\r\n            if (!pickInfo || pickInfo === 'null') {\r\n                return {\r\n                    displayStatus: row.statusname || row.statusName,\r\n                    tooltip: row.statusname || row.statusName,\r\n                    isPartial: false\r\n                };\r\n            }\r\n\r\n            // Parse pick information: \"pickNum:statusId:statusName|pickNum2:statusId2:statusName2\"\r\n            var picks = pickInfo.split('|').map(function(p) {\r\n                var parts = p.split(':');\r\n                return {\r\n                    num: parts[0],\r\n                    statusId: parseInt(parts[1]),\r\n                    statusName: parts[2]\r\n                };\r\n            }).filter(function(p) {\r\n                return p.num && p.statusId > 0;\r\n            });\r\n\r\n            // Parse ship information\r\n            var ships = shipInfo && shipInfo !== 'null' ? shipInfo.split('|').map(function(s) {\r\n                var parts = s.split(':');\r\n                return {\r\n                    num: parts[0],\r\n                    statusId: parseInt(parts[1]),\r\n                    statusName: parts[2]\r\n                };\r\n            }).filter(function(s) {\r\n                return s.num && s.statusId > 0;\r\n            }) : [];\r\n\r\n            // Build tooltip\r\n            var tooltipParts = [];\r\n            if (picks.length > 0) {\r\n                tooltipParts.push('Picks:');\r\n                picks.forEach(function(p) {\r\n                    tooltipParts.push('  Pick ' + p.num + ': ' + p.statusName);\r\n                });\r\n            }\r\n            if (ships.length > 0) {\r\n                tooltipParts.push('Shipments:');\r\n                ships.forEach(function(s) {\r\n                    tooltipParts.push('  Ship ' + s.num + ': ' + s.statusName);\r\n                });\r\n            }\r\n            var tooltip = tooltipParts.join('\\n');\r\n\r\n            // No picks found\r\n            if (picks.length === 0) {\r\n                return {\r\n                    displayStatus: row.statusname || row.statusName,\r\n                    tooltip: tooltip || row.statusname || row.statusName,\r\n                    isPartial: false\r\n                };\r\n            }\r\n\r\n            // Check if all picks are Finished (statusId = 40)\r\n            var allPicksFinished = picks.every(function(p) {\r\n                return p.statusId === 40;\r\n            });\r\n\r\n            if (allPicksFinished) {\r\n                // All picks finished, check ship status\r\n                if (ships.length > 0) {\r\n                    var maxShipStatus = Math.max.apply(Math, ships.map(function(s) { return s.statusId; }));\r\n\r\n                    if (maxShipStatus === 30) {\r\n                        return { displayStatus: 'Shipped', tooltip: tooltip, isPartial: false };\r\n                    } else if (maxShipStatus === 20) {\r\n                        return { displayStatus: 'Packed', tooltip: tooltip, isPartial: false };\r\n                    } else if (maxShipStatus === 10) {\r\n                        return { displayStatus: 'Picked', tooltip: tooltip, isPartial: false };\r\n                    }\r\n                } else {\r\n                    return { displayStatus: 'Picked', tooltip: tooltip, isPartial: false };\r\n                }\r\n            }\r\n\r\n            // Not all picks finished - find the incomplete pick with lowest status\r\n            var incompletePicks = picks.filter(function(p) {\r\n                return p.statusId < 40;\r\n            });\r\n\r\n            if (incompletePicks.length > 0) {\r\n                var minStatus = Math.min.apply(Math, incompletePicks.map(function(p) { return p.statusId; }));\r\n                var incompletePickStatus = incompletePicks.find(function(p) {\r\n                    return p.statusId === minStatus;\r\n                }).statusName;\r\n\r\n                var displayName = mapPickStatusToDisplay(incompletePickStatus);\r\n                var isPartial = picks.length > 1;\r\n                return {\r\n                    displayStatus: displayName + (isPartial ? ' *' : ''),\r\n                    tooltip: tooltip,\r\n                    isPartial: isPartial\r\n                };\r\n            }\r\n\r\n            // Fallback to SO status\r\n            return {\r\n                displayStatus: row.statusname || row.statusName,\r\n                tooltip: tooltip || row.statusname || row.statusName,\r\n                isPartial: false\r\n            };\r\n        }\r\n\r\n        // Load data\r\n        function loadData() {\r\n            debugLog('Starting data load...', 'info');\r\n            var loading = document.getElementById('loading');\r\n            loading.style.display = 'flex';\r\n\r\n            try {\r\n                // Get current user\r\n                var currentUser = JSON.parse(getUser());\r\n                var userId = currentUser.id;\r\n                debugLog('Current user ID: ' + userId, 'info');\r\n\r\n                var query =\r\n                    \"SELECT \" +\r\n                    \"    So.Id AS id, \" +\r\n                    \"    So.Num AS num, \" +\r\n                    \"    So.CustomerPO AS customerPO, \" +\r\n                    \"    So.DateIssued AS dateIssued, \" +\r\n                    \"    MAX(So.DateFirstShip) AS dateFirstShip, \" +\r\n                    \"    Customer.Name AS customerName, \" +\r\n                    \"    SoStatus.Name AS statusName, \" +\r\n                    \"    GROUP_CONCAT(DISTINCT CASE WHEN Pick.Num IS NOT NULL THEN CONCAT(Pick.Num, ':', COALESCE(PickStatus.Id, 0), ':', COALESCE(PickStatus.Name, 'None')) END ORDER BY Pick.Num SEPARATOR '|') AS pickInfo, \" +\r\n                    \"    GROUP_CONCAT(DISTINCT CASE WHEN Ship.Num IS NOT NULL THEN CONCAT(Ship.Num, ':', COALESCE(ShipStatus.Id, 0), ':', COALESCE(ShipStatus.Name, 'None')) END ORDER BY Ship.Num SEPARATOR '|') AS shipInfo \" +\r\n                    \"FROM So \" +\r\n                    \"LEFT JOIN Customer ON So.CustomerId = Customer.Id \" +\r\n                    \"LEFT JOIN SoStatus ON So.StatusId = SoStatus.Id \" +\r\n                    \"LEFT JOIN SoItem ON SoItem.SoId = So.Id \" +\r\n                    \"LEFT JOIN PickItem ON PickItem.SoItemId = SoItem.Id \" +\r\n                    \"LEFT JOIN Pick ON Pick.Id = PickItem.PickId \" +\r\n                    \"LEFT JOIN PickStatus ON Pick.StatusId = PickStatus.Id \" +\r\n                    \"LEFT JOIN Ship ON Ship.SoId = So.Id \" +\r\n                    \"LEFT JOIN ShipStatus ON Ship.StatusId = ShipStatus.Id \" +\r\n                    \"INNER JOIN UserToLG ON So.LocationGroupId = UserToLG.LocationGroupId AND UserToLG.UserId = \" + userId + \" \" +\r\n                    \"WHERE SoStatus.Name IN ('Estimate', 'In Progress', 'Issued') \" +\r\n                    \"GROUP BY So.Id \" +\r\n                    \"ORDER BY MAX(So.DateIssued) DESC\";\r\n\r\n                debugLog('Executing SQL query...', 'query');\r\n\r\n                var queryResult = runQuery(query);\r\n                debugLog('Query executed, parsing result...', 'info');\r\n\r\n                var result = JSON.parse(queryResult);\r\n                debugLog('Parsed ' + result.length + ' records', 'success');\r\n\r\n                allData = result;\r\n                applyFilters();\r\n\r\n                debugLog('Load complete: ' + filteredData.length + ' orders displayed', 'success');\r\n\r\n            } catch (error) {\r\n                debugLog('ERROR: ' + error.message, 'error');\r\n                alert('Error loading sales orders: ' + error.message);\r\n            } finally {\r\n                loading.style.display = 'none';\r\n            }\r\n        }\r\n\r\n        // Apply filters\r\n        function applyFilters() {\r\n            var hideEstimates = document.getElementById('hideEstimates').checked;\r\n\r\n            filteredData = allData.filter(function(row) {\r\n                // Compute display status for this row (needed for filtering)\r\n                var statusInfo = calculatePickShipStatus(row);\r\n                row.displayStatus = statusInfo.displayStatus;\r\n\r\n                // Hide estimates filter - check both raw status and display status\r\n                if (hideEstimates && (row.statusname === 'Estimate' || row.displayStatus === 'Estimate')) {\r\n                    return false;\r\n                }\r\n\r\n                // Column filters - use data-filter attributes\r\n                var filterInputs = document.querySelectorAll('.filter-row input[data-filter]');\r\n                for (var i = 0; i < filterInputs.length; i++) {\r\n                    var input = filterInputs[i];\r\n                    if (input.value) {\r\n                        var filterKey = input.getAttribute('data-filter');\r\n                        var cellValue;\r\n\r\n                        // For statusname column, filter on display status instead\r\n                        if (filterKey === 'statusname') {\r\n                            cellValue = (row.displayStatus || '').toString().toLowerCase();\r\n                        } else if (filterKey === 'dateissued' || filterKey === 'datefirstship') {\r\n                            // For date columns, filter on formatted date\r\n                            cellValue = formatDate(row[filterKey]).toLowerCase();\r\n                        } else {\r\n                            cellValue = (row[filterKey] || '').toString().toLowerCase();\r\n                        }\r\n\r\n                        var filterValue = input.value.toLowerCase();\r\n                        if (cellValue.indexOf(filterValue) === -1) {\r\n                            return false;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                return true;\r\n            });\r\n\r\n            updateFilterInfo();\r\n            sortAndRender();\r\n        }\r\n\r\n        // Update filter info\r\n        function updateFilterInfo() {\r\n            var filterInfo = document.getElementById('filterInfo');\r\n            if (allData.length !== filteredData.length) {\r\n                filterInfo.textContent = 'Showing ' + filteredData.length + ' of ' + allData.length + ' orders';\r\n                filterInfo.style.display = 'inline-block';\r\n            } else {\r\n                filterInfo.style.display = 'none';\r\n            }\r\n        }\r\n\r\n        // Clear filters\r\n        function clearFilters() {\r\n            document.getElementById('hideEstimates').checked = false;\r\n            var inputs = document.querySelectorAll('.filter-row input');\r\n            for (var i = 0; i < inputs.length; i++) {\r\n                inputs[i].value = '';\r\n            }\r\n            applyFilters();\r\n        }\r\n\r\n        // Sort table\r\n        function sortTable(column) {\r\n            if (sortColumn === column) {\r\n                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';\r\n            } else {\r\n                sortColumn = column;\r\n                sortDirection = 'asc';\r\n            }\r\n\r\n            sortAndRender();\r\n        }\r\n\r\n        // Sort and render\r\n        function sortAndRender() {\r\n            filteredData.sort(function(a, b) {\r\n                var aVal = a[sortColumn] || '';\r\n                var bVal = b[sortColumn] || '';\r\n\r\n                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;\r\n                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;\r\n                return 0;\r\n            });\r\n\r\n            renderTable();\r\n        }\r\n\r\n        // Create cell content for a given column\r\n        function createCellContent(row, column) {\r\n            var td = document.createElement('td');\r\n\r\n            if (column === 'statusname') {\r\n                // Calculate pick/ship progression status\r\n                var statusInfo = calculatePickShipStatus(row);\r\n                var displayStatus = statusInfo.displayStatus;\r\n                var tooltip = statusInfo.tooltip;\r\n\r\n                // Store display status on row for filtering\r\n                row.displayStatus = displayStatus;\r\n\r\n                var statusClass = 'status-badge';\r\n\r\n                // Apply CSS classes based on display status\r\n                var statusLower = displayStatus.toLowerCase().replace(' *', '');\r\n                if (statusLower === 'estimate') statusClass += ' status-estimate';\r\n                else if (statusLower === 'in progress') statusClass += ' status-inprogress';\r\n                else if (statusLower === 'issued') statusClass += ' status-issued';\r\n                else if (statusLower === 'entered' || statusLower === 'to pick') statusClass += ' status-entered';\r\n                else if (statusLower === 'started' || statusLower === 'picking') statusClass += ' status-started';\r\n                else if (statusLower === 'committed') statusClass += ' status-committed';\r\n                else if (statusLower === 'finished' || statusLower === 'picked') statusClass += ' status-picked';\r\n                else if (statusLower === 'packed') statusClass += ' status-packed';\r\n                else if (statusLower === 'shipped') statusClass += ' status-shipped';\r\n\r\n                var badge = document.createElement('span');\r\n                badge.className = statusClass;\r\n                badge.textContent = displayStatus || '';\r\n                td.appendChild(badge);\r\n                td.title = tooltip || displayStatus || '';\r\n            } else if (column === 'scheduleindicator') {\r\n                var scheduleStatus = getScheduleStatus(row.datefirstship);\r\n                if (scheduleStatus) {\r\n                    var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n                    svg.setAttribute('class', 'clock-icon');\r\n                    svg.setAttribute('viewBox', '0 0 24 24');\r\n                    svg.setAttribute('fill', 'currentColor');\r\n                    svg.style.width = '20px';\r\n                    svg.style.height = '20px';\r\n                    if (scheduleStatus === 'blue') svg.style.color = '#2d9cdb';\r\n                    else if (scheduleStatus === 'orange') svg.style.color = '#f59e0b';\r\n                    else if (scheduleStatus === 'red') svg.style.color = '#ef4444';\r\n\r\n                    var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n                    path.setAttribute('d', 'M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z');\r\n                    path.setAttribute('fill', 'none');\r\n                    path.setAttribute('stroke', 'currentColor');\r\n                    path.setAttribute('stroke-width', '1.8');\r\n                    path.setAttribute('stroke-linecap', 'round');\r\n                    path.setAttribute('stroke-linejoin', 'round');\r\n                    svg.appendChild(path);\r\n                    td.appendChild(svg);\r\n                    td.style.textAlign = 'center';\r\n\r\n                    // Add tooltip\r\n                    if (scheduleStatus === 'orange') {\r\n                        td.title = 'Scheduled for today';\r\n                    } else if (scheduleStatus === 'red') {\r\n                        td.title = 'Past due';\r\n                    } else if (scheduleStatus === 'blue') {\r\n                        td.title = 'Scheduled this week';\r\n                    }\r\n                }\r\n            } else if (column === 'num') {\r\n                var orderLink = document.createElement('a');\r\n                orderLink.href = '#';\r\n                orderLink.className = 'order-link';\r\n                orderLink.textContent = row.num;\r\n                orderLink.onclick = function(num) {\r\n                    return function(e) {\r\n                        e.preventDefault();\r\n                        openSO(num);\r\n                        return false;\r\n                    };\r\n                }(row.num);\r\n                td.appendChild(orderLink);\r\n                td.title = row.num;\r\n            } else if (column === 'customername') {\r\n                td.textContent = row.customername || '';\r\n                td.title = row.customername || '';\r\n            } else if (column === 'customerpo') {\r\n                td.textContent = row.customerpo || '';\r\n                td.title = row.customerpo || '';\r\n            } else if (column === 'dateissued') {\r\n                td.textContent = formatDate(row.dateissued);\r\n                td.title = formatDate(row.dateissued);\r\n            } else if (column === 'datefirstship') {\r\n                td.textContent = formatDate(row.datefirstship);\r\n                td.title = formatDate(row.datefirstship);\r\n            }\r\n\r\n            return td;\r\n        }\r\n\r\n        // Render table\r\n        function renderTable() {\r\n            var tbody = document.getElementById('tableBody');\r\n            tbody.innerHTML = '';\r\n\r\n            if (filteredData.length === 0) {\r\n                tbody.innerHTML = '<tr><td colspan=\"7\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">No sales orders found</td></tr>';\r\n                return;\r\n            }\r\n\r\n            for (var i = 0; i < filteredData.length; i++) {\r\n                var row = filteredData[i];\r\n                var tr = document.createElement('tr');\r\n\r\n                // Create cells in column order\r\n                for (var j = 0; j < columnOrder.length; j++) {\r\n                    var cell = createCellContent(row, columnOrder[j]);\r\n                    tr.appendChild(cell);\r\n                }\r\n\r\n                tbody.appendChild(tr);\r\n            }\r\n\r\n            debugLog('Rendered ' + filteredData.length + ' rows', 'success');\r\n        }\r\n\r\n        // Open SO\r\n        function openSO(soNum) {\r\n            openModule(\"Sales Order\", soNum);\r\n        }\r\n\r\n        // Drag and drop for column reordering\r\n        var draggedColumn = null;\r\n\r\n        function handleDragStart(e) {\r\n            draggedColumn = this;\r\n            e.dataTransfer.effectAllowed = 'move';\r\n            e.dataTransfer.setData('text/html', this.innerHTML);\r\n            this.style.opacity = '0.4';\r\n        }\r\n\r\n        function handleDragOver(e) {\r\n            if (e.preventDefault) {\r\n                e.preventDefault();\r\n            }\r\n            e.dataTransfer.dropEffect = 'move';\r\n            return false;\r\n        }\r\n\r\n        function handleDragEnter(e) {\r\n            this.classList.add('drag-over');\r\n        }\r\n\r\n        function handleDragLeave(e) {\r\n            this.classList.remove('drag-over');\r\n        }\r\n\r\n        function handleDrop(e) {\r\n            if (e.stopPropagation) {\r\n                e.stopPropagation();\r\n            }\r\n\r\n            if (draggedColumn !== this) {\r\n                var fromIndex = Array.from(this.parentNode.children).indexOf(draggedColumn);\r\n                var toIndex = Array.from(this.parentNode.children).indexOf(this);\r\n\r\n                // Reorder columnOrder array\r\n                var temp = columnOrder[fromIndex];\r\n                columnOrder.splice(fromIndex, 1);\r\n                columnOrder.splice(toIndex, 0, temp);\r\n\r\n                // Save to localStorage\r\n                try {\r\n                    localStorage.setItem('salesOrdersColumnOrder', JSON.stringify(columnOrder));\r\n                } catch (e) {\r\n                    // Ignore localStorage errors\r\n                }\r\n\r\n                // Reorder headers and filters\r\n                reorderColumns();\r\n                // Re-render table\r\n                renderTable();\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        function handleDragEnd(e) {\r\n            this.style.opacity = '1';\r\n            var headers = document.querySelectorAll('#headerRow th');\r\n            for (var i = 0; i < headers.length; i++) {\r\n                headers[i].classList.remove('drag-over');\r\n            }\r\n        }\r\n\r\n        function setupDragAndDrop() {\r\n            var headers = document.querySelectorAll('#headerRow th[draggable=\"true\"]');\r\n            for (var i = 0; i < headers.length; i++) {\r\n                headers[i].addEventListener('dragstart', handleDragStart, false);\r\n                headers[i].addEventListener('dragenter', handleDragEnter, false);\r\n                headers[i].addEventListener('dragover', handleDragOver, false);\r\n                headers[i].addEventListener('dragleave', handleDragLeave, false);\r\n                headers[i].addEventListener('drop', handleDrop, false);\r\n                headers[i].addEventListener('dragend', handleDragEnd, false);\r\n            }\r\n        }\r\n\r\n        function reorderColumns() {\r\n            var headerRow = document.getElementById('headerRow');\r\n            var filterRow = document.getElementById('filterRow');\r\n\r\n            // Reorder header cells\r\n            for (var i = 0; i < columnOrder.length; i++) {\r\n                var col = columnOrder[i];\r\n                var th = headerRow.querySelector('[data-column=\"' + col + '\"]');\r\n                headerRow.appendChild(th);\r\n            }\r\n\r\n            // Reorder filter cells\r\n            for (var i = 0; i < columnOrder.length; i++) {\r\n                var col = columnOrder[i];\r\n                var element = filterRow.querySelector('[data-filter=\"' + col + '\"]');\r\n                var td = element.tagName === 'TD' ? element : element.parentNode;\r\n                filterRow.appendChild(td);\r\n            }\r\n        }\r\n\r\n        // Initialize\r\n        window.onload = function() {\r\n            // Set filter state from Fishbowl property\r\n            document.getElementById('hideEstimates').checked = HIDE_ESTIMATES;\r\n\r\n            // Apply saved column order\r\n            reorderColumns();\r\n\r\n            // Setup drag and drop for column reordering\r\n            setupDragAndDrop();\r\n\r\n            if (DEBUG_MODE) {\r\n                document.getElementById('debugConsole').style.display = 'block';\r\n                debugLog('Debug mode enabled', 'info');\r\n                debugLog('BI_SHOW_DEBUG property: ' + BI_SHOW_DEBUG_PROP, 'info');\r\n                debugLog('Date format: ' + FB_DATE_FORMAT, 'info');\r\n                debugLog('BI_SO_SHOW_ESTIMATE property: ' + BI_SO_SHOW_ESTIMATE_PROP, 'info');\r\n                debugLog('Hide estimates: ' + HIDE_ESTIMATES, 'info');\r\n            }\r\n\r\n            loadData();\r\n        };\r\n    </script>\r\n</body>\r\n</html>\r\n",
  "active" : true,
  "note" : "",
  "type" : "Page"
} ]