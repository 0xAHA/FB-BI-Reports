[ {
  "name" : "- Open RMA Orders",
  "description" : "- Open RMA Orders",
  "data" : "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Open RMA Orders</title>\r\n\r\n    <!-- Google Fonts - Inter -->\r\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap\" rel=\"stylesheet\">\r\n\r\n    <style>\r\n        * {\r\n            margin: 0;\r\n            padding: 0;\r\n            box-sizing: border-box;\r\n        }\r\n\r\n        body {\r\n            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\r\n            font-size: 12px;\r\n            padding: 8px;\r\n            background: #f5f5f5;\r\n        }\r\n\r\n        .header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            margin-bottom: 8px;\r\n            padding: 8px;\r\n            background: white;\r\n            border: 1px solid #ddd;\r\n            border-radius: 4px;\r\n        }\r\n\r\n        .header h1 {\r\n            font-size: 16px;\r\n            font-weight: 600;\r\n            color: #333;\r\n        }\r\n\r\n        .controls {\r\n            display: flex;\r\n            gap: 8px;\r\n            align-items: center;\r\n        }\r\n\r\n        .btn {\r\n            padding: 6px 12px;\r\n            font-size: 12px;\r\n            border: 1px solid #ccc;\r\n            background: white;\r\n            border-radius: 3px;\r\n            cursor: pointer;\r\n            font-weight: 500;\r\n        }\r\n\r\n        .btn:hover {\r\n            background: #f0f0f0;\r\n        }\r\n\r\n        .btn-primary {\r\n            background: #2d9cdb;\r\n            color: white;\r\n            border-color: #2d9cdb;\r\n        }\r\n\r\n        .btn-primary:hover {\r\n            background: #1e7bb4;\r\n        }\r\n\r\n        .table-container {\r\n            background: white;\r\n            border: 1px solid #ddd;\r\n            border-radius: 4px;\r\n            overflow: auto;\r\n            height: calc(100vh - 80px);\r\n        }\r\n\r\n        table {\r\n            width: 100%;\r\n            border-collapse: collapse;\r\n            font-size: 12px;\r\n        }\r\n\r\n        th {\r\n            background: #f8f9fa;\r\n            padding: 12px 8px;\r\n            text-align: left;\r\n            font-size: 12px;\r\n            font-weight: 600;\r\n            color: #475569;\r\n            text-transform: uppercase;\r\n            letter-spacing: 0.5px;\r\n            border-bottom: 2px solid #e2e8f0;\r\n            position: sticky;\r\n            top: 0;\r\n            z-index: 10;\r\n            white-space: nowrap;\r\n            cursor: pointer;\r\n            user-select: none;\r\n        }\r\n\r\n        th:hover {\r\n            background: #e9ecef;\r\n        }\r\n\r\n        th[draggable=\"true\"] {\r\n            cursor: move;\r\n        }\r\n\r\n        th.drag-over {\r\n            background: #cbd5e1;\r\n            border-left: 3px solid #2d9cdb;\r\n        }\r\n\r\n        th .sort-icon {\r\n            margin-left: 4px;\r\n            font-size: 10px;\r\n            color: #94a3b8;\r\n        }\r\n\r\n        td {\r\n            padding: 8px;\r\n            border-bottom: 1px solid #e9ecef;\r\n            color: #334155;\r\n            font-size: 12px;\r\n            max-width: 250px;\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            white-space: nowrap;\r\n        }\r\n\r\n        tr:hover {\r\n            background-color: #f8fafc;\r\n        }\r\n\r\n        tr:nth-child(even) {\r\n            background-color: #fafafa;\r\n        }\r\n\r\n        tr:nth-child(even):hover {\r\n            background-color: #f8fafc;\r\n        }\r\n\r\n        .filter-row input {\r\n            width: 100%;\r\n            padding: 4px;\r\n            font-size: 11px;\r\n            border: 1px solid #cbd5e1;\r\n            border-radius: 3px;\r\n        }\r\n\r\n        .filter-row input:focus {\r\n            outline: none;\r\n            border-color: #2d9cdb;\r\n        }\r\n\r\n        .rma-link {\r\n            color: #2d9cdb;\r\n            text-decoration: none;\r\n            font-weight: 600;\r\n        }\r\n\r\n        .rma-link:hover {\r\n            text-decoration: underline;\r\n            color: #1e7bb4;\r\n        }\r\n\r\n        .status-badge {\r\n            display: inline-block;\r\n            padding: 2px 8px;\r\n            border-radius: 3px;\r\n            font-size: 11px;\r\n            font-weight: 600;\r\n        }\r\n\r\n        .status-open {\r\n            background: #fff3cd;\r\n            color: #856404;\r\n        }\r\n\r\n        .status-fulfilled {\r\n            background: #d4edda;\r\n            color: #155724;\r\n        }\r\n\r\n        .status-expired {\r\n            background: #e2e8f0;\r\n            color: #475569;\r\n        }\r\n\r\n        th.schedule-col {\r\n            width: 40px;\r\n            text-align: center;\r\n            padding-left: 4px;\r\n            padding-right: 4px;\r\n        }\r\n\r\n        .clock-icon {\r\n            width: 16px;\r\n            height: 16px;\r\n            display: inline-block;\r\n            vertical-align: middle;\r\n        }\r\n\r\n        .loading {\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            background: rgba(0, 0, 0, 0.5);\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            z-index: 9999;\r\n        }\r\n\r\n        .loading-content {\r\n            background: white;\r\n            padding: 20px 30px;\r\n            border-radius: 8px;\r\n            text-align: center;\r\n        }\r\n\r\n        .spinner {\r\n            border: 3px solid #f3f3f3;\r\n            border-top: 3px solid #2d9cdb;\r\n            border-radius: 50%;\r\n            width: 40px;\r\n            height: 40px;\r\n            animation: spin 1s linear infinite;\r\n            margin: 0 auto 10px;\r\n        }\r\n\r\n        @keyframes spin {\r\n            0% { transform: rotate(0deg); }\r\n            100% { transform: rotate(360deg); }\r\n        }\r\n\r\n        .filter-info {\r\n            font-size: 12px;\r\n            color: #666;\r\n            padding: 4px 8px;\r\n            background: #fff3cd;\r\n            border-radius: 3px;\r\n        }\r\n\r\n        /* Debug Console */\r\n        #debugConsole {\r\n            margin-top: 12px;\r\n            background: #1e293b;\r\n            border: 1px solid #334155;\r\n            border-radius: 4px;\r\n            padding: 12px;\r\n        }\r\n\r\n        #debugLog {\r\n            background: #0f172a;\r\n            border-radius: 4px;\r\n            padding: 8px;\r\n            height: 200px;\r\n            overflow-y: auto;\r\n            font-family: 'Courier New', monospace;\r\n            font-size: 11px;\r\n            color: #e2e8f0;\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"header\">\r\n        <div>\r\n            <h1>Open RMA Orders</h1>\r\n        </div>\r\n        <div class=\"controls\">\r\n            <span id=\"filterInfo\" class=\"filter-info\" style=\"display: none;\"></span>\r\n            <button class=\"btn\" onclick=\"clearFilters()\">Clear Filters</button>\r\n            <button class=\"btn btn-primary\" onclick=\"loadData()\">Refresh</button>\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"table-container\">\r\n        <table id=\"dataTable\">\r\n            <thead>\r\n                <tr id=\"headerRow\">\r\n                    <th draggable=\"true\" data-column=\"scheduleindicator\" class=\"schedule-col\" onclick=\"sortTable('dateexpires')\" title=\"Schedule Status\">\r\n                        <svg class=\"clock-icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                            <path d=\"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z\"/>\r\n                        </svg>\r\n                    </th>\r\n                    <th draggable=\"true\" data-column=\"statusname\" onclick=\"sortTable('statusname')\">Status <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"issue\" onclick=\"sortTable('issue')\">Issue <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"type\" onclick=\"sortTable('type')\">Type <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"num\" onclick=\"sortTable('num')\">RMA Number <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"product\" onclick=\"sortTable('product')\">Product <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"qty\" onclick=\"sortTable('qty')\">Qty <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"customername\" onclick=\"sortTable('customername')\">Customer Name <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"datecreated\" onclick=\"sortTable('datecreated')\">Date Created <span class=\"sort-icon\">⇅</span></th>\r\n                    <th draggable=\"true\" data-column=\"dateexpires\" onclick=\"sortTable('dateexpires')\">Date Expires <span class=\"sort-icon\">⇅</span></th>\r\n                </tr>\r\n                <tr class=\"filter-row\" id=\"filterRow\">\r\n                    <td data-filter=\"scheduleindicator\"></td>\r\n                    <td><input type=\"text\" data-filter=\"statusname\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td><input type=\"text\" data-filter=\"issue\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td><input type=\"text\" data-filter=\"type\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td><input type=\"text\" data-filter=\"num\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td><input type=\"text\" data-filter=\"product\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td><input type=\"text\" data-filter=\"qty\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td><input type=\"text\" data-filter=\"customername\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td><input type=\"text\" data-filter=\"datecreated\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                    <td><input type=\"text\" data-filter=\"dateexpires\" placeholder=\"Filter...\" onkeyup=\"applyFilters()\"></td>\r\n                </tr>\r\n            </thead>\r\n            <tbody id=\"tableBody\">\r\n                <tr>\r\n                    <td colspan=\"10\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">Loading...</td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n\r\n    <!-- Debug Console -->\r\n    <div id=\"debugConsole\" style=\"display: none;\">\r\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\r\n            <h3 style=\"font-size: 12px; font-weight: 600; color: #94a3b8; margin: 0;\">Debug Console</h3>\r\n            <button onclick=\"clearDebugLog()\" class=\"btn\" style=\"padding: 4px 8px; font-size: 11px;\">Clear</button>\r\n        </div>\r\n        <div id=\"debugLog\">\r\n            <div style=\"color: #64748b; font-style: italic;\">Initializing...</div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id=\"loading\" class=\"loading\" style=\"display: none;\">\r\n        <div class=\"loading-content\">\r\n            <div class=\"spinner\"></div>\r\n            <p style=\"font-weight: 600; color: #333;\">Loading RMA orders...</p>\r\n        </div>\r\n    </div>\r\n\r\n    <script>\r\n        // Get date format from Fishbowl settings\r\n        const FB_DATE_FORMAT = getProperty('DateFormatShort', 'dd/MM/yyyy');\r\n\r\n        // Get BI_SHOW_DEBUG property (default to false if property can't be read)\r\n        const BI_SHOW_DEBUG_PROP = getProperty('BI_SHOW_DEBUG', 'false');\r\n        const DEBUG_MODE = BI_SHOW_DEBUG_PROP === 'true' || BI_SHOW_DEBUG_PROP === true;\r\n\r\n        let allData = [];\r\n        let filteredData = [];\r\n        let sortColumn = 'dateexpires';\r\n        let sortDirection = 'asc';\r\n        let columnOrder = ['scheduleindicator', 'statusname', 'issue', 'type', 'num', 'product', 'qty', 'customername', 'datecreated', 'dateexpires'];\r\n\r\n        // Load saved column order\r\n        try {\r\n            var savedOrder = localStorage.getItem('rmaOrdersColumnOrder');\r\n            if (savedOrder) {\r\n                columnOrder = JSON.parse(savedOrder);\r\n            }\r\n        } catch (e) {\r\n            // Ignore localStorage errors\r\n        }\r\n\r\n        // Debug logging\r\n        function debugLog(message, type) {\r\n            if (!DEBUG_MODE) return;\r\n\r\n            var timestamp = new Date().toLocaleTimeString();\r\n            var logDiv = document.getElementById('debugLog');\r\n\r\n            var placeholder = logDiv.querySelector('[style*=\"italic\"]');\r\n            if (placeholder) {\r\n                logDiv.innerHTML = '';\r\n            }\r\n\r\n            var colors = {\r\n                'info': '#60a5fa',\r\n                'success': '#34d399',\r\n                'warning': '#fbbf24',\r\n                'error': '#f87171',\r\n                'query': '#a78bfa'\r\n            };\r\n\r\n            var entry = document.createElement('div');\r\n            entry.style.marginBottom = '4px';\r\n            entry.innerHTML = '<span style=\"color: #64748b;\">[' + timestamp + ']</span> <span style=\"color: ' + colors[type] + ';\">' + message + '</span>';\r\n\r\n            logDiv.appendChild(entry);\r\n            logDiv.scrollTop = logDiv.scrollHeight;\r\n        }\r\n\r\n        function clearDebugLog() {\r\n            document.getElementById('debugLog').innerHTML = '<div style=\"color: #64748b; font-style: italic;\">Log cleared...</div>';\r\n        }\r\n\r\n        // Format date\r\n        function formatDate(dateStr) {\r\n            if (!dateStr) return '';\r\n\r\n            // Parse date from SQL format (YYYY-MM-DD HH:mm:ss)\r\n            var parts = dateStr.split(' ')[0].split('-');\r\n            var year = parts[0];\r\n            var month = parts[1];\r\n            var day = parts[2];\r\n\r\n            // Convert to Fishbowl format\r\n            // dd/MM/yyyy -> day/month/year\r\n            return day + '/' + month + '/' + year;\r\n        }\r\n\r\n        // Get schedule status for indicator\r\n        function getScheduleStatus(dateStr) {\r\n            if (!dateStr) return '';\r\n\r\n            // Parse date from SQL format (YYYY-MM-DD HH:mm:ss)\r\n            var dateParts = dateStr.split(' ')[0].split('-');\r\n            var schedDate = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);\r\n            schedDate.setHours(0, 0, 0, 0);\r\n\r\n            var today = new Date();\r\n            today.setHours(0, 0, 0, 0);\r\n\r\n            // Check if today\r\n            if (schedDate.getTime() === today.getTime()) {\r\n                return 'orange';\r\n            }\r\n\r\n            // Check if past\r\n            if (schedDate < today) {\r\n                return 'red';\r\n            }\r\n\r\n            // Check if within this calendar week (Sunday to Saturday)\r\n            var todayDay = today.getDay(); // 0 = Sunday, 6 = Saturday\r\n            var weekStart = new Date(today);\r\n            weekStart.setDate(today.getDate() - todayDay);\r\n            var weekEnd = new Date(weekStart);\r\n            weekEnd.setDate(weekStart.getDate() + 6);\r\n\r\n            if (schedDate >= weekStart && schedDate <= weekEnd) {\r\n                return 'blue';\r\n            }\r\n\r\n            return '';\r\n        }\r\n\r\n        // Load data\r\n        function loadData() {\r\n            debugLog('Starting data load...', 'info');\r\n            var loading = document.getElementById('loading');\r\n            loading.style.display = 'flex';\r\n\r\n            try {\r\n                // Get current user\r\n                var currentUser = JSON.parse(getUser());\r\n                var userId = currentUser.id;\r\n                debugLog('Current user ID: ' + userId, 'info');\r\n\r\n                var query =\r\n                    \"SELECT \" +\r\n                    \"    Rma.id AS rmaId, \" +\r\n                    \"    Rma.num AS num, \" +\r\n                    \"    Rma.dateCreated AS dateCreated, \" +\r\n                    \"    Rma.dateExpires AS dateExpires, \" +\r\n                    \"    RmaStatus.Name AS statusName, \" +\r\n                    \"    Customer.Name AS customerName, \" +\r\n                    \"    RmaItem.id AS rmaItemId, \" +\r\n                    \"    RmaItem.typeId AS typeId, \" +\r\n                    \"    RmaItem.issueId AS issueId, \" +\r\n                    \"    RmaItemType.Name AS typeName, \" +\r\n                    \"    RmaItem.productId AS productId, \" +\r\n                    \"    Product.num AS productNum, \" +\r\n                    \"    RmaItem.qty AS qty \" +\r\n                    \"FROM Rma \" +\r\n                    \"LEFT JOIN RmaStatus ON Rma.statusId = RmaStatus.Id \" +\r\n                    \"LEFT JOIN Customer ON Rma.customerId = Customer.id \" +\r\n                    \"LEFT JOIN RmaItem ON Rma.id = RmaItem.rmaId \" +\r\n                    \"LEFT JOIN RmaItemType ON RmaItem.typeId = RmaItemType.Id \" +\r\n                    \"LEFT JOIN Product ON RmaItem.productId = Product.id \" +\r\n                    \"INNER JOIN UserToLG ON Rma.locationGroupId = UserToLG.LocationGroupId AND UserToLG.UserId = \" + userId + \" \" +\r\n                    \"WHERE Rma.statusId = 10 \" +\r\n                    \"ORDER BY Rma.dateExpires ASC\";\r\n\r\n                debugLog('Executing SQL query...', 'query');\r\n\r\n                var queryResult = runQuery(query);\r\n                debugLog('Query executed, result type: ' + typeof queryResult, 'info');\r\n\r\n                if (!queryResult) {\r\n                    debugLog('ERROR: Query returned null/undefined', 'error');\r\n                    throw new Error('Query returned no data');\r\n                }\r\n\r\n                debugLog('Query result length: ' + queryResult.length, 'info');\r\n                debugLog('Parsing result...', 'info');\r\n\r\n                var result = JSON.parse(queryResult);\r\n                debugLog('Parsed ' + result.length + ' records', 'success');\r\n\r\n                // Group by RMA ID + Type ID + Issue ID\r\n                var grouped = {};\r\n                for (var i = 0; i < result.length; i++) {\r\n                    var row = result[i];\r\n                    var key = row.rmaid + '_' + row.typeid + '_' + row.issueid;\r\n\r\n                    // Map issueId to issue name\r\n                    var issueName = '';\r\n                    if (row.issueid === null || row.issueid === undefined) issueName = '-';\r\n                    else if (row.issueid === 2) issueName = 'DOA';\r\n                    else if (row.issueid === 3) issueName = 'Warranty';\r\n\r\n                    if (!grouped[key]) {\r\n                        grouped[key] = {\r\n                            rmaid: row.rmaid,\r\n                            num: row.num,\r\n                            datecreated: row.datecreated,\r\n                            dateexpires: row.dateexpires,\r\n                            statusname: row.statusname,\r\n                            customername: row.customername,\r\n                            typeid: row.typeid,\r\n                            typename: row.typename,\r\n                            type: row.typename || '',\r\n                            issueid: row.issueid,\r\n                            issue: issueName,\r\n                            products: [],\r\n                            totalQty: 0\r\n                        };\r\n                    }\r\n\r\n                    grouped[key].products.push({\r\n                        productid: row.productid,\r\n                        productnum: row.productnum,\r\n                        qty: parseFloat(row.qty) || 0\r\n                    });\r\n                    grouped[key].totalQty += parseFloat(row.qty) || 0;\r\n                }\r\n\r\n                // Convert grouped object to array and determine product display\r\n                var processedData = [];\r\n                for (var key in grouped) {\r\n                    var group = grouped[key];\r\n\r\n                    if (group.products.length === 1) {\r\n                        // Single product - show product number\r\n                        group.product = group.products[0].productnum || '';\r\n                        group.qty = group.products[0].qty;\r\n                    } else if (group.products.length > 1) {\r\n                        // Multiple products of same type - show \"Multiple\"\r\n                        group.product = 'Multiple';\r\n                        group.qty = group.totalQty;\r\n                    } else {\r\n                        // No products\r\n                        group.product = '';\r\n                        group.qty = 0;\r\n                    }\r\n\r\n                    processedData.push(group);\r\n                }\r\n\r\n                debugLog('Processed into ' + processedData.length + ' grouped records', 'success');\r\n\r\n                allData = processedData;\r\n                applyFilters();\r\n\r\n                debugLog('Load complete: ' + filteredData.length + ' RMA orders displayed', 'success');\r\n\r\n            } catch (error) {\r\n                debugLog('ERROR: ' + error.message, 'error');\r\n                alert('Error loading RMA orders: ' + error.message);\r\n            } finally {\r\n                loading.style.display = 'none';\r\n            }\r\n        }\r\n\r\n        // Apply filters\r\n        function applyFilters() {\r\n            filteredData = allData.filter(function(row) {\r\n                // Column filters - use data-filter attributes\r\n                var filterInputs = document.querySelectorAll('.filter-row input[data-filter]');\r\n                for (var i = 0; i < filterInputs.length; i++) {\r\n                    var input = filterInputs[i];\r\n                    if (input.value) {\r\n                        var filterKey = input.getAttribute('data-filter');\r\n                        var cellValue = (row[filterKey] || '').toString().toLowerCase();\r\n                        var filterValue = input.value.toLowerCase();\r\n                        if (cellValue.indexOf(filterValue) === -1) {\r\n                            return false;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                return true;\r\n            });\r\n\r\n            updateFilterInfo();\r\n            sortAndRender();\r\n        }\r\n\r\n        // Update filter info\r\n        function updateFilterInfo() {\r\n            var filterInfo = document.getElementById('filterInfo');\r\n            if (allData.length !== filteredData.length) {\r\n                filterInfo.textContent = 'Showing ' + filteredData.length + ' of ' + allData.length + ' RMA orders';\r\n                filterInfo.style.display = 'inline-block';\r\n            } else {\r\n                filterInfo.style.display = 'none';\r\n            }\r\n        }\r\n\r\n        // Clear filters\r\n        function clearFilters() {\r\n            var inputs = document.querySelectorAll('.filter-row input');\r\n            for (var i = 0; i < inputs.length; i++) {\r\n                inputs[i].value = '';\r\n            }\r\n            applyFilters();\r\n        }\r\n\r\n        // Sort table\r\n        function sortTable(column) {\r\n            if (sortColumn === column) {\r\n                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';\r\n            } else {\r\n                sortColumn = column;\r\n                sortDirection = 'asc';\r\n            }\r\n\r\n            sortAndRender();\r\n        }\r\n\r\n        // Sort and render\r\n        function sortAndRender() {\r\n            filteredData.sort(function(a, b) {\r\n                var aVal = a[sortColumn] || '';\r\n                var bVal = b[sortColumn] || '';\r\n\r\n                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;\r\n                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;\r\n                return 0;\r\n            });\r\n\r\n            renderTable();\r\n        }\r\n\r\n        // Create cell content for a given column\r\n        function createCellContent(row, column) {\r\n            var td = document.createElement('td');\r\n\r\n            if (column === 'scheduleindicator') {\r\n                var scheduleStatus = getScheduleStatus(row.dateexpires);\r\n                if (scheduleStatus) {\r\n                    var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n                    svg.setAttribute('class', 'clock-icon');\r\n                    svg.setAttribute('viewBox', '0 0 24 24');\r\n                    svg.setAttribute('fill', 'currentColor');\r\n                    svg.style.width = '20px';\r\n                    svg.style.height = '20px';\r\n                    if (scheduleStatus === 'blue') svg.style.color = '#2d9cdb';\r\n                    else if (scheduleStatus === 'orange') svg.style.color = '#f59e0b';\r\n                    else if (scheduleStatus === 'red') svg.style.color = '#ef4444';\r\n\r\n                    var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n                    path.setAttribute('d', 'M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 10.414V7a1 1 0 10-2 0v6a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L13 12.414z');\r\n                    path.setAttribute('fill', 'none');\r\n                    path.setAttribute('stroke', 'currentColor');\r\n                    path.setAttribute('stroke-width', '1.8');\r\n                    path.setAttribute('stroke-linecap', 'round');\r\n                    path.setAttribute('stroke-linejoin', 'round');\r\n                    svg.appendChild(path);\r\n                    td.appendChild(svg);\r\n                    td.style.textAlign = 'center';\r\n\r\n                    // Add tooltip\r\n                    if (scheduleStatus === 'orange') {\r\n                        td.title = 'Expires today';\r\n                    } else if (scheduleStatus === 'red') {\r\n                        td.title = 'Expired';\r\n                    } else if (scheduleStatus === 'blue') {\r\n                        td.title = 'Expires this week';\r\n                    }\r\n                }\r\n            } else if (column === 'statusname') {\r\n                var statusClass = 'status-badge';\r\n                if (row.statusname === 'Open') statusClass += ' status-open';\r\n                else if (row.statusname === 'Fulfilled') statusClass += ' status-fulfilled';\r\n                else if (row.statusname === 'Expired') statusClass += ' status-expired';\r\n                var badge = document.createElement('span');\r\n                badge.className = statusClass;\r\n                badge.textContent = row.statusname || '';\r\n                td.appendChild(badge);\r\n                td.title = row.statusname || '';\r\n            } else if (column === 'issue') {\r\n                td.textContent = row.issue || '';\r\n                td.title = row.issue || '';\r\n            } else if (column === 'type') {\r\n                td.textContent = row.type || '';\r\n                td.title = row.type || '';\r\n            } else if (column === 'num') {\r\n                var rmaLink = document.createElement('a');\r\n                rmaLink.href = '#';\r\n                rmaLink.className = 'rma-link';\r\n                rmaLink.textContent = row.num;\r\n                rmaLink.onclick = function(num) {\r\n                    return function(e) {\r\n                        e.preventDefault();\r\n                        openRMA(num);\r\n                        return false;\r\n                    };\r\n                }(row.num);\r\n                td.appendChild(rmaLink);\r\n                td.title = row.num;\r\n            } else if (column === 'product') {\r\n                td.textContent = row.product || '';\r\n                td.title = row.product || '';\r\n            } else if (column === 'qty') {\r\n                td.textContent = row.qty || '';\r\n                td.title = row.qty || '';\r\n            } else if (column === 'customername') {\r\n                td.textContent = row.customername || '';\r\n                td.title = row.customername || '';\r\n            } else if (column === 'datecreated') {\r\n                td.textContent = formatDate(row.datecreated);\r\n                td.title = formatDate(row.datecreated);\r\n            } else if (column === 'dateexpires') {\r\n                td.textContent = formatDate(row.dateexpires);\r\n                td.title = formatDate(row.dateexpires);\r\n            }\r\n\r\n            return td;\r\n        }\r\n\r\n        // Render table\r\n        function renderTable() {\r\n            var tbody = document.getElementById('tableBody');\r\n            tbody.innerHTML = '';\r\n\r\n            if (filteredData.length === 0) {\r\n                tbody.innerHTML = '<tr><td colspan=\"10\" style=\"text-align: center; padding: 20px; color: #94a3b8;\">No RMA orders found</td></tr>';\r\n                return;\r\n            }\r\n\r\n            for (var i = 0; i < filteredData.length; i++) {\r\n                var row = filteredData[i];\r\n                var tr = document.createElement('tr');\r\n\r\n                // Create cells in column order\r\n                for (var j = 0; j < columnOrder.length; j++) {\r\n                    var cell = createCellContent(row, columnOrder[j]);\r\n                    tr.appendChild(cell);\r\n                }\r\n\r\n                tbody.appendChild(tr);\r\n            }\r\n\r\n            debugLog('Rendered ' + filteredData.length + ' rows', 'success');\r\n        }\r\n\r\n        // Open RMA\r\n        function openRMA(rmaNum) {\r\n            openModule(\"RMA\", rmaNum);\r\n        }\r\n\r\n        // Drag and drop for column reordering\r\n        var draggedColumn = null;\r\n\r\n        function handleDragStart(e) {\r\n            draggedColumn = this;\r\n            e.dataTransfer.effectAllowed = 'move';\r\n            e.dataTransfer.setData('text/html', this.innerHTML);\r\n            this.style.opacity = '0.4';\r\n        }\r\n\r\n        function handleDragOver(e) {\r\n            if (e.preventDefault) {\r\n                e.preventDefault();\r\n            }\r\n            e.dataTransfer.dropEffect = 'move';\r\n            return false;\r\n        }\r\n\r\n        function handleDragEnter(e) {\r\n            this.classList.add('drag-over');\r\n        }\r\n\r\n        function handleDragLeave(e) {\r\n            this.classList.remove('drag-over');\r\n        }\r\n\r\n        function handleDrop(e) {\r\n            if (e.stopPropagation) {\r\n                e.stopPropagation();\r\n            }\r\n\r\n            if (draggedColumn !== this) {\r\n                var fromIndex = Array.from(this.parentNode.children).indexOf(draggedColumn);\r\n                var toIndex = Array.from(this.parentNode.children).indexOf(this);\r\n\r\n                // Reorder columnOrder array\r\n                var temp = columnOrder[fromIndex];\r\n                columnOrder.splice(fromIndex, 1);\r\n                columnOrder.splice(toIndex, 0, temp);\r\n\r\n                // Save to localStorage\r\n                try {\r\n                    localStorage.setItem('rmaOrdersColumnOrder', JSON.stringify(columnOrder));\r\n                } catch (e) {\r\n                    // Ignore localStorage errors\r\n                }\r\n\r\n                // Reorder headers and filters\r\n                reorderColumns();\r\n                // Re-render table\r\n                renderTable();\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        function handleDragEnd(e) {\r\n            this.style.opacity = '1';\r\n            var headers = document.querySelectorAll('#headerRow th');\r\n            for (var i = 0; i < headers.length; i++) {\r\n                headers[i].classList.remove('drag-over');\r\n            }\r\n        }\r\n\r\n        function setupDragAndDrop() {\r\n            var headers = document.querySelectorAll('#headerRow th[draggable=\"true\"]');\r\n            for (var i = 0; i < headers.length; i++) {\r\n                headers[i].addEventListener('dragstart', handleDragStart, false);\r\n                headers[i].addEventListener('dragenter', handleDragEnter, false);\r\n                headers[i].addEventListener('dragover', handleDragOver, false);\r\n                headers[i].addEventListener('dragleave', handleDragLeave, false);\r\n                headers[i].addEventListener('drop', handleDrop, false);\r\n                headers[i].addEventListener('dragend', handleDragEnd, false);\r\n            }\r\n        }\r\n\r\n        function reorderColumns() {\r\n            var headerRow = document.getElementById('headerRow');\r\n            var filterRow = document.getElementById('filterRow');\r\n\r\n            // Reorder header cells\r\n            for (var i = 0; i < columnOrder.length; i++) {\r\n                var col = columnOrder[i];\r\n                var th = headerRow.querySelector('[data-column=\"' + col + '\"]');\r\n                headerRow.appendChild(th);\r\n            }\r\n\r\n            // Reorder filter cells\r\n            for (var i = 0; i < columnOrder.length; i++) {\r\n                var col = columnOrder[i];\r\n                var element = filterRow.querySelector('[data-filter=\"' + col + '\"]');\r\n                var td = element.tagName === 'TD' ? element : element.parentNode;\r\n                filterRow.appendChild(td);\r\n            }\r\n        }\r\n\r\n        // Initialize\r\n        window.onload = function() {\r\n            // Apply saved column order\r\n            reorderColumns();\r\n\r\n            // Setup drag and drop for column reordering\r\n            setupDragAndDrop();\r\n\r\n            if (DEBUG_MODE) {\r\n                document.getElementById('debugConsole').style.display = 'block';\r\n                debugLog('Debug mode enabled', 'info');\r\n                debugLog('BI_SHOW_DEBUG property: ' + BI_SHOW_DEBUG_PROP, 'info');\r\n                debugLog('Date format: ' + FB_DATE_FORMAT, 'info');\r\n            }\r\n\r\n            loadData();\r\n        };\r\n    </script>\r\n</body>\r\n</html>\r\n",
  "active" : true,
  "note" : "",
  "type" : "Page"
} ]