[ {
  "name" : "4. Default Locations Updater",
  "description" : "Finds all parts without default locations, and updates them to have a Default Location for each LG, set to that LG's default \"Stock\"-type location.",
  "data" : "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    {% Template Inventory_Watch_List %}\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Default Parts Location Manager</title>\r\n\r\n    <!-- Bootstrap 5.3 CSS -->\r\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css\" rel=\"stylesheet\">\r\n\r\n    <!-- Fishbowl Modern Theme (overrides Bootstrap) -->\r\n    <style>\r\n        {% Style fishbowl-theme-modern %}\r\n    </style>\r\n\r\n    <style>\r\n        /* Page-specific overrides */\r\n\r\n        .page-header {\r\n            background: linear-gradient(135deg, var(--fb-primary) 0%, var(--fb-primary-light) 100%);\r\n            color: white;\r\n            padding: 2rem 0;\r\n            margin-bottom: 2rem;\r\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n        }\r\n\r\n        .stats-card {\r\n            background: white;\r\n            border-radius: 8px;\r\n            padding: 1.5rem;\r\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\r\n            margin-bottom: 1.5rem;\r\n        }\r\n\r\n        .stats-number {\r\n            font-size: 2rem;\r\n            font-weight: 600;\r\n            color: var(--fb-primary);\r\n        }\r\n\r\n        .location-select {\r\n            width: 100%;\r\n            padding: 0.375rem 0.75rem;\r\n            font-size: 0.875rem;\r\n            border: 1px solid #ced4da;\r\n            border-radius: 0.25rem;\r\n        }\r\n\r\n        .location-select:focus {\r\n            border-color: var(--fb-primary);\r\n            outline: 0;\r\n            box-shadow: 0 0 0 0.2rem rgba(21, 101, 192, 0.25);\r\n        }\r\n\r\n        .custom-table {\r\n            background: white;\r\n            border-radius: 8px;\r\n            overflow: hidden;\r\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\r\n        }\r\n\r\n        .custom-table thead {\r\n            background-color: var(--fb-primary);\r\n            color: white;\r\n        }\r\n\r\n        .custom-table thead th {\r\n            border: none;\r\n            padding: 1rem;\r\n            font-weight: 600;\r\n        }\r\n\r\n        .custom-table tbody tr {\r\n            border-bottom: 1px solid #e9ecef;\r\n        }\r\n\r\n        .custom-table tbody tr:hover {\r\n            background-color: #f8f9fa;\r\n        }\r\n\r\n        .custom-table tbody td {\r\n            padding: 0.75rem 1rem;\r\n            vertical-align: middle;\r\n        }\r\n\r\n        .part-number {\r\n            font-weight: 600;\r\n            color: var(--fb-primary);\r\n        }\r\n\r\n        .action-buttons {\r\n            position: sticky;\r\n            bottom: 0;\r\n            background: white;\r\n            padding: 1.5rem;\r\n            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);\r\n            border-top: 1px solid #e9ecef;\r\n            z-index: 100;\r\n        }\r\n\r\n        .btn-import {\r\n            background-color: var(--fb-success);\r\n            border-color: var(--fb-success);\r\n            color: white;\r\n            padding: 0.75rem 2rem;\r\n            font-weight: 600;\r\n            font-size: 1.1rem;\r\n        }\r\n\r\n        .btn-import:hover {\r\n            background-color: #1B5E20;\r\n            border-color: #1B5E20;\r\n            color: white;\r\n        }\r\n\r\n        .btn-import:disabled {\r\n            background-color: #9E9E9E;\r\n            border-color: #9E9E9E;\r\n        }\r\n\r\n        .alert-custom {\r\n            border-radius: 8px;\r\n            border-left: 4px solid;\r\n            padding: 1rem 1.5rem;\r\n        }\r\n\r\n        .mode-selector {\r\n            background: white;\r\n            padding: 1.5rem;\r\n            border-radius: 8px;\r\n            margin-bottom: 1.5rem;\r\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\r\n        }\r\n\r\n        .mode-option {\r\n            border: 2px solid #e9ecef;\r\n            padding: 1rem;\r\n            border-radius: 8px;\r\n            cursor: pointer;\r\n            transition: all 0.2s;\r\n        }\r\n\r\n        .mode-option:hover {\r\n            border-color: var(--fb-primary-light);\r\n            background-color: #f8f9fa;\r\n        }\r\n\r\n        .mode-option.active {\r\n            border-color: var(--fb-primary);\r\n            background-color: rgba(21, 101, 192, 0.05);\r\n        }\r\n\r\n        .mode-option input[type=\"radio\"] {\r\n            width: 1.25rem;\r\n            height: 1.25rem;\r\n            accent-color: var(--fb-primary);\r\n        }\r\n\r\n        .badge-custom {\r\n            padding: 0.4rem 0.8rem;\r\n            font-weight: 600;\r\n            font-size: 0.875rem;\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n    <!-- Header -->\r\n    <div class=\"page-header\">\r\n        <div class=\"container-fluid px-4\">\r\n            <div class=\"row align-items-center\">\r\n                <div class=\"col-md-8\">\r\n                    <h1 class=\"mb-2\"><i class=\"bi bi-geo-alt-fill\"></i> Default Parts Location Manager</h1>\r\n                    <p class=\"mb-0 opacity-75\">Configure default locations for inventory parts across location groups</p>\r\n                </div>\r\n                <div class=\"col-md-4 text-md-end\">\r\n                    <span class=\"badge bg-light text-dark badge-custom\">\r\n                        <i class=\"bi bi-database-fill\"></i> Fishbowl Inventory\r\n                    </span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"container-fluid px-4 pb-5\">\r\n        <!-- Stats Row -->\r\n        <div class=\"row mb-4\">\r\n            <div class=\"col-md-3\">\r\n                <div class=\"stats-card\">\r\n                    <div class=\"d-flex justify-content-between align-items-center\">\r\n                        <div>\r\n                            <div class=\"text-muted small mb-1\">Parts to Configure</div>\r\n                            <div class=\"stats-number\" id=\"recordCount\">0</div>\r\n                        </div>\r\n                        <div class=\"text-primary\" style=\"font-size: 2.5rem;\">\r\n                            <i class=\"bi bi-box-seam\"></i>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"col-md-3\">\r\n                <div class=\"stats-card\">\r\n                    <div class=\"d-flex justify-content-between align-items-center\">\r\n                        <div>\r\n                            <div class=\"text-muted small mb-1\">Ready to Import</div>\r\n                            <div class=\"stats-number text-success\" id=\"readyCount\">0</div>\r\n                        </div>\r\n                        <div class=\"text-success\" style=\"font-size: 2.5rem;\">\r\n                            <i class=\"bi bi-check-circle-fill\"></i>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"col-md-3\">\r\n                <div class=\"stats-card\">\r\n                    <div class=\"d-flex justify-content-between align-items-center\">\r\n                        <div>\r\n                            <div class=\"text-muted small mb-1\">Location Groups</div>\r\n                            <div class=\"stats-number text-info\" id=\"locationGroupCount\">0</div>\r\n                        </div>\r\n                        <div class=\"text-info\" style=\"font-size: 2.5rem;\">\r\n                            <i class=\"bi bi-diagram-3-fill\"></i>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"col-md-3\">\r\n                <div class=\"stats-card\">\r\n                    <div class=\"d-flex justify-content-between align-items-center\">\r\n                        <div>\r\n                            <div class=\"text-muted small mb-1\">Mode</div>\r\n                            <div class=\"small fw-bold\" id=\"currentMode\">Default Locations</div>\r\n                        </div>\r\n                        <div class=\"text-warning\" style=\"font-size: 2.5rem;\">\r\n                            <i class=\"bi bi-toggles\"></i>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Mode Selector -->\r\n        <div class=\"mode-selector\">\r\n            <h5 class=\"mb-3\"><i class=\"bi bi-sliders\"></i> Location Assignment Mode</h5>\r\n            <div class=\"row g-3\">\r\n                <div class=\"col-md-6\">\r\n                    <div class=\"mode-option active\" id=\"modeDefault\" onclick=\"setMode('default')\">\r\n                        <div class=\"d-flex align-items-start\">\r\n                            <input type=\"radio\" name=\"mode\" value=\"default\" checked class=\"me-3 mt-1\">\r\n                            <div>\r\n                                <h6 class=\"mb-2\"><i class=\"bi bi-magic\"></i> Automatic Default Locations</h6>\r\n                                <p class=\"text-muted small mb-0\">\r\n                                    Use the default stock location (type 10) configured for each location group.\r\n                                    This is the fastest method for standard warehouse setups.\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"col-md-6\">\r\n                    <div class=\"mode-option\" id=\"modeManual\" onclick=\"setMode('manual')\">\r\n                        <div class=\"d-flex align-items-start\">\r\n                            <input type=\"radio\" name=\"mode\" value=\"manual\" class=\"me-3 mt-1\">\r\n                            <div>\r\n                                <h6 class=\"mb-2\"><i class=\"bi bi-hand-index\"></i> Manual Location Selection</h6>\r\n                                <p class=\"text-muted small mb-0\">\r\n                                    Choose specific locations for each part and location group combination.\r\n                                    Useful for non-standard or specialized storage requirements.\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Status Messages -->\r\n        <div id=\"statusMessage\" style=\"display: none;\"></div>\r\n\r\n        <!-- Data Table -->\r\n        <div class=\"custom-table\">\r\n            <table class=\"table table-hover mb-0\" id=\"report-table\">\r\n                <thead>\r\n                    <tr>\r\n                        <th style=\"width: 30%;\">Part Number</th>\r\n                        <th style=\"width: 35%;\">Location</th>\r\n                        <th style=\"width: 35%;\">Location Group</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody id=\"tableBody\">\r\n                    <!-- Table rows will be populated here -->\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n\r\n        <!-- Action Buttons -->\r\n        <div class=\"action-buttons\">\r\n            <div class=\"container-fluid\">\r\n                <div class=\"row align-items-center\">\r\n                    <div class=\"col-md-6\">\r\n                        <div class=\"text-muted\">\r\n                            <i class=\"bi bi-info-circle\"></i>\r\n                            Review the locations above and click Import to apply changes to Fishbowl\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"col-md-6 text-md-end\">\r\n                        <button class=\"btn btn-outline-secondary me-2\" onclick=\"refreshData()\">\r\n                            <i class=\"bi bi-arrow-clockwise\"></i> Refresh\r\n                        </button>\r\n                        <button class=\"btn btn-import\" id=\"importButton\" onclick=\"importDefaultLocations()\">\r\n                            <i class=\"bi bi-cloud-upload-fill\"></i> Import to Fishbowl\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Bootstrap 5.3 JS -->\r\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\r\n\r\n    <script>\r\n    let dataset = [];\r\n    let availableLocations = {};  // Cache of locations per location group\r\n    let currentMode = 'default';  // 'default' or 'manual'\r\n\r\n    // Load available locations for all location groups\r\n    function loadAvailableLocations() {\r\n        try {\r\n            let query = `SELECT\r\n                lg.id as locationgroupid,\r\n                lg.name as locationgroupname,\r\n                loc.id as locationid,\r\n                loc.name as locationname,\r\n                loc.typeid as locationtype,\r\n                loc.defaultflag as isdefault\r\n            FROM locationgroup lg\r\n            INNER JOIN location loc ON loc.locationgroupid = lg.id\r\n            WHERE lg.activeflag = 1\r\n                AND loc.activeflag = 1\r\n            ORDER BY lg.name, loc.defaultflag DESC, loc.name`;\r\n\r\n            let result = JSON.parse(runQuery(query));\r\n\r\n            // Organize by location group\r\n            availableLocations = {};\r\n            result.forEach(function(row) {\r\n                if (!availableLocations[row.locationgroupid]) {\r\n                    availableLocations[row.locationgroupid] = {\r\n                        name: row.locationgroupname,\r\n                        locations: []\r\n                    };\r\n                }\r\n                availableLocations[row.locationgroupid].locations.push({\r\n                    id: row.locationid,\r\n                    name: row.locationname,\r\n                    type: row.locationtype,\r\n                    isDefault: row.isdefault === 1,\r\n                    isStock: row.locationtype === 10\r\n                });\r\n            });\r\n\r\n            console.log('Loaded locations for', Object.keys(availableLocations).length, 'location groups');\r\n        } catch(e) {\r\n            console.error('Error loading available locations:', e);\r\n        }\r\n    }\r\n\r\n    function getData() {\r\n        let query = `SELECT\r\n            part.num as partnum,\r\n            part.id as partid,\r\n            loc.name as location,\r\n            loc.id as locationid,\r\n            locationgroup.name as locationgroup,\r\n            locationgroup.id as locationgroupid\r\n        FROM part\r\n        CROSS JOIN locationgroup\r\n        INNER JOIN location loc ON loc.locationgroupid = locationgroup.id\r\n            AND loc.typeid = 10\r\n            AND loc.defaultflag = 1\r\n        LEFT JOIN defaultlocation ON defaultlocation.partid = part.id\r\n            AND defaultlocation.locationgroupid = locationgroup.id\r\n        WHERE part.typeid = 10\r\n            AND defaultlocation.id IS NULL\r\n            AND locationgroup.activeFlag = 1\r\n        ORDER BY part.num, locationgroup.name`;\r\n\r\n        console.log('Executing query:', query);\r\n        let result = JSON.parse(runQuery(query));\r\n        console.log('Query results:', result.length, 'rows');\r\n        return result;\r\n    }\r\n\r\n    function setMode(mode) {\r\n        currentMode = mode;\r\n\r\n        // Update UI\r\n        document.getElementById('modeDefault').classList.toggle('active', mode === 'default');\r\n        document.getElementById('modeManual').classList.toggle('active', mode === 'manual');\r\n        document.querySelector('input[value=\"default\"]').checked = (mode === 'default');\r\n        document.querySelector('input[value=\"manual\"]').checked = (mode === 'manual');\r\n        document.getElementById('currentMode').textContent = mode === 'default' ? 'Default Locations' : 'Manual Selection';\r\n\r\n        // Redraw table with appropriate controls\r\n        drawTable();\r\n    }\r\n\r\n    function createLocationDropdown(row) {\r\n        let lgId = row.locationgroupid;\r\n        let lgData = availableLocations[lgId];\r\n\r\n        if (!lgData) {\r\n            return `<select class=\"location-select\" disabled><option>No locations available</option></select>`;\r\n        }\r\n\r\n        let options = lgData.locations.map(function(loc) {\r\n            let label = loc.name;\r\n            if (loc.isDefault && loc.isStock) {\r\n                label += ' (Default Stock)';\r\n            } else if (loc.isStock) {\r\n                label += ' (Stock)';\r\n            }\r\n\r\n            let selected = loc.name === row.location ? 'selected' : '';\r\n            return `<option value=\"${loc.name}\" ${selected}>${label}</option>`;\r\n        }).join('');\r\n\r\n        return `<select class=\"location-select\" onchange=\"updateLocation(this, '${row.partnum}', '${row.locationgroup}')\">${options}</select>`;\r\n    }\r\n\r\n    function updateLocation(selectElement, partnum, locationgroup) {\r\n        let newLocation = selectElement.value;\r\n\r\n        // Update the dataset\r\n        let item = dataset.find(function(row) {\r\n            return row.partnum === partnum && row.locationgroup === locationgroup;\r\n        });\r\n\r\n        if (item) {\r\n            item.location = newLocation;\r\n            console.log('Updated', partnum, 'in', locationgroup, 'to location:', newLocation);\r\n            updateStats();\r\n        }\r\n    }\r\n\r\n    function drawTable() {\r\n        let tbody = document.getElementById('tableBody');\r\n        tbody.innerHTML = '';\r\n\r\n        if (dataset.length === 0) {\r\n            tbody.innerHTML = `\r\n                <tr>\r\n                    <td colspan=\"3\" class=\"text-center text-muted py-5\">\r\n                        <i class=\"bi bi-inbox\" style=\"font-size: 3rem;\"></i>\r\n                        <div class=\"mt-3\">No parts found that need default locations</div>\r\n                        <div class=\"small\">All parts already have default locations configured</div>\r\n                    </td>\r\n                </tr>\r\n            `;\r\n            return;\r\n        }\r\n\r\n        dataset.forEach(function(row) {\r\n            let tr = document.createElement('tr');\r\n\r\n            // Part Number\r\n            let tdPart = document.createElement('td');\r\n            tdPart.innerHTML = `<span class=\"part-number\">${row.partnum}</span>`;\r\n            tr.appendChild(tdPart);\r\n\r\n            // Location (editable in manual mode)\r\n            let tdLocation = document.createElement('td');\r\n            if (currentMode === 'manual') {\r\n                tdLocation.innerHTML = createLocationDropdown(row);\r\n            } else {\r\n                tdLocation.innerHTML = `<span class=\"badge bg-primary\">${row.location}</span>`;\r\n            }\r\n            tr.appendChild(tdLocation);\r\n\r\n            // Location Group\r\n            let tdGroup = document.createElement('td');\r\n            tdGroup.textContent = row.locationgroup;\r\n            tr.appendChild(tdGroup);\r\n\r\n            tbody.appendChild(tr);\r\n        });\r\n\r\n        updateStats();\r\n    }\r\n\r\n    function updateStats() {\r\n        document.getElementById('recordCount').textContent = dataset.length;\r\n        document.getElementById('readyCount').textContent = dataset.length;\r\n\r\n        // Count unique location groups\r\n        let uniqueGroups = new Set(dataset.map(function(row) { return row.locationgroup; }));\r\n        document.getElementById('locationGroupCount').textContent = uniqueGroups.size;\r\n    }\r\n\r\n    function showStatus(message, type) {\r\n        const statusDiv = document.getElementById('statusMessage');\r\n        statusDiv.style.display = 'block';\r\n\r\n        let iconClass = '';\r\n        let alertClass = '';\r\n\r\n        if (type === 'success') {\r\n            iconClass = 'bi-check-circle-fill';\r\n            alertClass = 'alert-success alert-custom';\r\n        } else if (type === 'error') {\r\n            iconClass = 'bi-exclamation-triangle-fill';\r\n            alertClass = 'alert-danger alert-custom';\r\n        } else if (type === 'info') {\r\n            iconClass = 'bi-info-circle-fill';\r\n            alertClass = 'alert-info alert-custom';\r\n        }\r\n\r\n        statusDiv.className = `alert ${alertClass} mb-4`;\r\n        statusDiv.innerHTML = `<i class=\"bi ${iconClass} me-2\"></i>${message}`;\r\n\r\n        // Auto-hide success messages after 5 seconds\r\n        if (type === 'success') {\r\n            setTimeout(function() {\r\n                statusDiv.style.display = 'none';\r\n            }, 5000);\r\n        }\r\n\r\n        // Scroll to top to show message\r\n        window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    }\r\n\r\n    function refreshData() {\r\n        dataset = getData();\r\n        drawTable();\r\n        showStatus('Data refreshed successfully', 'success');\r\n    }\r\n\r\n    function importDefaultLocations() {\r\n        const button = document.getElementById('importButton');\r\n\r\n        if (dataset.length === 0) {\r\n            showStatus('No records to import! All parts already have default locations configured.', 'error');\r\n            return;\r\n        }\r\n\r\n        // Disable button during import\r\n        button.disabled = true;\r\n        button.innerHTML = '<i class=\"bi bi-hourglass-split\"></i> Importing...';\r\n        showStatus('Preparing import data...', 'info');\r\n\r\n        try {\r\n            // Build rows array in the format expected by Fishbowl API\r\n            let rows = [\r\n                '\"partnum\",\"location\",\"locationgroup\"'\r\n            ];\r\n\r\n            dataset.forEach(function(row) {\r\n                rows.push(\r\n                    '\"' + row.partnum + '\",' +\r\n                    '\"' + row.location + '\",' +\r\n                    '\"' + row.locationgroup + '\"'\r\n                );\r\n            });\r\n\r\n            // Build API request payload\r\n            let payload = {\r\n                \"ImportRq\": {\r\n                    \"Type\": \"ImportDefaultLocations\",\r\n                    \"Rows\": {\r\n                        \"Row\": rows\r\n                    }\r\n                }\r\n            };\r\n\r\n            console.log('Import Request:', payload);\r\n            showStatus(`Importing ${dataset.length} default locations to Fishbowl...`, 'info');\r\n\r\n            // Call the Fishbowl API\r\n            let response = runApiRequest('ImportRq', JSON.stringify(payload));\r\n            console.log('Import Response (raw):', response);\r\n\r\n            if (!response) {\r\n                showStatus('Import failed: No response from API. Please check your connection to Fishbowl.', 'error');\r\n                button.disabled = false;\r\n                button.innerHTML = '<i class=\"bi bi-cloud-upload-fill\"></i> Import to Fishbowl';\r\n                return;\r\n            }\r\n\r\n            // Parse response\r\n            let result = typeof response === 'string' ? JSON.parse(response) : response;\r\n            console.log('Import Result (parsed):', result);\r\n\r\n            // Check for success\r\n            if (result && result.ImportRs && result.ImportRs.statusCode === 1000) {\r\n                showStatus(\r\n                    `<strong>Success!</strong> Successfully imported ${dataset.length} default locations to Fishbowl. ` +\r\n                    `<button class=\"btn btn-sm btn-light ms-3\" onclick=\"refreshData()\">Refresh Data</button>`,\r\n                    'success'\r\n                );\r\n\r\n                // Refresh the table after successful import\r\n                setTimeout(function() {\r\n                    refreshData();\r\n                }, 3000);\r\n            } else {\r\n                let errorMsg = '<strong>Import Failed</strong><br>';\r\n                let statusMessage = '';\r\n\r\n                if (result && result.ImportRs && result.ImportRs.statusMessage) {\r\n                    statusMessage = result.ImportRs.statusMessage;\r\n                    errorMsg += statusMessage;\r\n                } else if (result && result.ErrorRs && result.ErrorRs.statusMessage) {\r\n                    statusMessage = result.ErrorRs.statusMessage;\r\n                    errorMsg += statusMessage;\r\n                } else {\r\n                    errorMsg += 'Unknown error: ' + JSON.stringify(result);\r\n                }\r\n\r\n                // Try to extract line number from error message\r\n                let lineNumberMatch = statusMessage.match(/Line Number:\\s*(\\d+)/i);\r\n                if (lineNumberMatch && lineNumberMatch[1]) {\r\n                    let csvLineNum = parseInt(lineNumberMatch[1]);\r\n                    let arrayIndex = csvLineNum - 1;\r\n\r\n                    if (arrayIndex >= 0 && arrayIndex < rows.length) {\r\n                        console.error('Error on CSV line ' + csvLineNum + ': ' + rows[arrayIndex]);\r\n\r\n                        let contextStart = Math.max(0, arrayIndex - 2);\r\n                        let contextEnd = Math.min(rows.length - 1, arrayIndex + 2);\r\n\r\n                        errorMsg += '<div class=\"mt-3\"><strong>CSV Context:</strong><pre class=\"bg-dark text-light p-3 rounded mt-2\" style=\"font-size: 0.875rem;\">';\r\n                        for (let i = contextStart; i <= contextEnd; i++) {\r\n                            let prefix = i === arrayIndex ? '>>> ' : '    ';\r\n                            let color = i === arrayIndex ? 'color: #ff6b6b; font-weight: bold;' : '';\r\n                            errorMsg += `<div style=\"${color}\">${prefix}Line ${i + 1}: ${rows[i]}</div>`;\r\n                        }\r\n                        errorMsg += '</pre></div>';\r\n                    }\r\n                }\r\n\r\n                showStatus(errorMsg, 'error');\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error('Error during import:', error);\r\n            showStatus('<strong>Import Error:</strong> ' + error.message, 'error');\r\n        } finally {\r\n            // Re-enable button\r\n            button.disabled = false;\r\n            button.innerHTML = '<i class=\"bi bi-cloud-upload-fill\"></i> Import to Fishbowl';\r\n        }\r\n    }\r\n\r\n    // Initialize on page load\r\n    window.addEventListener('DOMContentLoaded', function() {\r\n        loadAvailableLocations();\r\n        dataset = getData();\r\n        drawTable();\r\n    });\r\n\r\n    const displayHeader = typeof $CHECK !== 'undefined' ? $CHECK{Display_header|true} : true;\r\n    </script>\r\n</body>\r\n</html>\r\n",
  "active" : true,
  "note" : "",
  "type" : "Page"
} ]