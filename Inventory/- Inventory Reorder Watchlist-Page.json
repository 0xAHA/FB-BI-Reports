[ {
  "name" : "- Inventory Reorder Watchlist",
  "description" : "1. Inventory Reorder Watchlist",
  "data" : "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Inventory Reorder Monitor - Fishbowl Advanced</title>\r\n\r\n    <!-- Tailwind CSS -->\r\n    <script src=\"https://cdn.tailwindcss.com\"></script>\r\n\r\n    <!-- D3.js v7 -->\r\n    <script src=\"https://d3js.org/d3.v7.min.js\"></script>\r\n\r\n    <!-- Google Fonts -->\r\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap\" rel=\"stylesheet\">\r\n\r\n    <!-- DataTables CDN Links -->\r\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.datatables.net/v/bs4-4.1.1/jq-3.3.1/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/b-html5-1.6.1/b-print-1.6.1/cr-1.5.2/fh-3.1.6/r-2.2.3/sc-2.0.1/datatables.min.css\"/>\r\n    <script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js\"></script>\r\n    <script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js\"></script>\r\n    <script type=\"text/javascript\" src=\"https://cdn.datatables.net/v/bs4-4.1.1/jq-3.3.1/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/b-html5-1.6.1/b-print-1.6.1/cr-1.5.2/fh-3.1.6/r-2.2.3/sc-2.0.1/datatables.min.js\"></script>\r\n    <style>\r\n        /* ============================================\r\n           Base Styles (matching Sales Dashboard)\r\n           ============================================ */\r\n        html, body {\r\n            height: 100%;\r\n            margin: 0;\r\n            padding: 0;\r\n            overflow: hidden;\r\n            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\r\n        }\r\n\r\n        /* Custom Brand Colors (matching Sales Dashboard) */\r\n        :root {\r\n            --color-primary: #2d9cdb;\r\n            --color-primary-dark: #1e7bb4;\r\n            --color-sidebar: #06162d;\r\n            --color-sidebar-hover: #0a1f3d;\r\n        }\r\n\r\n        /* Custom Scrollbar */\r\n        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }\r\n        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }\r\n        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }\r\n        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }\r\n\r\n        /* Override Tailwind indigo with custom blue */\r\n        .bg-indigo-600 { background-color: var(--color-primary) !important; }\r\n        .bg-indigo-50 { background-color: rgba(45, 156, 219, 0.1) !important; }\r\n        .text-indigo-600 { color: var(--color-primary) !important; }\r\n        .text-indigo-700 { color: var(--color-primary-dark) !important; }\r\n        .border-indigo-200 { border-color: rgba(45, 156, 219, 0.3) !important; }\r\n        .hover\\:text-indigo-600:hover { color: var(--color-primary) !important; }\r\n        .hover\\:bg-indigo-50:hover { background-color: rgba(45, 156, 219, 0.1) !important; }\r\n\r\n        /* ============================================\r\n           DataTables Overrides\r\n           ============================================ */\r\n        table.dataTable {\r\n            table-layout: fixed;\r\n            font-size: 12px;\r\n            border-collapse: separate;\r\n            border-spacing: 0;\r\n        }\r\n\r\n        table.dataTable thead th {\r\n            font-size: 12px;\r\n            padding: 12px 8px;\r\n            background-color: #f8f9fa !important;\r\n            color: #475569 !important;\r\n            font-weight: 600;\r\n            border: none;\r\n            border-bottom: 2px solid #e2e8f0;\r\n            text-align: center;\r\n            white-space: normal;\r\n            line-height: 1.3;\r\n            text-transform: uppercase;\r\n            letter-spacing: 0.5px;\r\n        }\r\n\r\n        table.dataTable thead th:first-child {\r\n            border-top-left-radius: 0px;\r\n        }\r\n\r\n        table.dataTable thead th:last-child {\r\n            border-top-right-radius: 0px;\r\n        }\r\n\r\n        table.dataTable tbody td {\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            white-space: nowrap;\r\n            font-size: 12px;\r\n            padding: 8px;\r\n            border-bottom: 1px solid #e2e8f0;\r\n        }\r\n\r\n        /* Center aligned columns */\r\n        table.dataTable tbody td.dt-center {\r\n            text-align: center;\r\n        }\r\n\r\n        /* Right aligned columns */\r\n        table.dataTable tbody td.dt-right {\r\n            text-align: right;\r\n        }\r\n\r\n        table.dataTable tbody tr {\r\n            background-color: white;\r\n            transition: background-color 0.15s ease;\r\n        }\r\n\r\n        table.dataTable tbody tr:hover {\r\n            background-color: #f8fafc;\r\n        }\r\n\r\n        /* Vendor Group Header Row */\r\n        .vendor-group-header td {\r\n            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%) !important;\r\n            font-weight: 700;\r\n            padding: 12px !important;\r\n            font-size: 13px;\r\n            border-top: 2px solid var(--color-primary);\r\n            border-bottom: 1px solid #cbd5e1;\r\n            color: #1e293b;\r\n        }\r\n\r\n        /* Clickable Links */\r\n        .item-link {\r\n            color: #2d9cdb;\r\n            text-decoration: none;\r\n            font-weight: 600;\r\n            cursor: pointer;\r\n        }\r\n\r\n        .item-link:hover {\r\n            text-decoration: underline;\r\n            color: #1e7bb4;\r\n        }\r\n\r\n        /* Expandable Row Styling */\r\n        .expandable-row {\r\n            cursor: pointer;\r\n        }\r\n\r\n        .expandable-row:hover {\r\n            background-color: #f0f9ff !important;\r\n        }\r\n\r\n        .expand-icon {\r\n            transition: transform 0.2s ease;\r\n            display: inline-block;\r\n        }\r\n\r\n        .expand-icon.expanded {\r\n            transform: rotate(90deg);\r\n        }\r\n\r\n        /* Location Group Detail Row */\r\n        .location-detail-row td {\r\n            background-color: #f8fafc !important;\r\n            font-size: 11px;\r\n            padding: 4px 8px !important;\r\n            border-bottom: 1px solid #e2e8f0;\r\n        }\r\n\r\n        .location-detail-row:last-child td {\r\n            border-bottom: 2px solid #cbd5e1;\r\n        }\r\n\r\n        .location-detail-table {\r\n            width: 100%;\r\n            font-size: 11px;\r\n        }\r\n\r\n        .location-detail-table th {\r\n            text-align: left;\r\n            font-weight: 600;\r\n            color: #64748b;\r\n            padding: 4px 8px;\r\n            border-bottom: 1px solid #e2e8f0;\r\n        }\r\n\r\n        .location-detail-table td {\r\n            padding: 4px 8px;\r\n            border-bottom: 1px solid #f1f5f9;\r\n        }\r\n\r\n        /* Column Group Styling */\r\n        .group-status {\r\n            background-color: #e0f2fe !important;\r\n        }\r\n\r\n        .group-part-info {\r\n            background-color: #f1f5f9 !important;\r\n        }\r\n\r\n        .group-inventory-key {\r\n            background-color: #fef3c7 !important;\r\n        }\r\n\r\n        .group-reorder-params {\r\n            background-color: #dcfce7 !important;\r\n        }\r\n\r\n        .group-allocation {\r\n            background-color: #fafafa !important;\r\n        }\r\n\r\n        /* DataTables Controls */\r\n        .dataTables_wrapper .dataTables_length {\r\n            float: left;\r\n            margin-bottom: 16px;\r\n            font-size: 11px;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_length select {\r\n            padding: 3px 24px 3px 8px;\r\n            border: 1px solid #cbd5e1;\r\n            border-radius: 3px;\r\n            font-size: 11px;\r\n            margin: 0 4px;\r\n            background-color: white;\r\n            appearance: none;\r\n            -webkit-appearance: none;\r\n            -moz-appearance: none;\r\n            background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23475569' d='M6 9L1 4h10z'/%3E%3C/svg%3E\");\r\n            background-repeat: no-repeat;\r\n            background-position: right 6px center;\r\n            background-size: 10px;\r\n            cursor: pointer;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_length select:focus {\r\n            outline: none;\r\n            border-color: #2d9cdb;\r\n            box-shadow: none;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_filter {\r\n            float: right;\r\n            margin-bottom: 16px;\r\n            font-size: 11px;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_filter input {\r\n            margin-left: 8px;\r\n            padding: 3px 8px;\r\n            border: 1px solid #cbd5e1;\r\n            border-radius: 3px;\r\n            font-size: 11px;\r\n            transition: all 0.2s ease;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_filter input:focus {\r\n            outline: none;\r\n            border-color: #2d9cdb;\r\n            box-shadow: none;\r\n        }\r\n\r\n        /* DataTables Buttons */\r\n        .dt-buttons {\r\n            float: right;\r\n            margin-bottom: 16px;\r\n            margin-right: 16px;\r\n        }\r\n\r\n        .dt-buttons .dt-button {\r\n            font-size: 11px !important;\r\n            padding: 3px 8px !important;\r\n            margin-left: 8px !important;\r\n            background-color: white !important;\r\n            color: #2d9cdb !important;\r\n            border: 1px solid #cbd5e1 !important;\r\n            border-radius: 3px !important;\r\n            cursor: pointer !important;\r\n            transition: all 0.2s ease !important;\r\n            font-weight: 500 !important;\r\n            background-image: none !important;\r\n            text-shadow: none !important;\r\n            box-shadow: none !important;\r\n        }\r\n\r\n        .dt-buttons .dt-button:hover {\r\n            background-color: #f8fafc !important;\r\n            color: #1e7bb4 !important;\r\n            border-color: #2d9cdb !important;\r\n            box-shadow: none !important;\r\n        }\r\n\r\n        .dt-buttons .dt-button:active,\r\n        .dt-buttons .dt-button:focus {\r\n            background-color: #f8fafc !important;\r\n            color: #1e7bb4 !important;\r\n            border-color: #2d9cdb !important;\r\n            box-shadow: none !important;\r\n            outline: none !important;\r\n        }\r\n\r\n        /* More specific selectors for DataTables buttons */\r\n        .dt-button.buttons-csv,\r\n        .dt-button.buttons-print,\r\n        a.dt-button.buttons-csv,\r\n        a.dt-button.buttons-print,\r\n        button.dt-button.buttons-csv,\r\n        button.dt-button.buttons-print {\r\n            font-size: 11px !important;\r\n            padding: 3px 8px !important;\r\n            margin-left: 8px !important;\r\n            background-color: white !important;\r\n            color: #2d9cdb !important;\r\n            border: 1px solid #cbd5e1 !important;\r\n            border-radius: 3px !important;\r\n            cursor: pointer !important;\r\n            transition: all 0.2s ease !important;\r\n            font-weight: 500 !important;\r\n            background-image: none !important;\r\n            text-shadow: none !important;\r\n            box-shadow: none !important;\r\n        }\r\n\r\n        .dt-button.buttons-csv:hover,\r\n        .dt-button.buttons-print:hover,\r\n        a.dt-button.buttons-csv:hover,\r\n        a.dt-button.buttons-print:hover,\r\n        button.dt-button.buttons-csv:hover,\r\n        button.dt-button.buttons-print:hover {\r\n            background-color: #f8fafc !important;\r\n            color: #1e7bb4 !important;\r\n            border-color: #2d9cdb !important;\r\n            box-shadow: none !important;\r\n        }\r\n\r\n        .dt-button.buttons-csv:active,\r\n        .dt-button.buttons-print:active,\r\n        .dt-button.buttons-csv:focus,\r\n        .dt-button.buttons-print:focus {\r\n            background-color: #f8fafc !important;\r\n            color: #1e7bb4 !important;\r\n            border-color: #2d9cdb !important;\r\n            box-shadow: none !important;\r\n            outline: none !important;\r\n        }\r\n\r\n        /* Custom button class */\r\n        .btn-custom-blue {\r\n            font-size: 11px !important;\r\n            padding: 3px 8px !important;\r\n            margin-left: 8px !important;\r\n            background-color: white !important;\r\n            color: #2d9cdb !important;\r\n            border: 1px solid #cbd5e1 !important;\r\n            border-radius: 3px !important;\r\n            cursor: pointer !important;\r\n            font-weight: 500 !important;\r\n            background-image: none !important;\r\n            text-shadow: none !important;\r\n            box-shadow: none !important;\r\n        }\r\n\r\n        .btn-custom-blue:hover {\r\n            background-color: #f8fafc !important;\r\n            color: #1e7bb4 !important;\r\n            border-color: #2d9cdb !important;\r\n            box-shadow: none !important;\r\n        }\r\n\r\n        /* Hide DataTables buttons (we use custom buttons) */\r\n        .dt-buttons {\r\n            display: none !important;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_info {\r\n            color: #666;\r\n            font-size: 11px;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_paginate {\r\n            color: #666;\r\n            font-size: 11px;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_paginate .paginate_button {\r\n            padding: 4px 10px;\r\n            margin-left: 4px;\r\n            border-radius: 3px;\r\n            border: 1px solid #ccc;\r\n            background-color: white;\r\n            color: #333 !important;\r\n            transition: all 0.2s ease;\r\n            font-size: 11px;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {\r\n            background-color: #f0f0f0 !important;\r\n            color: #333 !important;\r\n            border-color: #999;\r\n        }\r\n\r\n        .dataTables_wrapper .dataTables_paginate .paginate_button.current {\r\n            background-color: #2d9cdb !important;\r\n            color: white !important;\r\n            border-color: #2d9cdb;\r\n        }\r\n\r\n        /* ============================================\r\n           Enhanced Print Styles\r\n           ============================================ */\r\n        @media print {\r\n            html, body {\r\n                overflow: visible;\r\n            }\r\n\r\n            @page {\r\n                size: A4 landscape;\r\n                margin: 0.5in;\r\n            }\r\n\r\n            .dataTables_wrapper .dataTables_length,\r\n            .dataTables_wrapper .dataTables_filter,\r\n            .dataTables_wrapper .dataTables_info,\r\n            .dataTables_wrapper .dataTables_paginate,\r\n            .dataTables_wrapper .dataTables_processing,\r\n            .dt-buttons,\r\n            button,\r\n            .btn,\r\n            header {\r\n                display: none !important;\r\n            }\r\n\r\n            #headerContainer h1 {\r\n                font-size: 18pt;\r\n                margin: 0 0 10px 0;\r\n                color: #000;\r\n            }\r\n\r\n            table.dataTable {\r\n                width: 100% !important;\r\n                font-size: 7pt;\r\n            }\r\n\r\n            table.dataTable thead th {\r\n                background-color: #f8f9fa !important;\r\n                color: #475569 !important;\r\n                font-size: 6.5pt;\r\n                padding: 3px 2px;\r\n                border: 1px solid #ccc;\r\n                -webkit-print-color-adjust: exact;\r\n                print-color-adjust: exact;\r\n            }\r\n\r\n            table.dataTable tbody td {\r\n                font-size: 7pt;\r\n                padding: 2px 1px;\r\n                border: 1px solid #ccc;\r\n                -webkit-print-color-adjust: exact;\r\n                print-color-adjust: exact;\r\n            }\r\n\r\n            .vendor-group-header td {\r\n                background: linear-gradient(135deg, #e8e8e8 0%, #d0d0d0 100%) !important;\r\n                font-weight: bold;\r\n                font-size: 7.5pt;\r\n                padding: 4px 2px !important;\r\n                border: 1px solid #000 !important;\r\n                -webkit-print-color-adjust: exact;\r\n                print-color-adjust: exact;\r\n            }\r\n\r\n            table.dataTable tbody tr {\r\n                page-break-inside: avoid;\r\n            }\r\n        }\r\n    </style>\r\n</head>\r\n<body class=\"bg-slate-50\">\r\n    <div class=\"flex flex-col h-screen\">\r\n        <!-- Header (matching Sales Dashboard) -->\r\n        <header id=\"headerContainer\" class=\"h-20 bg-white border-b border-slate-200 px-8 flex items-center justify-between flex-shrink-0 z-20 shadow-sm\">\r\n            <div class=\"flex items-center gap-6\">\r\n                <div>\r\n                    <h1 class=\"text-xl font-bold text-slate-900\">Inventory Reorder Monitor</h1>\r\n                    <p class=\"text-xs text-slate-500 mt-0.5\">Real-time inventory reorder tracking and capacity monitoring</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"flex items-center gap-3\">\r\n                <!-- Help Button -->\r\n                <button onclick=\"toggleInstructions()\" class=\"px-3 py-2 bg-slate-100 hover:bg-slate-200 border border-slate-300 rounded-lg text-sm font-medium transition-colors\" title=\"View Usage Guide\">\r\n                    <svg class=\"w-4 h-4 inline mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                    </svg>\r\n                    Help\r\n                </button>\r\n\r\n                <!-- Refresh Button -->\r\n                <button onclick=\"refreshTable()\" class=\"p-2.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-xl transition-all\" title=\"Refresh Data\">\r\n                    <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"></path>\r\n                    </svg>\r\n                </button>\r\n            </div>\r\n        </header>\r\n\r\n        <!-- Content Area -->\r\n        <div class=\"flex-1 overflow-y-auto custom-scrollbar p-4 lg:p-8\">\r\n            <!-- Instructions Panel (hidden by default) -->\r\n            <div id=\"instructionsPanel\" class=\"bg-white rounded-2xl shadow-md border border-slate-300 p-6 mb-6\" style=\"display: none;\">\r\n                <div class=\"flex items-center justify-between mb-4\">\r\n                    <h2 class=\"text-lg font-bold text-slate-800 flex items-center gap-2\">\r\n                        <svg class=\"w-5 h-5 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\r\n                        </svg>\r\n                        Usage Guide\r\n                    </h2>\r\n                    <button onclick=\"toggleInstructions()\" class=\"text-slate-400 hover:text-slate-600 transition-colors\">\r\n                        <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                        </svg>\r\n                    </button>\r\n                </div>\r\n\r\n                <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                    <div>\r\n                        <h3 class=\"text-sm font-bold text-slate-700 mb-2\">Report Purpose</h3>\r\n                        <p class=\"text-sm text-slate-600 mb-4\">This report monitors inventory levels for parts with configured reorder points, displaying current stock status and recommended order quantities to maintain optimal inventory levels.</p>\r\n\r\n                        <h3 class=\"text-sm font-bold text-slate-700 mb-2\">Key Metrics</h3>\r\n                        <div class=\"text-sm text-slate-600 space-y-1\">\r\n                            <p><strong>Available:</strong> On Hand - Allocated - Not Available + Dropship</p>\r\n                            <p><strong>Qty to Order:</strong> Order Up To - (Available - Committed)</p>\r\n                            <p><strong>Reorder Point:</strong> Minimum threshold triggering reorder alert</p>\r\n                            <p><strong>Order Up To:</strong> Target maximum inventory level</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <h3 class=\"text-sm font-bold text-slate-700 mb-3\">Status Indicators</h3>\r\n                        <p class=\"text-sm text-slate-600 mb-3\">The Status column uses color-coded cells with gradient fills representing capacity percentage:</p>\r\n                        <div class=\"space-y-3\">\r\n                            <div class=\"flex items-center gap-3\">\r\n                                <div class=\"w-20 h-8 rounded flex items-center justify-center text-white text-xs font-semibold\" style=\"background: linear-gradient(to left, #C62828 75%, #EF9A9A 75%); text-shadow: 1px 1px 2px rgba(0,0,0,0.8);\">-75%</div>\r\n                                <div class=\"flex-1 text-xs\">\r\n                                    <strong class=\"text-slate-700\">Critical</strong>\r\n                                    <p class=\"text-slate-500\">Below reorder point - fills from right (negative values)</p>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"flex items-center gap-3\">\r\n                                <div class=\"w-20 h-8 rounded flex items-center justify-center text-white text-xs font-semibold\" style=\"background: linear-gradient(to right, #F57C00 20%, #FFCC80 20%); text-shadow: 1px 1px 2px rgba(0,0,0,0.8);\">20%</div>\r\n                                <div class=\"flex-1 text-xs\">\r\n                                    <strong class=\"text-slate-700\">Alert</strong>\r\n                                    <p class=\"text-slate-500\">Within 20% above reorder point - order soon</p>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"flex items-center gap-3\">\r\n                                <div class=\"w-20 h-8 rounded flex items-center justify-center text-white text-xs font-semibold\" style=\"background: linear-gradient(to right, #2E7D32 60%, #A5D6A7 60%); text-shadow: 1px 1px 2px rgba(0,0,0,0.8);\">60%</div>\r\n                                <div class=\"flex-1 text-xs\">\r\n                                    <strong class=\"text-slate-700\">Good</strong>\r\n                                    <p class=\"text-slate-500\">Adequate stock levels</p>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"flex items-center gap-3\">\r\n                                <div class=\"w-24 h-8 rounded flex items-center justify-center text-white text-xs font-semibold\" style=\"background: #1976D2; text-shadow: 1px 1px 2px rgba(0,0,0,0.8);\">Overstocked</div>\r\n                                <div class=\"flex-1 text-xs\">\r\n                                    <strong class=\"text-slate-700\">Overstocked</strong>\r\n                                    <p class=\"text-slate-500\">Above order up to level</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- Column Filters -->\r\n            <div class=\"bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-4\">\r\n                <div class=\"flex flex-wrap gap-3 items-end\">\r\n                    <div class=\"flex-1 min-w-[120px]\">\r\n                        <label class=\"block text-xs font-medium text-slate-600 mb-1\">Part Number</label>\r\n                        <input type=\"text\" id=\"filterPartNum\" class=\"w-full px-2 py-1 text-sm border border-slate-300 rounded\" placeholder=\"Filter...\" onkeyup=\"applyColumnFilters()\">\r\n                    </div>\r\n                    <div class=\"flex-1 min-w-[150px]\">\r\n                        <label class=\"block text-xs font-medium text-slate-600 mb-1\">Description</label>\r\n                        <input type=\"text\" id=\"filterDescription\" class=\"w-full px-2 py-1 text-sm border border-slate-300 rounded\" placeholder=\"Filter...\" onkeyup=\"applyColumnFilters()\">\r\n                    </div>\r\n                    <div class=\"flex-1 min-w-[120px]\">\r\n                        <label class=\"block text-xs font-medium text-slate-600 mb-1\">Vendor</label>\r\n                        <input type=\"text\" id=\"filterVendor\" class=\"w-full px-2 py-1 text-sm border border-slate-300 rounded\" placeholder=\"Filter...\" onkeyup=\"applyColumnFilters()\">\r\n                    </div>\r\n                    <div id=\"locationFilterContainer\" class=\"flex-1 min-w-[140px]\" style=\"display: none;\">\r\n                        <label class=\"block text-xs font-medium text-slate-600 mb-1\">Location Group</label>\r\n                        <div class=\"relative\">\r\n                            <button type=\"button\" id=\"locationFilterBtn\" onclick=\"toggleLocationDropdown()\" class=\"w-full px-2 py-1 text-sm border border-slate-300 rounded bg-white text-left flex justify-between items-center\">\r\n                                <span id=\"locationFilterLabel\">All</span>\r\n                                <svg class=\"w-4 h-4 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>\r\n                            </button>\r\n                            <div id=\"locationDropdown\" class=\"hidden absolute z-50 mt-1 w-full bg-white border border-slate-300 rounded shadow-lg max-h-48 overflow-y-auto\">\r\n                                <!-- Location checkboxes will be populated dynamically -->\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"flex-1 min-w-[140px]\">\r\n                        <label class=\"block text-xs font-medium text-slate-600 mb-1\">Status</label>\r\n                        <div class=\"relative\">\r\n                            <button type=\"button\" id=\"statusFilterBtn\" onclick=\"toggleStatusDropdown()\" class=\"w-full px-2 py-1 text-sm border border-slate-300 rounded bg-white text-left flex justify-between items-center\">\r\n                                <span id=\"statusFilterLabel\">All</span>\r\n                                <svg class=\"w-4 h-4 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>\r\n                            </button>\r\n                            <div id=\"statusDropdown\" class=\"hidden absolute z-50 mt-1 w-full bg-white border border-slate-300 rounded shadow-lg\">\r\n                                <label class=\"flex items-center px-2 py-1 hover:bg-slate-50 cursor-pointer text-sm\">\r\n                                    <input type=\"checkbox\" value=\"fb40\" class=\"status-checkbox mr-2\" onchange=\"updateStatusFilter()\"> Critical\r\n                                </label>\r\n                                <label class=\"flex items-center px-2 py-1 hover:bg-slate-50 cursor-pointer text-sm\">\r\n                                    <input type=\"checkbox\" value=\"fb30\" class=\"status-checkbox mr-2\" onchange=\"updateStatusFilter()\"> Alert\r\n                                </label>\r\n                                <label class=\"flex items-center px-2 py-1 hover:bg-slate-50 cursor-pointer text-sm\">\r\n                                    <input type=\"checkbox\" value=\"fb20\" class=\"status-checkbox mr-2\" onchange=\"updateStatusFilter()\"> Good\r\n                                </label>\r\n                                <label class=\"flex items-center px-2 py-1 hover:bg-slate-50 cursor-pointer text-sm\">\r\n                                    <input type=\"checkbox\" value=\"fb10\" class=\"status-checkbox mr-2\" onchange=\"updateStatusFilter()\"> Overstocked\r\n                                </label>\r\n                                <label class=\"flex items-center px-2 py-1 hover:bg-slate-50 cursor-pointer text-sm\">\r\n                                    <input type=\"checkbox\" value=\"norop\" class=\"status-checkbox mr-2\" onchange=\"updateStatusFilter()\"> No ROP/OUL\r\n                                </label>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"flex items-center gap-1\">\r\n                        <button onclick=\"clearColumnFilters()\" class=\"px-3 py-1 text-sm bg-slate-100 hover:bg-slate-200 text-slate-700 rounded border border-slate-300\">Clear</button>\r\n                        <button onclick=\"exportToCSV()\" class=\"p-1.5 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded border border-slate-300\" title=\"Export CSV\">\r\n                            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"></path></svg>\r\n                        </button>\r\n                        <button onclick=\"printTable()\" class=\"p-1.5 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded border border-slate-300\" title=\"Print\">\r\n                            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z\"></path></svg>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- Main Table Container -->\r\n            <div class=\"bg-white rounded-2xl shadow-md border border-slate-300 p-6\">\r\n                <table id=\"report-table\" class=\"display\" style=\"width:100%\"></table>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <script>\r\n    let partNum = '$PART{Part|%|General}';\r\n    if (!partNum || partNum == '' || partNum == -1 || partNum == '%') {\r\n        partNum = '%';\r\n    }\r\n\r\n    let vendorId = '$VEND{Vendor|%|General}';\r\n    vendorId == -1 ? (vendorId = '%') : true;\r\n    if (!vendorId || vendorId == '' || vendorId == '%') {\r\n        vendorId = '%';\r\n    }\r\n\r\n\r\n    let locationGroupId = '$LG{Location_Group|%|General}';\r\n    locationGroupId == -1 ? (locationGroupId = '%') : true;\r\n    let user = JSON.parse(getUser());\r\n    let currentUser = user.id;\r\n\r\n    // Filter checkboxes\r\n    const hideOverstocked = $CHECK{Hide_Overstocked|false};\r\n    const hideAdequate = $CHECK{Hide_Adequately_Stocked|false};\r\n    const hideApproaching = $CHECK{Hide_Approaching_Reorder|false};\r\n    const includeNoRopOul = $CHECK{Include_No_ROP_OUL|false};\r\n\r\n    let dataset;\r\n\r\n    function monitor() {\r\n      function getData() {\r\n        let query = `SELECT\r\n          base.refresh,\r\n          base.partid,\r\n          base.partnum,\r\n          base.partdescription,\r\n          base.vendorname,\r\n          base.locationgroupid,\r\n          base.locationgroup,\r\n          base.uom,\r\n          base.reorderpoint,\r\n          base.orderuptolevel,\r\n          base.onhand,\r\n          base.available,\r\n          base.committed,\r\n          base.allocated,\r\n          base.\\`not available\\`,\r\n          base.\\`on order\\`,\r\n\r\n          CASE\r\n            WHEN base.reorderpoint IS NULL OR base.orderuptolevel IS NULL OR base.reorderpoint = 0 OR base.orderuptolevel = 0 THEN 0\r\n            ELSE GREATEST(0, base.orderuptolevel - (base.available - base.committed))\r\n          END as recommendedorderqty,\r\n\r\n          -- Capacity % with division-by-zero protection and no ROP/OUL handling\r\n          -- Negative values are scaled as percentage between 0 and ROP (e.g., ROP=50, available=40 gives -20%)\r\n          CASE\r\n            WHEN base.reorderpoint IS NULL OR base.orderuptolevel IS NULL OR base.reorderpoint = 0 OR base.orderuptolevel = 0 THEN NULL\r\n            WHEN base.orderuptolevel = base.reorderpoint THEN\r\n              CASE\r\n                WHEN base.available > base.orderuptolevel THEN 150\r\n                WHEN base.available = base.orderuptolevel THEN 100\r\n                ELSE ROUND(-1 * ((base.reorderpoint - base.available) / base.reorderpoint) * 100, 1)\r\n              END\r\n            WHEN base.available < base.reorderpoint THEN\r\n              ROUND(-1 * ((base.reorderpoint - base.available) / base.reorderpoint) * 100, 1)\r\n            ELSE\r\n              ROUND(\r\n                ((base.available - base.reorderpoint) / (base.orderuptolevel - base.reorderpoint)) * 100,\r\n                1\r\n              )\r\n          END as capacitypct,\r\n\r\n         (CASE\r\n              WHEN base.reorderpoint IS NULL OR base.orderuptolevel IS NULL OR base.reorderpoint = 0 OR base.orderuptolevel = 0 THEN 'norop'\r\n              WHEN base.available > base.orderuptolevel THEN 'fb10'\r\n              WHEN base.available < base.reorderpoint THEN 'fb40'\r\n              WHEN base.available >= base.reorderpoint\r\n                   AND base.available <= (base.reorderpoint + (0.2 * (base.orderuptolevel - base.reorderpoint))) THEN 'fb30'\r\n              ELSE 'fb20'\r\n          END) as state,\r\n          (CASE\r\n            WHEN base.reorderpoint IS NULL OR base.orderuptolevel IS NULL OR base.reorderpoint = 0 OR base.orderuptolevel = 0 THEN '5-No ROP/OUL'\r\n            WHEN base.available > base.orderuptolevel THEN '4-Overstocked'\r\n            WHEN base.available < base.reorderpoint THEN '1-Critical'\r\n            WHEN base.available >= base.reorderpoint\r\n                 AND base.available <= (base.reorderpoint + (0.2 * (base.orderuptolevel - base.reorderpoint))) THEN '2-Alert'\r\n            ELSE '3-Good'\r\n        END) as statetext\r\n\r\n        FROM (\r\n          -- Parts with company-wide settings (no location group specific)\r\n          SELECT\r\n            COALESCE((SELECT (sysvalue) * 1000 FROM sysproperties WHERE syskey = 'Refresh Rate'),300000) as refresh,\r\n            part.id as partid,\r\n            part.num as partnum,\r\n            part.description as partdescription,\r\n            COALESCE(vendor.name,'No Default Vendor') as vendorname,\r\n            NULL as locationgroupid,\r\n            'Company Wide' as locationgroup,\r\n            coalesce(uom.code,'') as uom,\r\n            partreorder.reorderpoint as reorderpoint,\r\n            partreorder.orderuptolevel as orderuptolevel,\r\n            coalesce(totals.qtyonhand, 0) as onhand,\r\n            coalesce(totals.qtyavailable, 0) as available,\r\n            coalesce((SELECT sum(qty) FROM qtycommitted qtyc WHERE qtyc.partid = part.id GROUP BY partid),0) as committed,\r\n            coalesce(totals.qtyallocated, 0) as allocated,\r\n            coalesce(totals.qtynotavailable, 0) as \\`not available\\`,\r\n            coalesce(totals.qtyonorder, 0) as \\`on order\\`\r\n          FROM part\r\n            INNER JOIN uom ON part.uomid = uom.id\r\n            INNER JOIN partreorder ON part.id = partreorder.partid AND partreorder.locationgroupid IS NULL\r\n            LEFT OUTER JOIN vendorparts ON (part.id = vendorparts.partid AND vendorparts.defaultflag = 1)\r\n            LEFT OUTER JOIN vendor ON vendorparts.vendorid = vendor.id\r\n            LEFT OUTER JOIN (select coalesce(sum(qti.qtyonhand),0) as qtyonhand,\r\n                        coalesce(sum(qti.qtyallocated),0) as qtyallocated,\r\n                        coalesce(sum(qti.qtyonorder),0) as qtyonorder,\r\n                        if(coalesce((sum(qti.qtyonhand) - sum(qti.qtyallocated) - sum(qti.qtynotavailable) + sum(qti.qtydropship)),0) < 0,0,coalesce((sum(qti.qtyonhand) - sum(qti.qtyallocated) - sum(qti.qtynotavailable) + sum(qti.qtydropship)),0)) as qtyavailable,\r\n                        coalesce(sum(qti.qtynotavailable),0) as qtynotavailable,\r\n                        coalesce(sum(qti.qtydropship),0) as qtydropship, qti.partid\r\n                    from qtyinventorytotals qti\r\n                    group by qti.partid) as totals on part.id = totals.partid\r\n          WHERE part.id LIKE '${partNum}'\r\n                  AND ('${vendorId}' = '%' OR vendor.id = '${vendorId}')\r\n                  AND '' LIKE '${locationGroupId}'\r\n                  ${!includeNoRopOul ? `\r\n                  AND partreorder.reorderpoint IS NOT NULL\r\n                  AND partreorder.orderuptolevel IS NOT NULL\r\n                  AND partreorder.reorderpoint > 0\r\n                  AND partreorder.orderuptolevel > 0\r\n                  ` : ''}\r\n\r\n          UNION ALL\r\n\r\n          -- Parts with location-specific settings - cross join with ALL location groups\r\n          SELECT\r\n            COALESCE((SELECT (sysvalue) * 1000 FROM sysproperties WHERE syskey = 'Refresh Rate'),300000) as refresh,\r\n            part.id as partid,\r\n            part.num as partnum,\r\n            part.description as partdescription,\r\n            COALESCE(vendor.name,'No Default Vendor') as vendorname,\r\n            locationgroup.id as locationgroupid,\r\n            locationgroup.name as locationgroup,\r\n            coalesce(uom.code,'') as uom,\r\n            partreorder.reorderpoint as reorderpoint,\r\n            partreorder.orderuptolevel as orderuptolevel,\r\n            coalesce(qtyonhand.qty,0) as onhand,\r\n            coalesce(IF(coalesce(qtyonhand.qty,0) - coalesce(qtyallocated.qty,0) - coalesce(qtynotavailable.qty,0) + coalesce(qtydropship.qty,0) < 0,0,coalesce(qtyonhand.qty,0) - coalesce(qtyallocated.qty,0) - coalesce(qtynotavailable.qty,0) + coalesce(qtydropship.qty,0)),0) as available,\r\n            coalesce(qtycommitted.qty,0) as committed,\r\n            coalesce(qtyallocated.qty,0) as allocated,\r\n            coalesce(qtynotavailable.qty,0) as \\`not available\\`,\r\n            coalesce(qtyonorder.qty,0) as \\`on order\\`\r\n          FROM part\r\n            INNER JOIN uom ON part.uomid = uom.id\r\n            -- Cross join with ALL location groups for parts that have any location-specific settings\r\n            CROSS JOIN locationgroup\r\n            LEFT OUTER JOIN vendorparts ON (part.id = vendorparts.partid AND vendorparts.defaultflag = 1)\r\n            LEFT OUTER JOIN vendor ON vendorparts.vendorid = vendor.id\r\n            -- Left join to partreorder to get settings for this specific location group (may be null)\r\n            LEFT OUTER JOIN partreorder ON part.id = partreorder.partid AND partreorder.locationgroupid = locationgroup.id\r\n            LEFT OUTER JOIN qtyonhand ON (part.id = qtyonhand.partid AND locationgroup.id = qtyonhand.locationgroupid)\r\n            LEFT OUTER JOIN qtycommitted ON (part.id = qtycommitted.partid AND locationgroup.id = qtycommitted.locationgroupid)\r\n            LEFT OUTER JOIN qtyallocated ON (part.id = qtyallocated.partid AND locationgroup.id = qtyallocated.locationgroupid)\r\n            LEFT OUTER JOIN qtyonorder ON (part.id = qtyonorder.partid AND locationgroup.id = qtyonorder.locationgroupid)\r\n            LEFT OUTER JOIN qtynotavailable ON (part.id = qtynotavailable.partid AND locationgroup.id = qtynotavailable.locationgroupid)\r\n            LEFT OUTER JOIN qtydropship ON (part.id = qtydropship.partid AND locationgroup.id = qtydropship.locationgroupid)\r\n          WHERE part.id LIKE '${partNum}'\r\n                  AND COALESCE(locationgroup.id,'') LIKE '${locationGroupId}'\r\n                  AND ('${vendorId}' = '%' OR vendor.id = '${vendorId}')\r\n                  -- Only include parts that have at least one location-specific setting\r\n                  AND EXISTS (SELECT 1 FROM partreorder pr WHERE pr.partid = part.id AND pr.locationgroupid IS NOT NULL\r\n                    ${!includeNoRopOul ? `\r\n                    AND pr.reorderpoint IS NOT NULL\r\n                    AND pr.orderuptolevel IS NOT NULL\r\n                    AND pr.reorderpoint > 0\r\n                    AND pr.orderuptolevel > 0\r\n                    ` : ''})\r\n        ) as base\r\n        ORDER BY\r\n                CASE WHEN base.vendorname = 'No Default Vendor' THEN 1 ELSE 0 END,\r\n                base.vendorname,\r\n                (CASE\r\n                  WHEN base.reorderpoint IS NULL OR base.orderuptolevel IS NULL OR base.reorderpoint = 0 OR base.orderuptolevel = 0 THEN 'norop'\r\n                  WHEN base.available > base.orderuptolevel THEN 'fb10'\r\n                  WHEN base.available < base.reorderpoint THEN 'fb40'\r\n                  WHEN base.available >= base.reorderpoint\r\n                       AND base.available <= (base.reorderpoint + (0.2 * (base.orderuptolevel - base.reorderpoint))) THEN 'fb30'\r\n                  ELSE 'fb20'\r\n                END) DESC,\r\n                base.partnum`;\r\n\r\n        console.log(query);\r\n        let dataset = JSON.parse(runQuery(query));\r\n        console.log(dataset);\r\n        return dataset;\r\n      }\r\n\r\n      function applyFilters(data, skipStatusFilter) {\r\n        // Get column filter values\r\n        var filterPartNum = ($('#filterPartNum').val() || '').toLowerCase();\r\n        var filterDescription = ($('#filterDescription').val() || '').toLowerCase();\r\n        var filterVendor = ($('#filterVendor').val() || '').toLowerCase();\r\n        var selectedStatuses = getSelectedStatuses();\r\n        var selectedLocations = getSelectedLocations();\r\n\r\n        return data.filter(function(row) {\r\n          // Overstocked: state === 'fb10' or capacity > 100\r\n          if (hideOverstocked && (row.state === 'fb10' || row.capacitypct > 100)) {\r\n            return false;\r\n          }\r\n\r\n          // Adequately stocked: capacity > 20 (but not overstocked)\r\n          if (hideAdequate && row.capacitypct > 20 && row.state !== 'fb10' && row.capacitypct <= 100) {\r\n            return false;\r\n          }\r\n\r\n          // Approaching reorder point: capacity 0-20%\r\n          if (hideApproaching && row.capacitypct >= 0 && row.capacitypct <= 20) {\r\n            return false;\r\n          }\r\n\r\n          // Column filters\r\n          if (filterPartNum && !(row.partnum || '').toLowerCase().includes(filterPartNum)) {\r\n            return false;\r\n          }\r\n          if (filterDescription && !(row.partdescription || '').toLowerCase().includes(filterDescription)) {\r\n            return false;\r\n          }\r\n          if (filterVendor && !(row.vendorname || '').toLowerCase().includes(filterVendor)) {\r\n            return false;\r\n          }\r\n          // Location filter (multi-select)\r\n          if (selectedLocations.length > 0 && selectedLocations.indexOf(row.locationgroup) === -1) {\r\n            return false;\r\n          }\r\n          // Status filter - skip if we're aggregating first\r\n          if (!skipStatusFilter && selectedStatuses.length > 0 && selectedStatuses.indexOf(row.state) === -1) {\r\n            return false;\r\n          }\r\n\r\n          return true;\r\n        });\r\n      }\r\n\r\n      // Filter aggregated data: keep parts that have at least one location matching status filter\r\n      function filterAggregatedByStatus(aggregatedData, allData) {\r\n        var selectedStatuses = getSelectedStatuses();\r\n        if (selectedStatuses.length === 0) return aggregatedData;\r\n\r\n        return aggregatedData.filter(function(aggRow) {\r\n          // Find all raw rows for this part\r\n          var partRows = allData.filter(function(row) {\r\n            return row.partnum === aggRow.partnum && row.vendorname === aggRow.vendorname;\r\n          });\r\n          // Check if any location matches the status filter\r\n          return partRows.some(function(row) {\r\n            return selectedStatuses.indexOf(row.state) !== -1;\r\n          });\r\n        });\r\n      }\r\n\r\n      // Redraw table with current filters (without reinitializing DataTable)\r\n      function redrawWithFilters() {\r\n        let table = $('#report-table').DataTable();\r\n\r\n        // Apply filters to current dataset (skip status filter for aggregation)\r\n        let filteredData = applyFilters(dataset, true);\r\n\r\n        // Aggregate by part for main display\r\n        let aggregatedData = aggregateByPart(filteredData);\r\n\r\n        // Filter aggregated data by status (show parts with ANY location matching status)\r\n        aggregatedData = filterAggregatedByStatus(aggregatedData, dataset);\r\n\r\n        // Insert vendor header rows\r\n        let groupedData = [];\r\n        let currentVendor = null;\r\n\r\n        aggregatedData.forEach(function(row) {\r\n          if (row.vendorname !== currentVendor) {\r\n            currentVendor = row.vendorname;\r\n            groupedData.push({\r\n              isVendorHeader: true,\r\n              vendorname: currentVendor\r\n            });\r\n          }\r\n          groupedData.push(row);\r\n        });\r\n\r\n        table.clear();\r\n        table.rows.add(groupedData);\r\n        table.draw(false);\r\n        table.columns.adjust();\r\n      }\r\n\r\n      // Apply column filters and redraw table\r\n      function applyColumnFilters() {\r\n        redrawWithFilters();\r\n      }\r\n\r\n      // Clear all column filters\r\n      function clearColumnFilters() {\r\n        $('#filterPartNum').val('');\r\n        $('#filterDescription').val('');\r\n        $('#filterVendor').val('');\r\n        // Reset status checkboxes\r\n        $('.status-checkbox').prop('checked', false);\r\n        $('#statusFilterLabel').text('All');\r\n        // Reset location checkboxes\r\n        $('.location-checkbox').prop('checked', false);\r\n        $('#locationFilterLabel').text('All');\r\n        redrawWithFilters();\r\n      }\r\n\r\n      // Open Part in Fishbowl\r\n      function openPart(partNum) {\r\n        openModule(\"Part\", partNum);\r\n      }\r\n\r\n      // Open Vendor in Fishbowl\r\n      function openVendor(vendorName) {\r\n        openModule(\"Vendor\", vendorName);\r\n      }\r\n\r\n      // Toggle status dropdown visibility\r\n      function toggleStatusDropdown() {\r\n        var dropdown = document.getElementById('statusDropdown');\r\n        dropdown.classList.toggle('hidden');\r\n      }\r\n\r\n      // Close dropdowns when clicking outside\r\n      document.addEventListener('click', function(e) {\r\n        // Close status dropdown\r\n        var statusDropdown = document.getElementById('statusDropdown');\r\n        var statusBtn = document.getElementById('statusFilterBtn');\r\n        if (statusDropdown && statusBtn && !statusDropdown.contains(e.target) && !statusBtn.contains(e.target)) {\r\n          statusDropdown.classList.add('hidden');\r\n        }\r\n        // Close location dropdown\r\n        var locationDropdown = document.getElementById('locationDropdown');\r\n        var locationBtn = document.getElementById('locationFilterBtn');\r\n        if (locationDropdown && locationBtn && !locationDropdown.contains(e.target) && !locationBtn.contains(e.target)) {\r\n          locationDropdown.classList.add('hidden');\r\n        }\r\n      });\r\n\r\n      // Update status filter label and apply filter\r\n      function updateStatusFilter() {\r\n        var checkboxes = document.querySelectorAll('.status-checkbox:checked');\r\n        var label = document.getElementById('statusFilterLabel');\r\n        if (checkboxes.length === 0) {\r\n          label.textContent = 'All';\r\n        } else if (checkboxes.length === 1) {\r\n          label.textContent = checkboxes[0].parentElement.textContent.trim();\r\n        } else {\r\n          label.textContent = checkboxes.length + ' selected';\r\n        }\r\n        applyColumnFilters();\r\n      }\r\n\r\n      // Get selected status values\r\n      function getSelectedStatuses() {\r\n        var checkboxes = document.querySelectorAll('.status-checkbox:checked');\r\n        return Array.from(checkboxes).map(function(cb) { return cb.value; });\r\n      }\r\n\r\n      // Toggle location dropdown visibility\r\n      function toggleLocationDropdown() {\r\n        var dropdown = document.getElementById('locationDropdown');\r\n        dropdown.classList.toggle('hidden');\r\n      }\r\n\r\n      // Update location filter label and apply filter\r\n      function updateLocationFilter() {\r\n        var checkboxes = document.querySelectorAll('.location-checkbox:checked');\r\n        var label = document.getElementById('locationFilterLabel');\r\n        if (checkboxes.length === 0) {\r\n          label.textContent = 'All';\r\n        } else if (checkboxes.length === 1) {\r\n          label.textContent = checkboxes[0].parentElement.textContent.trim();\r\n        } else {\r\n          label.textContent = checkboxes.length + ' selected';\r\n        }\r\n        applyColumnFilters();\r\n      }\r\n\r\n      // Get selected location values\r\n      function getSelectedLocations() {\r\n        var checkboxes = document.querySelectorAll('.location-checkbox:checked');\r\n        return Array.from(checkboxes).map(function(cb) { return cb.value; });\r\n      }\r\n\r\n      // Check if data has location groups and populate filter\r\n      function setupLocationFilter(data) {\r\n        var locationGroups = {};\r\n        var hasLocationGroups = false;\r\n\r\n        data.forEach(function(row) {\r\n          if (row.locationgroupid) {\r\n            hasLocationGroups = true;\r\n            if (!locationGroups[row.locationgroup]) {\r\n              locationGroups[row.locationgroup] = row.locationgroupid;\r\n            }\r\n          }\r\n        });\r\n\r\n        var container = document.getElementById('locationFilterContainer');\r\n        var dropdown = document.getElementById('locationDropdown');\r\n\r\n        if (hasLocationGroups) {\r\n          container.style.display = 'block';\r\n          // Populate dropdown with location groups\r\n          var html = '';\r\n          Object.keys(locationGroups).sort().forEach(function(name) {\r\n            html += '<label class=\"flex items-center px-2 py-1 hover:bg-slate-50 cursor-pointer text-sm\">';\r\n            html += '<input type=\"checkbox\" value=\"' + name + '\" class=\"location-checkbox mr-2\" onchange=\"updateLocationFilter()\"> ' + name;\r\n            html += '</label>';\r\n          });\r\n          dropdown.innerHTML = html;\r\n        } else {\r\n          container.style.display = 'none';\r\n        }\r\n\r\n        return hasLocationGroups;\r\n      }\r\n\r\n      // Toggle expanded location details for a part\r\n      function toggleLocationDetails(partNum, rowElement) {\r\n        var tbody = rowElement.closest('tbody');\r\n        var existingRows = tbody.querySelectorAll('tr[data-expanded-for=\"' + partNum + '\"]');\r\n\r\n        // Toggle expand icon\r\n        var icon = rowElement.querySelector('.expand-icon');\r\n\r\n        if (existingRows.length > 0) {\r\n          existingRows.forEach(function(row) { row.remove(); });\r\n          if (icon) icon.classList.remove('expanded');\r\n          return;\r\n        }\r\n\r\n        if (icon) icon.classList.add('expanded');\r\n\r\n        // Get location details for this part\r\n        var partDetails = dataset.filter(function(row) {\r\n          return row.partnum === partNum && row.locationgroupid;\r\n        });\r\n\r\n        if (partDetails.length === 0) return;\r\n\r\n        // Apply status filter to drill-down rows if active\r\n        var selectedStatuses = getSelectedStatuses();\r\n        if (selectedStatuses.length > 0) {\r\n          partDetails = partDetails.filter(function(row) {\r\n            return selectedStatuses.indexOf(row.state) !== -1;\r\n          });\r\n        }\r\n\r\n        if (partDetails.length === 0) return;\r\n\r\n        // Create detail rows - one per location, with cells matching main table columns\r\n        var lastInserted = rowElement;\r\n        partDetails.forEach(function(detail, index) {\r\n          // Status text - show percentage like main table (except norop and overstocked)\r\n          var statusText;\r\n          if (detail.state === 'norop') {\r\n            statusText = 'No ROP/OUL';\r\n          } else if (detail.state === 'fb10' || detail.capacitypct > 100) {\r\n            statusText = 'Overstocked';\r\n          } else {\r\n            statusText = detail.capacitypct + '%';\r\n          }\r\n\r\n          // Get status colors matching main table\r\n          var bgColor, lightColor;\r\n          if (detail.state === 'norop') {\r\n            bgColor = '#e2e8f0'; lightColor = '#e2e8f0';\r\n          } else if (detail.state === 'fb10') {\r\n            bgColor = '#1976D2'; lightColor = '#90CAF9';\r\n          } else if (detail.state === 'fb20') {\r\n            bgColor = '#2E7D32'; lightColor = '#A5D6A7';\r\n          } else if (detail.state === 'fb30') {\r\n            bgColor = '#F57C00'; lightColor = '#FFCC80';\r\n          } else if (detail.state === 'fb40') {\r\n            bgColor = '#C62828'; lightColor = '#EF9A9A';\r\n          } else {\r\n            bgColor = '#e2e8f0'; lightColor = '#e2e8f0';\r\n          }\r\n\r\n          var capacityPct = detail.capacitypct;\r\n          var gradient;\r\n          if (detail.state === 'norop') {\r\n            gradient = bgColor;\r\n          } else if (detail.state === 'fb10' || capacityPct > 100) {\r\n            // Overstocked - always solid blue\r\n            gradient = bgColor;\r\n          } else if (capacityPct === null || capacityPct === undefined) {\r\n            gradient = bgColor;\r\n          } else if (capacityPct < 0) {\r\n            var fillFromRight = Math.min(100, Math.abs(capacityPct));\r\n            gradient = 'linear-gradient(to left, ' + bgColor + ' ' + fillFromRight + '%, ' + lightColor + ' ' + fillFromRight + '%)';\r\n          } else {\r\n            var fillPercent = Math.max(0, Math.min(100, capacityPct));\r\n            gradient = 'linear-gradient(to right, ' + bgColor + ' ' + fillPercent + '%, ' + lightColor + ' ' + fillPercent + '%)';\r\n          }\r\n\r\n          var textColor = detail.state === 'norop' ? '#64748b' : '#FFFFFF';\r\n          var textShadow = detail.state === 'norop' ? 'none' : '1px 1px 2px rgba(0,0,0,0.8)';\r\n          var isLast = index === partDetails.length - 1;\r\n          var borderStyle = isLast ? 'border-bottom: 2px solid #cbd5e1;' : 'border-bottom: 1px solid #e2e8f0;';\r\n\r\n          var detailRow = document.createElement('tr');\r\n          detailRow.setAttribute('data-expanded-for', partNum);\r\n          detailRow.className = 'location-detail-row';\r\n          detailRow.style.cssText = 'background-color: #f8fafc;';\r\n\r\n          var html = '';\r\n          // Col 1: Empty (vendor indicator space)\r\n          html += '<td style=\"padding:2px; ' + borderStyle + ' background:#f8fafc !important;\"></td>';\r\n          // Col 2: Status with gradient\r\n          html += '<td style=\"text-align:center; background:' + gradient + ' !important; color:' + textColor + ' !important; text-shadow:' + textShadow + '; font-weight:600; font-size:11px; padding:6px 4px; ' + borderStyle + '\">' + statusText + '</td>';\r\n          // Col 3: Location Group (in part number column)\r\n          html += '<td style=\"text-align:left; padding:6px 8px; font-weight:500; font-size:11px; background:#f1f5f9 !important; ' + borderStyle + '\">' + detail.locationgroup + '</td>';\r\n          // Col 4: Empty (description column)\r\n          html += '<td style=\"padding:6px 4px; background:#f1f5f9 !important; ' + borderStyle + '\"></td>';\r\n          // Col 5: UOM\r\n          html += '<td style=\"text-align:center; font-size:11px; padding:6px 4px; ' + borderStyle + ' background:#f8fafc !important;\">' + (detail.uom || '') + '</td>';\r\n          // Col 6: On Hand\r\n          html += '<td style=\"text-align:center; font-size:11px; padding:6px 4px; background:#fef3c7 !important; ' + borderStyle + '\">' + formatNumber(detail.onhand) + '</td>';\r\n          // Col 7: Available\r\n          html += '<td style=\"text-align:center; font-size:11px; padding:6px 4px; background:#fef3c7 !important; ' + borderStyle + '\">' + formatNumber(detail.available) + '</td>';\r\n          // Col 8: Qty to Order\r\n          html += '<td style=\"text-align:center; font-size:11px; padding:6px 4px; background:#fef3c7 !important; ' + borderStyle + '\">' + formatNumber(detail.recommendedorderqty) + '</td>';\r\n          // Col 9: ROP\r\n          html += '<td style=\"text-align:center; font-size:11px; padding:6px 4px; background:#dcfce7 !important; ' + borderStyle + '\">' + (detail.reorderpoint || '-') + '</td>';\r\n          // Col 10: OUL\r\n          html += '<td style=\"text-align:center; font-size:11px; padding:6px 4px; background:#dcfce7 !important; ' + borderStyle + '\">' + (detail.orderuptolevel || '-') + '</td>';\r\n          // Col 11: Committed\r\n          html += '<td style=\"text-align:center; font-size:11px; padding:6px 4px; ' + borderStyle + ' background:#f8fafc !important;\">' + formatNumber(detail.committed) + '</td>';\r\n          // Col 12: Allocated\r\n          html += '<td style=\"text-align:center; font-size:11px; padding:6px 4px; ' + borderStyle + ' background:#f8fafc !important;\">' + formatNumber(detail.allocated) + '</td>';\r\n          // Col 13: Not Available\r\n          html += '<td style=\"text-align:center; font-size:11px; padding:6px 4px; ' + borderStyle + ' background:#f8fafc !important;\">' + formatNumber(detail['not available']) + '</td>';\r\n          // Col 14: On Order\r\n          html += '<td style=\"text-align:center; font-size:11px; padding:6px 4px; ' + borderStyle + ' background:#f8fafc !important;\">' + formatNumber(detail['on order']) + '</td>';\r\n\r\n          detailRow.innerHTML = html;\r\n          lastInserted.parentNode.insertBefore(detailRow, lastInserted.nextSibling);\r\n          lastInserted = detailRow;\r\n        });\r\n      }\r\n\r\n      // Format number helper\r\n      function formatNumber(val) {\r\n        if (val === null || val === undefined || val === '') return '0';\r\n        var num = parseFloat(val);\r\n        if (isNaN(num)) return '0';\r\n        if (Number.isInteger(num)) return num.toString();\r\n        return num.toFixed(2).replace(/\\.?0+$/, '');\r\n      }\r\n\r\n      // Aggregate data by part number for parts with multiple location groups\r\n      function aggregateByPart(data) {\r\n        var partMap = {};\r\n        var result = [];\r\n\r\n        data.forEach(function(row) {\r\n          var key = row.partnum + '|' + row.vendorname;\r\n\r\n          if (!partMap[key]) {\r\n            // First occurrence - clone the row\r\n            partMap[key] = {\r\n              refresh: row.refresh,\r\n              partid: row.partid,\r\n              partnum: row.partnum,\r\n              partdescription: row.partdescription,\r\n              vendorname: row.vendorname,\r\n              locationgroupid: row.locationgroupid,\r\n              locationgroup: row.locationgroup,\r\n              uom: row.uom,\r\n              reorderpoint: row.reorderpoint || 0,\r\n              orderuptolevel: row.orderuptolevel || 0,\r\n              onhand: parseFloat(row.onhand) || 0,\r\n              available: parseFloat(row.available) || 0,\r\n              committed: parseFloat(row.committed) || 0,\r\n              allocated: parseFloat(row.allocated) || 0,\r\n              'not available': parseFloat(row['not available']) || 0,\r\n              'on order': parseFloat(row['on order']) || 0,\r\n              recommendedorderqty: parseFloat(row.recommendedorderqty) || 0,\r\n              capacitypct: row.capacitypct,\r\n              state: row.state,\r\n              statetext: row.statetext,\r\n              hasMultipleLocations: false,\r\n              locationCount: 1\r\n            };\r\n          } else {\r\n            // Aggregate quantities\r\n            partMap[key].onhand += parseFloat(row.onhand) || 0;\r\n            partMap[key].available += parseFloat(row.available) || 0;\r\n            partMap[key].committed += parseFloat(row.committed) || 0;\r\n            partMap[key].allocated += parseFloat(row.allocated) || 0;\r\n            partMap[key]['not available'] += parseFloat(row['not available']) || 0;\r\n            partMap[key]['on order'] += parseFloat(row['on order']) || 0;\r\n            partMap[key].recommendedorderqty += parseFloat(row.recommendedorderqty) || 0;\r\n            partMap[key].reorderpoint += parseFloat(row.reorderpoint) || 0;\r\n            partMap[key].orderuptolevel += parseFloat(row.orderuptolevel) || 0;\r\n            partMap[key].hasMultipleLocations = true;\r\n            partMap[key].locationCount++;\r\n            // Set locationgroup to indicate multiple\r\n            partMap[key].locationgroup = partMap[key].locationCount + ' Locations';\r\n            // Recalculate state based on aggregated values\r\n            partMap[key] = recalculateState(partMap[key]);\r\n          }\r\n        });\r\n\r\n        // Convert map to array preserving order\r\n        var seen = {};\r\n        data.forEach(function(row) {\r\n          var key = row.partnum + '|' + row.vendorname;\r\n          if (!seen[key]) {\r\n            seen[key] = true;\r\n            result.push(partMap[key]);\r\n          }\r\n        });\r\n\r\n        return result;\r\n      }\r\n\r\n      // Recalculate state for aggregated row\r\n      function recalculateState(row) {\r\n        if (!row.reorderpoint || !row.orderuptolevel || row.reorderpoint === 0 || row.orderuptolevel === 0) {\r\n          row.state = 'norop';\r\n          row.capacitypct = null;\r\n        } else if (row.available > row.orderuptolevel) {\r\n          row.state = 'fb10';\r\n          row.capacitypct = 150;\r\n        } else if (row.available < row.reorderpoint) {\r\n          row.state = 'fb40';\r\n          row.capacitypct = Math.round(-1 * ((row.reorderpoint - row.available) / row.reorderpoint) * 100 * 10) / 10;\r\n        } else if (row.available <= row.reorderpoint + (0.2 * (row.orderuptolevel - row.reorderpoint))) {\r\n          row.state = 'fb30';\r\n          row.capacitypct = Math.round(((row.available - row.reorderpoint) / (row.orderuptolevel - row.reorderpoint)) * 100 * 10) / 10;\r\n        } else {\r\n          row.state = 'fb20';\r\n          row.capacitypct = Math.round(((row.available - row.reorderpoint) / (row.orderuptolevel - row.reorderpoint)) * 100 * 10) / 10;\r\n        }\r\n        return row;\r\n      }\r\n\r\n      // Export to CSV using DataTables button\r\n      function exportToCSV() {\r\n        var table = $('#report-table').DataTable();\r\n        table.button(0).trigger();\r\n      }\r\n\r\n      // Print table using DataTables button\r\n      function printTable() {\r\n        var table = $('#report-table').DataTable();\r\n        table.button(1).trigger();\r\n      }\r\n\r\n      // Make functions globally accessible for inline event handlers\r\n      window.applyColumnFilters = applyColumnFilters;\r\n      window.clearColumnFilters = clearColumnFilters;\r\n      window.openPart = openPart;\r\n      window.openVendor = openVendor;\r\n      window.toggleStatusDropdown = toggleStatusDropdown;\r\n      window.updateStatusFilter = updateStatusFilter;\r\n      window.toggleLocationDropdown = toggleLocationDropdown;\r\n      window.updateLocationFilter = updateLocationFilter;\r\n      window.toggleLocationDetails = toggleLocationDetails;\r\n      window.exportToCSV = exportToCSV;\r\n      window.printTable = printTable;\r\n\r\n      function drawTable() {\r\n        dataset = getData();\r\n\r\n        // Setup location filter based on data\r\n        var hasLocationGroups = setupLocationFilter(dataset);\r\n\r\n        // Apply filters (skip status filter for aggregation)\r\n        let filteredData = applyFilters(dataset, true);\r\n\r\n        // Aggregate by part for main display (keeps raw data in dataset for drill-down)\r\n        let aggregatedData = aggregateByPart(filteredData);\r\n\r\n        // Filter aggregated data by status (show parts with ANY location matching status)\r\n        aggregatedData = filterAggregatedByStatus(aggregatedData, dataset);\r\n\r\n        // Insert vendor header rows\r\n        let groupedData = [];\r\n        let currentVendor = null;\r\n\r\n        aggregatedData.forEach(function(row) {\r\n          if (row.vendorname !== currentVendor) {\r\n            currentVendor = row.vendorname;\r\n            groupedData.push({\r\n              isVendorHeader: true,\r\n              vendorname: currentVendor\r\n            });\r\n          }\r\n          groupedData.push(row);\r\n        });\r\n\r\n        let table = $('#report-table');\r\n        table.empty();\r\n\r\n        $(window).on('resize scroll', function() {\r\n          table.columns.adjust();\r\n        });\r\n\r\n        let dataTable = table.DataTable({\r\n          dom: 'Brt',\r\n          data: groupedData,\r\n          ordering: false,\r\n          autoWidth: false,\r\n          paging: false,\r\n          scrollY: 'calc(100vh - 280px)',\r\n          scrollCollapse: true,\r\n          deferRender: true,\r\n          buttons: [\r\n            { extend: 'csv', className: 'dt-button-hidden' },\r\n            { extend: 'print', className: 'dt-button-hidden' }\r\n          ],\r\n          columns: [\r\n            {\r\n              title: '<span title=\"Vendor grouping indicator\">',\r\n              data: 'vendorname',\r\n              defaultContent: '',\r\n              width: '1%',\r\n              render: function(data, type, row) {\r\n                if (row.isVendorHeader) return data;\r\n                return '';\r\n              },\r\n              createdCell: function(td, cellData, rowData, row, col) {\r\n                              if (rowData.isVendorHeader) {\r\n                                $(td).attr('colspan', 14);\r\n                                $(td).parent().addClass('vendor-group-header');\r\n                                var vendorIcon = '<svg class=\"w-4 h-4 inline-block mr-2 align-text-bottom\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" style=\"color: #2d9cdb;\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"></path></svg>';\r\n                                var vendorDisplay = rowData.vendorname;\r\n                                // Make vendor name clickable (except for \"No Default Vendor\")\r\n                                if (rowData.vendorname && rowData.vendorname !== 'No Default Vendor') {\r\n                                  vendorDisplay = '<a href=\"#\" class=\"item-link\" onclick=\"openVendor(\\'' + rowData.vendorname.replace(/'/g, \"\\\\'\") + '\\'); return false;\">' + rowData.vendorname + '</a>';\r\n                                }\r\n                                $(td).html(vendorIcon + vendorDisplay);\r\n                                $(td).nextAll().remove();\r\n                              } else {\r\n                                $(td).css({\r\n                                  'padding': '2px',\r\n                                  'width': '1%',\r\n                                  'max-width': '10px'\r\n                                });\r\n                              }\r\n                            }\r\n            },\r\n            {\r\n              title: '<span title=\"Inventory status with capacity percentage\">Status</span>',\r\n              data: 'capacitypct',\r\n              defaultContent: '',\r\n              className: 'dt-center group-status',\r\n              width: '8%',\r\n              render: function(data, type, row) {\r\n                if (row.isVendorHeader) return '';\r\n                if (type === 'display') {\r\n                  let text;\r\n                  if (row.state === 'norop') {\r\n                    text = 'No ROP/OUL';\r\n                  } else if (row.state === 'fb10' || data > 100) {\r\n                    text = 'Overstocked';\r\n                  } else if (data < 0) {\r\n                    text = data + '%';\r\n                  } else {\r\n                    text = data + '%';\r\n                  }\r\n                  return '<strong>' + text + '</strong>';\r\n                }\r\n                // For sorting, put norop at the end\r\n                if (row.state === 'norop') return 999999;\r\n                return data;\r\n              },\r\n              createdCell: function (td, cellData, rowData, row, col) {\r\n                  if (rowData.isVendorHeader) return;\r\n\r\n                  // Determine color based on state\r\n                  let bgColor = '';\r\n                  let lightColor = '';\r\n                  if (rowData.state === 'norop') {\r\n                      // No ROP/OUL - light grey background\r\n                      td.style.setProperty('background', '#e2e8f0', 'important');\r\n                      td.style.setProperty('color', '#64748b', 'important');\r\n                      td.style.setProperty('font-weight', 'normal', 'important');\r\n                      return;\r\n                  } else if (rowData.state === 'fb10') {\r\n                      bgColor = '#1976D2'; // Blue - Overstocked\r\n                      lightColor = '#90CAF9'; // Darker light blue\r\n                  } else if (rowData.state === 'fb20') {\r\n                      bgColor = '#2E7D32'; // Green - Good\r\n                      lightColor = '#A5D6A7'; // Darker light green\r\n                  } else if (rowData.state === 'fb30') {\r\n                      bgColor = '#F57C00'; // Orange - Alert\r\n                      lightColor = '#FFCC80'; // Darker light orange\r\n                  } else if (rowData.state === 'fb40') {\r\n                      bgColor = '#C62828'; // Red - Critical\r\n                      lightColor = '#EF9A9A'; // Darker light red\r\n                  }\r\n\r\n                  if (bgColor) {\r\n                      // Calculate fill percentage (cap at 0-100 for display)\r\n                      let fillPercent = Math.max(0, Math.min(100, cellData));\r\n                      let gradient;\r\n\r\n                      if (cellData < 0) {\r\n                          // Negative - fill from right to left\r\n                          let fillFromRight = Math.min(100, Math.abs(cellData));\r\n                          gradient = 'linear-gradient(to left, ' + bgColor + ' ' + fillFromRight + '%, ' + lightColor + ' ' + fillFromRight + '%)';\r\n                      } else if (cellData > 100) {\r\n                          // Over 100% - full fill\r\n                          gradient = bgColor;\r\n                      } else {\r\n                          // Normal - fill from left to right\r\n                          gradient = 'linear-gradient(to right, ' + bgColor + ' ' + fillPercent + '%, ' + lightColor + ' ' + fillPercent + '%)';\r\n                      }\r\n\r\n                      td.style.setProperty('background', gradient, 'important');\r\n                      td.style.setProperty('color', '#FFFFFF', 'important');\r\n                      td.style.setProperty('font-weight', 'normal', 'important');\r\n                      td.style.setProperty('text-shadow', '1px 1px 2px rgba(0,0,0,0.8)', 'important');\r\n                  }\r\n              }\r\n\r\n            },\r\n            {\r\n              title: '<span title=\"Unique part identifier/SKU\">Part Number</span>',\r\n              data: 'partnum',\r\n              defaultContent: '',\r\n              width: '8%',\r\n              className: 'dt-right group-part-info',\r\n              render: function(data, type, row) {\r\n                if (row.isVendorHeader) return '';\r\n                if (type === 'display') {\r\n                  // Check if part has multiple location groups\r\n                  var hasLocations = row.hasMultipleLocations ? true : false;\r\n                  var expandIcon = hasLocations ? '<svg class=\"expand-icon w-3 h-3 inline-block mr-1 text-indigo-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>' : '';\r\n                  return expandIcon + '<a href=\"#\" class=\"item-link\" onclick=\"openPart(\\'' + data.replace(/'/g, \"\\\\'\") + '\\'); return false;\"><strong>' + data + '</strong></a>';\r\n                }\r\n                return data;\r\n              },\r\n              createdCell: function(td, cellData, rowData, row, col) {\r\n                if (rowData.isVendorHeader) return;\r\n                if (rowData.hasMultipleLocations) {\r\n                  $(td).addClass('expandable-row');\r\n                  $(td).on('click', function(e) {\r\n                    if (!$(e.target).hasClass('item-link')) {\r\n                      toggleLocationDetails(rowData.partnum, $(this).closest('tr')[0]);\r\n                    }\r\n                  });\r\n                }\r\n              }\r\n            },\r\n            {\r\n              title: '<span title=\"Descriptive name of the part\">Part Description</span>',\r\n              data: 'partdescription',\r\n              defaultContent: '',\r\n              width: '15%',\r\n              className: 'group-part-info',\r\n              render: function(data, type, row) {\r\n                if (row.isVendorHeader) return '';\r\n                if (type === 'display') {\r\n                  return '<strong>' + data + '</strong>';\r\n                }\r\n                return data;\r\n              }\r\n            },\r\n            {\r\n              title: '<span title=\"Unit of Measure for quantity tracking\">UOM</span>',\r\n              data: 'uom',\r\n              defaultContent: '',\r\n              width: '4%',\r\n              className: 'dt-center group-part-info',\r\n              render: function(data, type, row) {\r\n                if (row.isVendorHeader) return '';\r\n                return data || '';\r\n              }\r\n            },\r\n            { title: '<span title=\"Total physical quantity currently in stock\">On Hand</span>', data: 'onhand', defaultContent: '', width: '6%', className: 'dt-center group-inventory-key',render: function (data, type, row) {\r\n\r\n                if (row.isVendorHeader) return '';\r\n                if (data === null || data === '' || data === undefined) return '';\r\n\r\n                if (type === 'display' || type === 'filter') {\r\n\r\n                    const num = parseFloat(data);\r\n\r\n                    if (isNaN(num)) return '';\r\n\r\n                    // If it's a whole number, show no decimals\r\n                    if (Number.isInteger(num)) {\r\n                        return num.toString();\r\n                    }\r\n\r\n                    // Otherwise show up to 2 decimals (no trailing zeros)\r\n                    return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                }\r\n\r\n                return data;\r\n            }\r\n },\r\n            { title: '<span title=\"Quantity available for use: On Hand - Allocated - Not Available + Dropship\">Available</span>', data: 'available', defaultContent: '', width: '6%', className: 'dt-center group-inventory-key',\r\n                      render: function (data, type, row) {\r\n\r\n                        if (row.isVendorHeader) return '';\r\n                        if (data === null || data === '' || data === undefined) return '';\r\n\r\n                        if (type === 'display' || type === 'filter') {\r\n\r\n                            const num = parseFloat(data);\r\n\r\n                            if (isNaN(num)) return '';\r\n\r\n                            // If it's a whole number, show no decimals\r\n                            if (Number.isInteger(num)) {\r\n                                return num.toString();\r\n                            }\r\n\r\n                            // Otherwise show up to 2 decimals (no trailing zeros)\r\n                            return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                        }\r\n\r\n                        return data;\r\n                      }\r\n             },\r\n            { title: '<span title=\"Recommended quantity to order to reach Order Up To level: Order Up To - (Available - Committed)\">Qty to Order</span>', data: 'recommendedorderqty', defaultContent: '', width: '8%', className: 'dt-center group-inventory-key',\r\n                      render: function (data, type, row) {\r\n\r\n                        if (row.isVendorHeader) return '';\r\n                        if (data === null || data === '' || data === undefined) return '';\r\n\r\n                        if (type === 'display' || type === 'filter') {\r\n\r\n                            const num = parseFloat(data);\r\n\r\n                            if (isNaN(num)) return '';\r\n\r\n                            // If it's a whole number, show no decimals\r\n                            if (Number.isInteger(num)) {\r\n                                return num.toString();\r\n                            }\r\n\r\n                            // Otherwise show up to 2 decimals (no trailing zeros)\r\n                            return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                        }\r\n\r\n                        return data;\r\n                      }\r\n            },\r\n            { title: '<span title=\"Minimum inventory threshold that triggers a reorder alert\">Reorder Point</span>', data: 'reorderpoint', defaultContent: '', width: '6%', className: 'dt-center group-reorder-params',\r\n                      render: function (data, type, row) {\r\n\r\n                        if (row.isVendorHeader) return '';\r\n                        if (data === null || data === '' || data === undefined || data === 0) {\r\n                            return type === 'display' ? '-' : '';\r\n                        }\r\n\r\n                        if (type === 'display' || type === 'filter') {\r\n\r\n                            const num = parseFloat(data);\r\n\r\n                            if (isNaN(num) || num === 0) return type === 'display' ? '-' : '';\r\n\r\n                            // If it's a whole number, show no decimals\r\n                            if (Number.isInteger(num)) {\r\n                                return num.toString();\r\n                            }\r\n\r\n                            // Otherwise show up to 2 decimals (no trailing zeros)\r\n                            return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                        }\r\n\r\n                        return data;\r\n                      }\r\n },\r\n            { title: '<span title=\"Target maximum inventory level when reordering\">Order Up To</span>', data: 'orderuptolevel', defaultContent: '', width: '6%', className: 'dt-center group-reorder-params', render: function (data, type, row) {\r\n\r\n     if (row.isVendorHeader) return '';\r\n     if (data === null || data === '' || data === undefined || data === 0) {\r\n         return type === 'display' ? '-' : '';\r\n     }\r\n\r\n     if (type === 'display' || type === 'filter') {\r\n\r\n         const num = parseFloat(data);\r\n\r\n         if (isNaN(num) || num === 0) return type === 'display' ? '-' : '';\r\n\r\n         // If it's a whole number, show no decimals\r\n         if (Number.isInteger(num)) {\r\n             return num.toString();\r\n         }\r\n\r\n         // Otherwise show up to 2 decimals (no trailing zeros)\r\n         return num.toFixed(2).replace(/\\.?0+$/, '');\r\n     }\r\n\r\n     return data;\r\n }\r\n },\r\n            { title: '<span title=\"Quantity committed to sales orders\">Committed</span>', data: 'committed', defaultContent: '', width: '6%', className: 'dt-center group-allocation',render: function (data, type, row) {\r\n\r\n     if (row.isVendorHeader) return '';\r\n     if (data === null || data === '' || data === undefined) return '';\r\n\r\n     if (type === 'display' || type === 'filter') {\r\n\r\n         const num = parseFloat(data);\r\n\r\n         if (isNaN(num)) return '';\r\n\r\n         // If it's a whole number, show no decimals\r\n         if (Number.isInteger(num)) {\r\n             return num.toString();\r\n         }\r\n\r\n         // Otherwise show up to 2 decimals (no trailing zeros)\r\n         return num.toFixed(2).replace(/\\.?0+$/, '');\r\n     }\r\n\r\n     return data;\r\n }\r\n },\r\n            { title: '<span title=\"Quantity allocated for work orders or manufacturing builds\">Allocated</span>', data: 'allocated', defaultContent: '', width: '6%', className: 'dt-center group-allocation',render: function (data, type, row) {\r\n\r\n                if (row.isVendorHeader) return '';\r\n                if (data === null || data === '' || data === undefined) return '';\r\n\r\n                if (type === 'display' || type === 'filter') {\r\n\r\n                    const num = parseFloat(data);\r\n\r\n                    if (isNaN(num)) return '';\r\n\r\n                    // If it's a whole number, show no decimals\r\n                    if (Number.isInteger(num)) {\r\n                        return num.toString();\r\n                    }\r\n\r\n                    // Otherwise show up to 2 decimals (no trailing zeros)\r\n                    return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                }\r\n\r\n                return data;\r\n            }\r\n },\r\n            { title: '<span title=\"Quantity on hand but flagged as not available for use\">Not Available</span>', data: 'not available', defaultContent: '', width: '6%', className: 'dt-center group-allocation',render: function (data, type, row) {\r\n\r\n                if (row.isVendorHeader) return '';\r\n                if (data === null || data === '' || data === undefined) return '';\r\n\r\n                if (type === 'display' || type === 'filter') {\r\n\r\n                    const num = parseFloat(data);\r\n\r\n                    if (isNaN(num)) return '';\r\n\r\n                    // If it's a whole number, show no decimals\r\n                    if (Number.isInteger(num)) {\r\n                        return num.toString();\r\n                    }\r\n\r\n                    // Otherwise show up to 2 decimals (no trailing zeros)\r\n                    return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                }\r\n\r\n                return data;\r\n            }\r\n },\r\n            { title: '<span title=\"Quantity on purchase orders not yet received\">On Order</span>', data: 'on order', defaultContent: '', width: '6%', className: 'dt-center group-allocation',render: function (data, type, row) {\r\n\r\n                if (row.isVendorHeader) return '';\r\n                if (data === null || data === '' || data === undefined) return '';\r\n\r\n                if (type === 'display' || type === 'filter') {\r\n\r\n                    const num = parseFloat(data);\r\n\r\n                    if (isNaN(num)) return '';\r\n\r\n                    // If it's a whole number, show no decimals\r\n                    if (Number.isInteger(num)) {\r\n                        return num.toString();\r\n                    }\r\n\r\n                    // Otherwise show up to 2 decimals (no trailing zeros)\r\n                    return num.toFixed(2).replace(/\\.?0+$/, '');\r\n                }\r\n\r\n                return data;\r\n            }\r\n }\r\n          ],\r\n          fixedHeader: true,\r\n          colReorder: false,\r\n          pagingType: 'simple',\r\n          responsive: false,\r\n          stateSave: false,\r\n          language: {\r\n            paginate: {\r\n              previous: 'PREV',\r\n              next: 'NEXT'\r\n            }\r\n          },\r\n          drawCallback: function(settings) {\r\n            // Force column width recalculation after draw to prevent skinny columns\r\n            var api = this.api();\r\n            api.columns.adjust();\r\n\r\n            // Update vendor header colspans\r\n            updateVendorHeaderColspan();\r\n          }\r\n        });\r\n\r\n        // Update vendor header colspans based on visible columns\r\n        function updateVendorHeaderColspan() {\r\n          let visibleColCount = dataTable.columns(':visible').count();\r\n          $('.vendor-group-header td').each(function() {\r\n            $(this).attr('colspan', visibleColCount);\r\n            // Remove any extra cells that were created\r\n            $(this).nextAll().remove();\r\n          });\r\n        }\r\n\r\n        // Update colspans initially\r\n        updateVendorHeaderColspan();\r\n\r\n        // Force initial column width adjustment\r\n        dataTable.columns.adjust().draw(false);\r\n      }\r\n\r\n      function refreshTable() {\r\n        console.time('refreshRate');\r\n        let table = $('#report-table').DataTable();\r\n        dataset = getData();\r\n\r\n        // Setup location filter based on data\r\n        setupLocationFilter(dataset);\r\n\r\n        // Apply filters (skip status filter for aggregation)\r\n        let filteredData = applyFilters(dataset, true);\r\n\r\n        // Aggregate by part for main display\r\n        let aggregatedData = aggregateByPart(filteredData);\r\n\r\n        // Filter aggregated data by status (show parts with ANY location matching status)\r\n        aggregatedData = filterAggregatedByStatus(aggregatedData, dataset);\r\n\r\n        // Insert vendor header rows\r\n        let groupedData = [];\r\n        let currentVendor = null;\r\n\r\n        aggregatedData.forEach(function(row) {\r\n          if (row.vendorname !== currentVendor) {\r\n            currentVendor = row.vendorname;\r\n            groupedData.push({\r\n              isVendorHeader: true,\r\n              vendorname: currentVendor\r\n            });\r\n          }\r\n          groupedData.push(row);\r\n        });\r\n\r\n        table.clear();\r\n\r\n        table.rows.add(groupedData);\r\n        table.draw(false);\r\n\r\n        // Ensure columns maintain proper widths after refresh\r\n        table.columns.adjust();\r\n\r\n        console.timeEnd('refreshRate');\r\n        setTimeout(refreshTable, dataset[0].refresh);\r\n      }\r\n\r\n      // Make refreshTable globally accessible\r\n      window.refreshTable = refreshTable;\r\n\r\n      drawTable();\r\n      console.log(dataset[0].refresh);\r\n      setTimeout(refreshTable, dataset[0].refresh);\r\n    }\r\n\r\n    $(document).ready(function() {\r\n      monitor();\r\n    });\r\n\r\n    // Toggle instructions panel\r\n    function toggleInstructions() {\r\n      const panel = document.getElementById('instructionsPanel');\r\n      if (panel.style.display === 'none') {\r\n        panel.style.display = 'block';\r\n      } else {\r\n        panel.style.display = 'none';\r\n      }\r\n    }\r\n\r\n    const displayHeader = $CHECK{Display_header|true};\r\n    let headerContainer = document.getElementById('headerContainer');\r\n    displayHeader ? headerContainer.style.display = 'flex' : headerContainer.style.display = 'none';\r\n\r\n    </script>\r\n</body>\r\n</html>",
  "active" : true,
  "note" : "",
  "type" : "Page"
} ]